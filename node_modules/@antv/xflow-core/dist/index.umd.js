!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@antv/x6"),require("react-dom"),require("@antv/x6-react-shape"),require("@antv/layout"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","react","@antv/x6","react-dom","@antv/x6-react-shape","@antv/layout","lodash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).XFlowCore={},e.React,e.X6,e.ReactDOM,e.X6ReactShape,e.layout,e.lodash)}(this,(function(e,t,n,o,i,r,s){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var u=a(t),d=c(t),l=a(o),h=c(r),f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p={},g={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]}(g);var v={},y={},m={};Object.defineProperty(m,"__esModule",{value:!0}),m.TargetTypeEnum=m.BindingTypeEnum=m.BindingScopeEnum=void 0;m.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};m.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};m.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};var b={};Object.defineProperty(b,"__esModule",{value:!0}),b.id=void 0;var _=0;b.id=function(){return _++},Object.defineProperty(y,"__esModule",{value:!0}),y.Binding=void 0;var E=m,C=b,w=function(){function e(e,t){this.id=C.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=E.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===E.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();y.Binding=w;var O={};Object.defineProperty(O,"__esModule",{value:!0}),O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0,O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",O.NULL_ARGUMENT="NULL argument",O.KEY_NOT_FOUND="Key Not Found",O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",O.CANNOT_UNBIND="Could not unbind serviceIdentifier:",O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";O.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},O.CIRCULAR_DEPENDENCY="Circular dependency found:",O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",O.INVALID_BINDING_TYPE="Invalid binding type:",O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";O.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";O.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};O.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},O.STACK_OVERFLOW="Maximum call stack size exceeded";var x={};Object.defineProperty(x,"__esModule",{value:!0}),x.MetadataReader=void 0;var A=g,T=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(A.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(A.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(A.TAGGED_PROP,e)||[]},e}();x.MetadataReader=T;var S={},P={};Object.defineProperty(P,"__esModule",{value:!0}),P.BindingCount=void 0;P.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};var N={};Object.defineProperty(N,"__esModule",{value:!0}),N.isStackOverflowExeption=void 0;var I=O;N.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===I.STACK_OVERFLOW};var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.circularDependencyToException=k.listMetadataForTarget=k.listRegisteredBindingsForServiceIdentifier=k.getServiceIdentifierAsString=k.getFunctionName=void 0;var M=O;function D(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function j(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||j(e.parentRequest,t))}function R(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}k.getServiceIdentifierAsString=D,k.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var o="",i=n(e,t);return 0!==i.length&&(o="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=R(e.implementationType)),o=o+"\n "+t,e.constraint.metaData&&(o=o+" - "+e.constraint.metaData)}))),o},k.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(j(t,t.serviceIdentifier)){var n=function(e){return function e(t,n){void 0===n&&(n=[]);var o=D(t.serviceIdentifier);return n.push(o),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(t);throw new Error(M.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},k.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",o=t.getNamedTag(),i=t.getCustomTags();return null!==o&&(n+=o.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},k.getFunctionName=R;var G={};Object.defineProperty(G,"__esModule",{value:!0}),G.Context=void 0;var F=b,U=function(){function e(e){this.id=F.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();G.Context=U;var L={};Object.defineProperty(L,"__esModule",{value:!0}),L.Metadata=void 0;var B=g,H=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===B.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();L.Metadata=H;var V={};Object.defineProperty(V,"__esModule",{value:!0}),V.Plan=void 0;var X=function(e,t){this.parentContext=e,this.rootRequest=t};V.Plan=X;var z={},K={},W={};Object.defineProperty(W,"__esModule",{value:!0}),W.tagProperty=W.tagParameter=W.decorate=void 0;var Y=O,q=g;function $(e,t,n,o,i){var r={},s="number"==typeof i,a=void 0!==i&&s?i.toString():n;if(s&&void 0!==n)throw new Error(Y.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(r=Reflect.getMetadata(e,t));var c=r[a];if(Array.isArray(c))for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===o.key)throw new Error(Y.DUPLICATED_METADATA+" "+l.key.toString())}else c=[];c.push(o),r[a]=c,Reflect.defineMetadata(e,r,t)}function J(e,t){Reflect.decorate(e,t)}function Z(e,t){return function(n,o){t(n,o,e)}}W.tagParameter=function(e,t,n,o){$(q.TAGGED,e,t,o,n)},W.tagProperty=function(e,t,n){$(q.TAGGED_PROP,e.constructor,t,n)},W.decorate=function(e,t,n){"number"==typeof n?J([Z(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):J([e],t)},Object.defineProperty(K,"__esModule",{value:!0}),K.inject=K.LazyServiceIdentifer=void 0;var Q=O,ee=g,te=L,ne=W,oe=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();K.LazyServiceIdentifer=oe,K.inject=function(e){return function(t,n,o){if(void 0===e)throw new Error(Q.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new te.Metadata(ee.INJECT_TAG,e);"number"==typeof o?ne.tagParameter(t,n,o,i):ne.tagProperty(t,n,i)}};var ie={},re={};Object.defineProperty(re,"__esModule",{value:!0}),re.QueryableString=void 0;var se=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();re.QueryableString=se,Object.defineProperty(ie,"__esModule",{value:!0}),ie.Target=void 0;var ae=g,ce=b,ue=L,de=re,le=function(){function e(e,t,n,o){this.id=ce.id(),this.type=e,this.serviceIdentifier=n,this.name=new de.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof o?i=new ue.Metadata(ae.NAMED_TAG,o):o instanceof ue.Metadata&&(i=o),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(ae.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(ae.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(ae.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return ae.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(ae.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===ae.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return ae.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(ae.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var o=0,i=t.metadata;o<i.length;o++){var r=i[o];if(r.key===e&&r.value===n)return!0}return!1}},e}();ie.Target=le,function(e){var t=f&&f.__spreadArray||function(e,t){for(var n=0,o=t.length,i=e.length;n<o;n++,i++)e[i]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var n=K,o=O,i=m,r=g,s=k;Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return s.getFunctionName}});var a=ie;function c(e,n,i,r){var s=e.getConstructorMetadata(i),a=s.compilerGeneratedMetadata;if(void 0===a){var c=o.MISSING_INJECTABLE_ANNOTATION+" "+n+".";throw new Error(c)}var l=s.userGeneratedMetadata,h=Object.keys(l),f=0===i.length&&h.length>0,p=h.length>i.length,g=function(e,t,n,o,i){for(var r=[],s=0;s<i;s++){var a=u(s,e,t,n,o);null!==a&&r.push(a)}return r}(r,n,a,l,f||p?h.length:i.length),v=d(e,i);return t(t([],g),v)}function u(e,t,r,s,c){var u=c[e.toString()]||[],d=l(u),h=!0!==d.unmanaged,f=s[e],p=d.inject||d.multiInject;if((f=p||f)instanceof n.LazyServiceIdentifer&&(f=f.unwrap()),h){if(!t&&(f===Object||f===Function||void 0===f)){var g=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+r+".";throw new Error(g)}var v=new a.Target(i.TargetTypeEnum.ConstructorArgument,d.targetName,f);return v.metadata=u,v}return null}function d(e,n){for(var o=e.getPropertiesMetadata(n),r=[],s=0,c=Object.keys(o);s<c.length;s++){var u=c[s],h=o[u],f=l(o[u]),p=f.targetName||u,g=f.inject||f.multiInject,v=new a.Target(i.TargetTypeEnum.ClassProperty,p,g);v.metadata=h,r.push(v)}var y=Object.getPrototypeOf(n.prototype).constructor;if(y!==Object){var m=d(e,y);r=t(t([],r),m)}return r}function l(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[r.INJECT_TAG],multiInject:t[r.MULTI_INJECT_TAG],targetName:t[r.NAME_TAG],unmanaged:t[r.UNMANAGED_TAG]}}e.getDependencies=function(e,t){return c(e,s.getFunctionName(t),t,!1)},e.getBaseClassDependencyCount=function e(t,n){var o=Object.getPrototypeOf(n.prototype).constructor;if(o!==Object){var i=c(t,s.getFunctionName(o),o,!0),a=i.map((function(e){return e.metadata.filter((function(e){return e.key===r.UNMANAGED_TAG}))})),u=[].concat.apply([],a).length,d=i.length-u;return d>0?d:e(t,o)}return 0}}(z);var he={};Object.defineProperty(he,"__esModule",{value:!0}),he.Request=void 0;var fe=b,pe=function(){function e(e,t,n,o,i){this.id=fe.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(o)?o:[o],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,o){var i=new e(t,this.parentContext,this,n,o);return this.childRequests.push(i),i},e}();he.Request=pe,Object.defineProperty(S,"__esModule",{value:!0}),S.getBindingDictionary=S.createMockRequest=S.plan=void 0;var ge=P,ve=O,ye=m,me=g,be=N,_e=k,Ee=G,Ce=L,we=V,Oe=z,xe=he,Ae=ie;function Te(e){return e._bindingDictionary}function Se(e,t,n,o,i){var r=Ne(n.container,i.serviceIdentifier),s=[];return r.length===ge.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),r=Ne(n.container,i.serviceIdentifier)),s=t?r:r.filter((function(e){var t=new xe.Request(e.serviceIdentifier,n,o,e,i);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case ge.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=_e.getServiceIdentifierAsString(e),r=ve.NOT_REGISTERED;throw r+=_e.listMetadataForTarget(i,n),r+=_e.listRegisteredBindingsForServiceIdentifier(o,i,Ne),new Error(r);case ge.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case ge.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=_e.getServiceIdentifierAsString(e),r=ve.AMBIGUOUS_MATCH+" "+i;throw r+=_e.listRegisteredBindingsForServiceIdentifier(o,i,Ne),new Error(r)}}(i.serviceIdentifier,s,i,n.container),s}function Pe(e,t,n,o,i,r){var s,a;if(null===i){s=Se(e,t,o,null,r),a=new xe.Request(n,o,null,s,r);var c=new we.Plan(o,a);o.addPlan(c)}else s=Se(e,t,o,i,r),a=i.addChildRequest(r.serviceIdentifier,s,r);s.forEach((function(t){var n=null;if(r.isArray())n=a.addChildRequest(t.serviceIdentifier,t,r);else{if(t.cache)return;n=a}if(t.type===ye.BindingTypeEnum.Instance&&null!==t.implementationType){var i=Oe.getDependencies(e,t.implementationType);if(!o.container.options.skipBaseClassChecks){var s=Oe.getBaseClassDependencyCount(e,t.implementationType);if(i.length<s){var c=ve.ARGUMENTS_LENGTH_MISMATCH(Oe.getFunctionName(t.implementationType));throw new Error(c)}}i.forEach((function(t){Pe(e,!1,t.serviceIdentifier,o,n,t)}))}}))}function Ne(e,t){var n=[],o=Te(e);return o.hasKey(t)?n=o.get(t):null!==e.parent&&(n=Ne(e.parent,t)),n}S.getBindingDictionary=Te,S.plan=function(e,t,n,o,i,r,s,a){void 0===a&&(a=!1);var c=new Ee.Context(t),u=function(e,t,n,o,i,r){var s=e?me.MULTI_INJECT_TAG:me.INJECT_TAG,a=new Ce.Metadata(s,n),c=new Ae.Target(t,o,n,a);if(void 0!==i){var u=new Ce.Metadata(i,r);c.metadata.push(u)}return c}(n,o,i,"",r,s);try{return Pe(e,a,i,c,null,u),c}catch(e){throw be.isStackOverflowExeption(e)&&c.plan&&_e.circularDependencyToException(c.plan.rootRequest),e}},S.createMockRequest=function(e,t,n,o){var i=new Ae.Target(ye.TargetTypeEnum.Variable,"",t,new Ce.Metadata(n,o)),r=new Ee.Context(e);return new xe.Request(t,r,null,[],i)};var Ie={},ke={},Me=f&&f.__spreadArray||function(e,t){for(var n=0,o=t.length,i=e.length;n<o;n++,i++)e[i]=t[n];return e};Object.defineProperty(ke,"__esModule",{value:!0}),ke.resolveInstance=void 0;var De=O,je=m,Re=g;ke.resolveInstance=function(e,t,n){var o,i,r=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===je.TargetTypeEnum.ConstructorArgument})).map(n);i=s,r=function(e,t,n){var o=t.filter((function(e){return null!==e.target&&e.target.type===je.TargetTypeEnum.ClassProperty})),i=o.map(n);return o.forEach((function(t,n){var o;o=t.target.name.value();var r=i[n];e[o]=r})),e}(r=new((o=e).bind.apply(o,Me([void 0],i))),t,n)}else r=new e;return function(e,t){if(Reflect.hasMetadata(Re.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(Re.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(De.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,r),r},Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.resolve=void 0;var Ge=O,Fe=m,Ue=N,Le=k,Be=ke,He=function(e,t,n){try{return n()}catch(n){throw Ue.isStackOverflowExeption(n)?new Error(Ge.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},Ve=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,o=t.childRequests,i=t.target&&t.target.isArray(),r=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(i&&r)return o.map((function(t){return Ve(e)(t)}));var s=null;if(!t.target.isOptional()||0!==n.length){var a=n[0],c=a.scope===Fe.BindingScopeEnum.Singleton,u=a.scope===Fe.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&null!==e&&e.has(a.id))return e.get(a.id);if(a.type===Fe.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===Fe.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===Fe.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===Fe.BindingTypeEnum.DynamicValue&&null!==a.dynamicValue)s=He("toDynamicValue",a.serviceIdentifier,(function(){return a.dynamicValue(t.parentContext)}));else if(a.type===Fe.BindingTypeEnum.Factory&&null!==a.factory)s=He("toFactory",a.serviceIdentifier,(function(){return a.factory(t.parentContext)}));else if(a.type===Fe.BindingTypeEnum.Provider&&null!==a.provider)s=He("toProvider",a.serviceIdentifier,(function(){return a.provider(t.parentContext)}));else{if(a.type!==Fe.BindingTypeEnum.Instance||null===a.implementationType){var d=Le.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(Ge.INVALID_BINDING_TYPE+" "+d)}s=Be.resolveInstance(a.implementationType,o,Ve(e))}return"function"==typeof a.onActivation&&(s=a.onActivation(t.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&null!==e&&!e.has(a.id)&&e.set(a.id,s),s}}};Ie.resolve=function(e){return Ve(e.plan.rootRequest.requestScope)(e.plan.rootRequest)};var Xe={},ze={},Ke={},We={},Ye={},qe={},$e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.typeConstraint=$e.namedConstraint=$e.taggedConstraint=$e.traverseAncerstors=void 0;var Je=g,Ze=L,Qe=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||Qe(n,t))};$e.traverseAncerstors=Qe;var et=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new Ze.Metadata(e,t),n}};$e.taggedConstraint=et;var tt=et(Je.NAMED_TAG);$e.namedConstraint=tt;$e.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var o=t.bindings[0].implementationType;return e===o}return!1}},Object.defineProperty(qe,"__esModule",{value:!0}),qe.BindingWhenSyntax=void 0;var nt=Ye,ot=$e,it=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new nt.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=ot.namedConstraint(e),new nt.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new nt.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=ot.taggedConstraint(e)(t),new nt.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return ot.typeConstraint(e)(t.parentRequest)},new nt.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return ot.namedConstraint(e)(t.parentRequest)},new nt.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return ot.taggedConstraint(e)(t)(n.parentRequest)},new nt.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return ot.traverseAncerstors(t,ot.typeConstraint(e))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!ot.traverseAncerstors(t,ot.typeConstraint(e))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return ot.traverseAncerstors(t,ot.namedConstraint(e))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!ot.traverseAncerstors(t,ot.namedConstraint(e))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return ot.traverseAncerstors(n,ot.taggedConstraint(e)(t))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!ot.traverseAncerstors(n,ot.taggedConstraint(e)(t))},new nt.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return ot.traverseAncerstors(t,e)},new nt.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!ot.traverseAncerstors(t,e)},new nt.BindingOnSyntax(this._binding)},e}();qe.BindingWhenSyntax=it,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.BindingOnSyntax=void 0;var rt=qe,st=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new rt.BindingWhenSyntax(this._binding)},e}();Ye.BindingOnSyntax=st,Object.defineProperty(We,"__esModule",{value:!0}),We.BindingWhenOnSyntax=void 0;var at=Ye,ct=qe,ut=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new ct.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new at.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();We.BindingWhenOnSyntax=ut,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.BindingInSyntax=void 0;var dt=m,lt=We,ht=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=dt.BindingScopeEnum.Request,new lt.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=dt.BindingScopeEnum.Singleton,new lt.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=dt.BindingScopeEnum.Transient,new lt.BindingWhenOnSyntax(this._binding)},e}();Ke.BindingInSyntax=ht,Object.defineProperty(ze,"__esModule",{value:!0}),ze.BindingInWhenOnSyntax=void 0;var ft=Ke,pt=Ye,gt=qe,vt=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new gt.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new pt.BindingOnSyntax(this._binding),this._bindingInSyntax=new ft.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();ze.BindingInWhenOnSyntax=vt,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.BindingToSyntax=void 0;var yt=O,mt=m,bt=ze,_t=We,Et=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=mt.BindingTypeEnum.Instance,this._binding.implementationType=e,new bt.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+yt.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=mt.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=mt.BindingScopeEnum.Singleton,new _t.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=mt.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new bt.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=mt.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=mt.BindingScopeEnum.Singleton,new _t.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=mt.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=mt.BindingScopeEnum.Singleton,new _t.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(yt.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=mt.BindingTypeEnum.Function,this._binding.scope=mt.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=mt.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=mt.BindingScopeEnum.Singleton,new _t.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=mt.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=mt.BindingScopeEnum.Singleton,new _t.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();Xe.BindingToSyntax=Et;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.ContainerSnapshot=void 0;var wt=function(){function e(){}return e.of=function(t,n){var o=new e;return o.bindings=t,o.middleware=n,o},e}();Ct.ContainerSnapshot=wt;var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.Lookup=void 0;var xt=O,At=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(xt.NULL_ARGUMENT);if(null==t)throw new Error(xt.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(xt.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(xt.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(xt.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(xt.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,o){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(o,i):t._map.delete(o)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(xt.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();Ot.Lookup=At;var Tt=f&&f.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},St=f&&f.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},Pt=f&&f.__spreadArray||function(e,t){for(var n=0,o=t.length,i=e.length;n<o;n++,i++)e[i]=t[n];return e};Object.defineProperty(v,"__esModule",{value:!0}),v.Container=void 0;var Nt=y,It=O,kt=m,Mt=g,Dt=x,jt=S,Rt=Ie,Gt=Xe,Ft=b,Ut=k,Lt=Ct,Bt=Ot,Ht=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+It.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=kt.BindingScopeEnum.Transient;else if(t.defaultScope!==kt.BindingScopeEnum.Singleton&&t.defaultScope!==kt.BindingScopeEnum.Transient&&t.defaultScope!==kt.BindingScopeEnum.Request)throw new Error(""+It.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+It.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+It.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=Ft.id(),this._bindingDictionary=new Bt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Dt.MetadataReader}return e.merge=function(t,n){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var r=new e,s=Pt([t,n],o).map((function(e){return jt.getBindingDictionary(e)})),a=jt.getBindingDictionary(r);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,a)})),r},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),o=0,i=e;o<i.length;o++){var r=i[o],s=n(r.id);r.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Tt(this,void 0,void 0,(function(){var t,n,o,i,r;return St(this,(function(s){switch(s.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,o=e,s.label=1;case 1:return n<o.length?(i=o[n],r=t(i.id),[4,i.registry(r.bindFunction,r.unbindFunction,r.isboundFunction,r.rebindFunction)]):[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=o(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||kt.BindingScopeEnum.Transient,n=new Nt.Binding(e,t);return this._bindingDictionary.add(e,n),new Gt.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(It.CANNOT_UNBIND+" "+Ut.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new Bt.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Mt.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var o=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),r=jt.createMockRequest(this,e,t,n);o=i.some((function(e){return e.constraint(r)}))}return!o&&this.parent&&(o=this.parent.isBoundTagged(e,t,n)),o},e.prototype.snapshot=function(){this._snapshots.push(Lt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(It.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,kt.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,kt.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,Mt.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,kt.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,kt.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Mt.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(o){var i=e.rebind.bind(e)(o);return t(i,n),i}};return function(o){return{bindFunction:(i=o,function(n){var o=e.bind.bind(e)(n);return t(o,i),o}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(o),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,o,i,r){var s=null,a={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:o,targetType:n,value:r};if(this._middleware){if(null==(s=this._middleware(a)))throw new Error(It.INVALID_MIDDLEWARE_RETURN)}else s=this._planAndResolve()(a);return s},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=jt.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),Rt.resolve(n)}},e}();v.Container=Ht;var Vt={};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.AsyncContainerModule=Vt.ContainerModule=void 0;var Xt=b,zt=function(e){this.id=Xt.id(),this.registry=e};Vt.ContainerModule=zt;var Kt=function(e){this.id=Xt.id(),this.registry=e};Vt.AsyncContainerModule=Kt;var Wt={};Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.injectable=void 0;var Yt=O,qt=g;Wt.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(qt.PARAM_TYPES,e))throw new Error(Yt.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(qt.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(qt.PARAM_TYPES,t,e),e}};var $t={};Object.defineProperty($t,"__esModule",{value:!0}),$t.tagged=void 0;var Jt=L,Zt=W;$t.tagged=function(e,t){return function(n,o,i){var r=new Jt.Metadata(e,t);"number"==typeof i?Zt.tagParameter(n,o,i,r):Zt.tagProperty(n,o,r)}};var Qt={};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.named=void 0;var en=g,tn=L,nn=W;Qt.named=function(e){return function(t,n,o){var i=new tn.Metadata(en.NAMED_TAG,e);"number"==typeof o?nn.tagParameter(t,n,o,i):nn.tagProperty(t,n,i)}};var on={};Object.defineProperty(on,"__esModule",{value:!0}),on.optional=void 0;var rn=g,sn=L,an=W;on.optional=function(){return function(e,t,n){var o=new sn.Metadata(rn.OPTIONAL_TAG,!0);"number"==typeof n?an.tagParameter(e,t,n,o):an.tagProperty(e,t,o)}};var cn={};Object.defineProperty(cn,"__esModule",{value:!0}),cn.unmanaged=void 0;var un=g,dn=L,ln=W;cn.unmanaged=function(){return function(e,t,n){var o=new dn.Metadata(un.UNMANAGED_TAG,!0);ln.tagParameter(e,t,n,o)}};var hn={};Object.defineProperty(hn,"__esModule",{value:!0}),hn.multiInject=void 0;var fn=g,pn=L,gn=W;hn.multiInject=function(e){return function(t,n,o){var i=new pn.Metadata(fn.MULTI_INJECT_TAG,e);"number"==typeof o?gn.tagParameter(t,n,o,i):gn.tagProperty(t,n,i)}};var vn={};Object.defineProperty(vn,"__esModule",{value:!0}),vn.targetName=void 0;var yn=g,mn=L,bn=W;vn.targetName=function(e){return function(t,n,o){var i=new mn.Metadata(yn.NAME_TAG,e);bn.tagParameter(t,n,o,i)}};var _n={};Object.defineProperty(_n,"__esModule",{value:!0}),_n.postConstruct=void 0;var En=O,Cn=g,wn=L;_n.postConstruct=function(){return function(e,t,n){var o=new wn.Metadata(Cn.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(Cn.POST_CONSTRUCT,e.constructor))throw new Error(En.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Cn.POST_CONSTRUCT,o,e.constructor)}};var On={};Object.defineProperty(On,"__esModule",{value:!0}),On.multiBindToService=void 0;var xn,An,Tn;function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sn(Object(n),!0).forEach((function(t){Dn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nn(e){return Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nn(e)}function In(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mn(e,t,n){return t&&kn(e.prototype,t),n&&kn(e,n),e}function Dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jn(e){return function(e){if(Array.isArray(e))return Rn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */()}function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Gn(e,t){return t.lifecycle===An.Lifecycle.singleton?function(e){return e.inSingletonScope()}(e):function(e){return e.inTransientScope()}(e)}function Fn(e,t){e.whenTargetNamed(Bn(t))}function Un(e,t){return t.container.bind(Hn(e))}function Ln(e,t){var n=t.container.parent,o=n&&n.isBound(Hn(e));return t.container.isBound(Hn(e))&&!o?t.container.rebind(Hn(e)):t.container.bind(Hn(e))}function Bn(e){return Tn.isDefinedToken(e)?e.symbol:e}function Hn(e){return Tn.isDefinedToken(e)?e.symbol:e}On.multiBindToService=function(e){return function(t){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return n.forEach((function(n){return e.bind(n).toService(t)}))}}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=e.getServiceIdentifierAsString=e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=e.decorate=e.id=e.MetadataReader=e.postConstruct=e.targetName=e.multiInject=e.unmanaged=e.optional=e.LazyServiceIdentifer=e.inject=e.named=e.tagged=e.injectable=e.ContainerModule=e.AsyncContainerModule=e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=e.Container=e.METADATA_KEY=void 0;var t=g;e.METADATA_KEY=t;var n=v;Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return n.Container}});var o=m;Object.defineProperty(e,"BindingScopeEnum",{enumerable:!0,get:function(){return o.BindingScopeEnum}}),Object.defineProperty(e,"BindingTypeEnum",{enumerable:!0,get:function(){return o.BindingTypeEnum}}),Object.defineProperty(e,"TargetTypeEnum",{enumerable:!0,get:function(){return o.TargetTypeEnum}});var i=Vt;Object.defineProperty(e,"AsyncContainerModule",{enumerable:!0,get:function(){return i.AsyncContainerModule}}),Object.defineProperty(e,"ContainerModule",{enumerable:!0,get:function(){return i.ContainerModule}});var r=Wt;Object.defineProperty(e,"injectable",{enumerable:!0,get:function(){return r.injectable}});var s=$t;Object.defineProperty(e,"tagged",{enumerable:!0,get:function(){return s.tagged}});var a=Qt;Object.defineProperty(e,"named",{enumerable:!0,get:function(){return a.named}});var c=K;Object.defineProperty(e,"inject",{enumerable:!0,get:function(){return c.inject}}),Object.defineProperty(e,"LazyServiceIdentifer",{enumerable:!0,get:function(){return c.LazyServiceIdentifer}});var u=on;Object.defineProperty(e,"optional",{enumerable:!0,get:function(){return u.optional}});var d=cn;Object.defineProperty(e,"unmanaged",{enumerable:!0,get:function(){return d.unmanaged}});var l=hn;Object.defineProperty(e,"multiInject",{enumerable:!0,get:function(){return l.multiInject}});var h=vn;Object.defineProperty(e,"targetName",{enumerable:!0,get:function(){return h.targetName}});var f=_n;Object.defineProperty(e,"postConstruct",{enumerable:!0,get:function(){return f.postConstruct}});var p=x;Object.defineProperty(e,"MetadataReader",{enumerable:!0,get:function(){return p.MetadataReader}});var y=b;Object.defineProperty(e,"id",{enumerable:!0,get:function(){return y.id}});var _=W;Object.defineProperty(e,"decorate",{enumerable:!0,get:function(){return _.decorate}});var E=$e;Object.defineProperty(e,"traverseAncerstors",{enumerable:!0,get:function(){return E.traverseAncerstors}}),Object.defineProperty(e,"taggedConstraint",{enumerable:!0,get:function(){return E.taggedConstraint}}),Object.defineProperty(e,"namedConstraint",{enumerable:!0,get:function(){return E.namedConstraint}}),Object.defineProperty(e,"typeConstraint",{enumerable:!0,get:function(){return E.typeConstraint}});var C=k;Object.defineProperty(e,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return C.getServiceIdentifierAsString}});var w=On;Object.defineProperty(e,"multiBindToService",{enumerable:!0,get:function(){return w.multiBindToService}})}(p),function(e){!function(t){var n="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=i(e);function i(e,t){return function(n,o){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:o}),t&&t(n,o)}}void 0===n.Reflect?n.Reflect=e:o=i(n.Reflect,o),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,o=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!r&&!s,c={create:r?function(){return oe(Object.create(null))}:s?function(){return oe({__proto__:null})}:function(){return oe({})},has:a?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:a?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,l=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,h=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,f=new(d||"function"!=typeof WeakMap?ne():WeakMap);function p(e,t,n,o){if(j(n)){if(!X(e))throw new TypeError;if(!K(t))throw new TypeError;return O(e,t)}if(!X(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(o)&&!j(o)&&!R(o))throw new TypeError;return R(o)&&(o=void 0),x(e,t,n=V(n),o)}function g(e,t){function n(n,o){if(!F(n))throw new TypeError;if(!j(o)&&!W(o))throw new TypeError;I(e,t,n,o)}return n}function v(e,t,n,o){if(!F(n))throw new TypeError;return j(o)||(o=V(o)),I(e,t,n,o)}function y(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),T(e,t,n)}function m(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),S(e,t,n)}function b(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),P(e,t,n)}function _(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),N(e,t,n)}function E(e,t){if(!F(e))throw new TypeError;return j(t)||(t=V(t)),k(e,t)}function C(e,t){if(!F(e))throw new TypeError;return j(t)||(t=V(t)),M(e,t)}function w(e,t,n){if(!F(t))throw new TypeError;j(n)||(n=V(n));var o=A(t,n,!1);if(j(o))return!1;if(!o.delete(e))return!1;if(o.size>0)return!0;var i=f.get(t);return i.delete(n),i.size>0||f.delete(t),!0}function O(e,t){for(var n=e.length-1;n>=0;--n){var o=(0,e[n])(t);if(!j(o)&&!R(o)){if(!K(o))throw new TypeError;t=o}}return t}function x(e,t,n,o){for(var i=e.length-1;i>=0;--i){var r=(0,e[i])(t,n,o);if(!j(r)&&!R(r)){if(!F(r))throw new TypeError;o=r}}return o}function A(e,t,n){var o=f.get(e);if(j(o)){if(!n)return;o=new l,f.set(e,o)}var i=o.get(t);if(j(i)){if(!n)return;i=new l,o.set(t,i)}return i}function T(e,t,n){if(S(e,t,n))return!0;var o=Q(t);return!R(o)&&T(e,o,n)}function S(e,t,n){var o=A(t,n,!1);return!j(o)&&B(o.has(e))}function P(e,t,n){if(S(e,t,n))return N(e,t,n);var o=Q(t);return R(o)?void 0:P(e,o,n)}function N(e,t,n){var o=A(t,n,!1);if(!j(o))return o.get(e)}function I(e,t,n,o){A(n,o,!0).set(e,t)}function k(e,t){var n=M(e,t),o=Q(e);if(null===o)return n;var i=k(o,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var r=new h,s=[],a=0,c=n;a<c.length;a++){var u=c[a];r.has(u)||(r.add(u),s.push(u))}for(var d=0,l=i;d<l.length;d++){u=l[d];r.has(u)||(r.add(u),s.push(u))}return s}function M(e,t){var n=[],o=A(e,t,!1);if(j(o))return n;for(var i=q(o.keys()),r=0;;){var s=J(i);if(!s)return n.length=r,n;var a=$(s);try{n[r]=a}catch(e){try{Z(i)}finally{throw e}}r++}}function D(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function j(e){return void 0===e}function R(e){return null===e}function G(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function U(e,t){switch(D(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=Y(e,o);if(void 0!==i){var r=i.call(e,n);if(F(r))throw new TypeError;return r}return L(e,"default"===n?"number":n)}function L(e,t){if("string"===t){var n=e.toString;if(z(n))if(!F(i=n.call(e)))return i;if(z(o=e.valueOf))if(!F(i=o.call(e)))return i}else{var o;if(z(o=e.valueOf))if(!F(i=o.call(e)))return i;var i,r=e.toString;if(z(r))if(!F(i=r.call(e)))return i}throw new TypeError}function B(e){return!!e}function H(e){return""+e}function V(e){var t=U(e,3);return G(t)?t:H(t)}function X(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function z(e){return"function"==typeof e}function K(e){return"function"==typeof e}function W(e){switch(D(e)){case 3:case 4:return!0;default:return!1}}function Y(e,t){var n=e[t];if(null!=n){if(!z(n))throw new TypeError;return n}}function q(e){var t=Y(e,i);if(!z(t))throw new TypeError;var n=t.call(e);if(!F(n))throw new TypeError;return n}function $(e){return e.value}function J(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function Q(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,o=n&&Object.getPrototypeOf(n);if(null==o||o===Object.prototype)return t;var i=o.constructor;return"function"!=typeof i||i===e?t:i}function ee(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var o=this._keys.length,i=n+1;i<o;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,o)},t.prototype.values=function(){return new n(this._keys,this._values,r)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function o(e,t){return e}function r(e,t){return t}function s(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new l}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function ne(){var e=16,n=c.create(),o=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=r(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=r(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return r(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=r(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+u()}while(c.has(n,e));return n[e]=!0,e}function r(e,n){if(!t.call(e,o)){if(!n)return;Object.defineProperty(e,o,{value:c.create()})}return e[o]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function u(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",o=0;o<e;++o){var i=t[o];4!==o&&6!==o&&8!==o||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function oe(e){return e.__=void 0,delete e.__,e}e("decorate",p),e("metadata",g),e("defineMetadata",v),e("hasMetadata",y),e("hasOwnMetadata",m),e("getMetadata",b),e("getOwnMetadata",_),e("getMetadataKeys",E),e("getOwnMetadataKeys",C),e("deleteMetadata",w)}(o)}()}(xn||(xn={})),function(e){e.defineToken=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{multiple:!0};return new e.DefinedToken(t,n)};var t;e.DefinedToken=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};In(this,e),this.prototype={},this.name=void 0,this.multiple=void 0,this.symbol=void 0;var o=n.multiple,i=void 0!==o&&o;this.name=t,this.symbol=Symbol(this.name),this.multiple=i},e.isModule=function(e){return!!e&&"object"===Nn(e)&&"id"in e&&"registry"in e},function(e){e.singleton="singleton",e.transient="transient"}(t=e.Lifecycle||(e.Lifecycle={})),e.ClassOptionSymbol=Symbol("SyringeClassOptionSymbol"),e.DefaultOption={lifecycle:t.transient}}(An||(An={})),function(e){e.maybeArrayToArray=function(e){return e instanceof Array?e:void 0!==e?[e]:[]},e.isClass=function(e){return!(!e||"function"!=typeof e||!("prototype"in e))},e.isDefinedToken=function(e){return!!(e&&"object"===Nn(e)&&"symbol"in e&&"multiple"in e)},e.isInjectOption=function(e){return!(!e||"object"!==Nn(e)||!("token"in e))},e.isNamedToken=function(e){return!!(e&&"object"===Nn(e)&&"token"in e&&"named"in e)},e.isMultipleEnabled=function(t){return e.isDefinedToken(t)&&t.multiple}}(Tn||(Tn={}));var Vn=new p.Container;function Xn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=p.injectable();return function(n){Reflect.defineMetadata(An.ClassOptionSymbol,Pn(Pn({},e),{},{target:n}),n),t(n)}}function zn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Xn(Pn(Pn({},e),{},{lifecycle:An.Lifecycle.singleton}))}function Kn(e){return p.inject(Hn(e))}function Wn(e){return p.named(Bn(e))}var Yn=Symbol("SyringeOptionSymbol");var qn=function(){function e(t,n,o){In(this,e),this.token=void 0,this.rawToken=void 0,this.named=void 0,this.generalToken=void 0,this.option=void 0,this.context=void 0,this.mutiple=void 0,this.context=t,this.token=n,this.option=o,this.rawToken=Tn.isNamedToken(n)?n.token:n,this.named=Tn.isNamedToken(n)?n.named:void 0,this.mutiple=!!this.named||Tn.isMultipleEnabled(this.rawToken),this.generalToken=this.rawToken}return Mn(e,[{key:"resolve",value:function(){var e,t=this,n=this.context;(e=n)&&"object"===Nn(e)&&"container"in e&&"inversify"in e&&(this.mutiple?this.resolveMutilple(n):(this.resolveMono(n),!this.named&&this.option.contrib.length>0&&this.option.contrib.forEach((function(e){Tn.isMultipleEnabled(e)?Un(e,n).toService(t.generalToken):Ln(e,n).toService(t.generalToken)}))))}},{key:"resolveMono",value:function(e){var t=this;if("useValue"in this.option)return Ln(this.generalToken,e).toConstantValue(this.option.useValue);if(this.option.useDynamic.length>0){var n=this.option.useDynamic[this.option.useDynamic.length-1];return Gn(Ln(this.generalToken,e).toDynamicValue((function(){return n({container:t.context})})),this.option)}if(this.option.useFactory.length>0){var o=this.option.useFactory[this.option.useFactory.length-1];return Ln(this.generalToken,e).toFactory((function(){return o({container:t.context})}))}if(this.option.useClass.length>0){var i=this.option.useClass[this.option.useClass.length-1];return Gn(Ln(this.generalToken,e).to(i),this.option)}}},{key:"resolveMutilple",value:function(e){var t=this,n=this.option.useClass.map((function(n){return Gn(Un(t.generalToken,e).to(n),t.option)})),o=this.option.useDynamic.map((function(n){return Gn(Un(t.generalToken,e).toDynamicValue((function(){return n({container:t.context})})),t.option)})),i=this.option.useFactory.map((function(n){return Un(t.generalToken,e).toFactory((function(){return n({container:t.context})}))})),r="useValue"in this.option?Un(this.generalToken,e).toConstantValue(this.option.useValue):void 0;this.named&&(n.forEach((function(e){return t.named&&Fn(e,t.named)})),o.forEach((function(e){return t.named&&Fn(e,t.named)})),i.forEach((function(e){return t.named&&Fn(e,t.named)})),r&&Fn(r,this.named))}}],[{key:"resolveTarget",value:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{try{var i=Reflect.getMetadata(Yn,n);i&&e.resolveOption(t,i)}catch(e){}if(Tn.isClass(n))if(o.useClass){var r=Tn.maybeArrayToArray(o.useClass);r.unshift(n),o.useClass=r}else o.useClass=[n];var s;try{s=Reflect.getMetadata(An.ClassOptionSymbol,n)}catch(e){}if((s=Pn(Pn({},s||{}),o)).token){var a=Tn.maybeArrayToArray(s.token);a.unshift(n),s.token=a}else s.token=[n];e.resolveOption(t,s)}catch(e){}}},{key:"resolveOption",value:function(t,n){var o=function(e){var t=Tn.maybeArrayToArray(e.token),n=Tn.maybeArrayToArray(e.useClass),o=Tn.maybeArrayToArray(e.useDynamic),i=Tn.maybeArrayToArray(e.useFactory),r=Tn.maybeArrayToArray(e.contrib),s=e.lifecycle||An.Lifecycle.transient,a={token:t,useClass:n,lifecycle:r.length>0?An.Lifecycle.singleton:s,contrib:r,useDynamic:o,useFactory:i};return"useValue"in e&&(a.useValue=e.useValue),a}(Pn(Pn({},e.globalConfig),n));(0!==o.useClass.length||0!==o.useDynamic.length||0!==o.useFactory.length||"useValue"in o)&&o.token.forEach((function(n){new e(t,n,Pn({},o)).resolve()}))}}]),e}();qn.globalConfig=An.DefaultOption;var $n=function(){function e(t){In(this,e),this.loadedModules=[],this.container=void 0,this.inversify=!0,this.parent=void 0,this.container=t||new p.Container}return Mn(e,[{key:"load",value:function(e,t){!t&&this.loadedModules.includes(e.id)||(e.registry(this.register.bind(this),this.resolveContext()),this.loadedModules.push(e.id))}},{key:"remove",value:function(e){return this.container.unbind(Hn(e))}},{key:"get",value:function(e){return this.container.get(Hn(e))}},{key:"getNamed",value:function(e,t){return this.container.getNamed(Hn(e),Bn(t))}},{key:"getAll",value:function(e){return this.container.getAll(Hn(e))}},{key:"getAllNamed",value:function(e,t){return this.container.getAllNamed(Hn(e),Bn(t))}},{key:"isBound",value:function(e){return this.container.isBound(Hn(e))}},{key:"isBoundNamed",value:function(e,t){return this.container.isBoundNamed(Hn(e),Bn(t))}},{key:"createChild",value:function(){var t=new e(this.container.createChild());return t.parent=this,t}},{key:"register",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Tn.isInjectOption(e)?qn.resolveOption(this,e):qn.resolveTarget(this,e,t)}},{key:"resolveContext",value:function(){return{container:this}}}],[{key:"config",value:function(e){qn.globalConfig=e}}]),e}(),Jn=new $n(Vn),Zn=Jn.register.bind(Jn),Qn=An.defineToken("ContributionProvider"),eo=function(){function e(t,n,o){In(this,e),this.option={recursive:!1,cache:!0},this.services=void 0,this.serviceIdentifier=void 0,this.container=void 0,this.container=n,this.serviceIdentifier=t,o&&(this.option=Pn(Pn({},this.option),o))}return Mn(e,[{key:"setServices",value:function(e){for(var t=[],n=this.container;n;){if(n.isBound(this.serviceIdentifier)){var o=n.getAll(this.serviceIdentifier);t.push.apply(t,jn(o))}n=e?n.parent:void 0}return t}},{key:"getContributions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Pn(Pn({},this.option),e),n=t.cache,o=t.recursive;return n&&void 0!==this.services||(this.services=this.setServices(!!o)),this.services}}]),e}();function to(e,t){return{token:{token:Qn,named:e},useDynamic:function(n){return new eo(e,n.container,t)},lifecycle:An.Lifecycle.singleton}}function no(e,t,n){e({token:{token:Qn,named:t},useDynamic:function(e){return new eo(t,e.container,n)},lifecycle:An.Lifecycle.singleton})}var oo=function(){function e(t){In(this,e),this.id=void 0,this.baseRegistry=void 0,this.optionCollection=void 0,e.moduleId+=1,this.id=e.moduleId,this.baseRegistry=t}return Mn(e,[{key:"registry",get:function(){var e=this;return function(t,n){e.baseRegistry&&e.baseRegistry(t,n),e.optionCollection&&e.optionCollection.forEach((function(e){return t(e)}))}}},{key:"options",get:function(){return this.optionCollection||(this.optionCollection=[]),this.optionCollection}},{key:"register",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return n.forEach((function(t){return e.options.push(t)})),this}},{key:"contribution",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return n.forEach((function(t){return e.options.push(to(t))})),this}}]),e}();function io(e){return new oo(e)}oo.moduleId=0;var ro,so=function(e){return function(t,n,o){Wn(e)(t,n,o),Kn(Qn)(t,n,o)}};!function(e){e.Provider=Qn,e.register=no}(ro||(ro={}));var ao,co,uo,lo=Object.freeze({__proto__:null,Container:$n,get Contribution(){return ro},DefaultContributionProvider:eo,GlobalContainer:Jn,Module:io,OptionSymbol:Yn,Provider:Qn,get Syringe(){return An},SyringeModule:oo,get Utils(){return Tn},contrib:so,inject:Kn,injectable:Xn,named:Wn,register:Zn,registerSideOption:function(e,t){Reflect.defineMetadata(Yn,e,t)},singleton:zn,transient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Xn(Pn(Pn({},e),{},{lifecycle:An.Lifecycle.transient}))},decorate:p.decorate,optional:p.optional,postConstruct:p.postConstruct,unmanaged:p.unmanaged});e.NsGraph=void 0,ao=e.NsGraph||(e.NsGraph={}),(co=ao.AnchorGroup||(ao.AnchorGroup={})).TOP="top",co.BOTTOM="bottom",co.RIGHT="right",co.LEFT="left",(uo=ao.AnchorType||(ao.AnchorType={})).INPUT="input",uo.OUTPUT="output";
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
var ho=function(e,t){return ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ho(e,t)};function fo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ho(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function po(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function go(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function vo(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}var yo={exports:{}};
/*!
	  Copyright (c) 2018 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/!function(e){!function(){var t={}.hasOwnProperty;function n(){for(var e=[],o=0;o<arguments.length;o++){var i=arguments[o];if(i){var r=typeof i;if("string"===r||"number"===r)e.push(i);else if(Array.isArray(i)){if(i.length){var s=n.apply(null,i);s&&e.push(s)}}else if("object"===r)if(i.toString===Object.prototype.toString)for(var a in i)t.call(i,a)&&i[a]&&e.push(a);else e.push(i.toString())}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):window.classNames=n}()}(yo);var mo,bo,_o,Eo=yo.exports;
/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function Co(e){return Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Co(e)}function wo(e,t,n,o,i,r,s){try{var a=e[r](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,i)}function Oo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ao(e,t,n){return t&&xo(e.prototype,t),n&&xo(e,n),e}function To(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function So(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return To(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?To(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}!function(e){!function(t){var n="object"==typeof f?f:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=i(e);function i(e,t){return function(n,o){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:o}),t&&t(n,o)}}void 0===n.Reflect?n.Reflect=e:o=i(n.Reflect,o),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,o=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",r="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!r&&!s,c={create:r?function(){return oe(Object.create(null))}:s?function(){return oe({__proto__:null})}:function(){return oe({})},has:a?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:a?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,l=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,h=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,f=new(d||"function"!=typeof WeakMap?ne():WeakMap);function p(e,t,n,o){if(j(n)){if(!X(e))throw new TypeError;if(!K(t))throw new TypeError;return O(e,t)}if(!X(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(o)&&!j(o)&&!R(o))throw new TypeError;return R(o)&&(o=void 0),x(e,t,n=V(n),o)}function g(e,t){function n(n,o){if(!F(n))throw new TypeError;if(!j(o)&&!W(o))throw new TypeError;I(e,t,n,o)}return n}function v(e,t,n,o){if(!F(n))throw new TypeError;return j(o)||(o=V(o)),I(e,t,n,o)}function y(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),T(e,t,n)}function m(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),S(e,t,n)}function b(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),P(e,t,n)}function _(e,t,n){if(!F(t))throw new TypeError;return j(n)||(n=V(n)),N(e,t,n)}function E(e,t){if(!F(e))throw new TypeError;return j(t)||(t=V(t)),k(e,t)}function C(e,t){if(!F(e))throw new TypeError;return j(t)||(t=V(t)),M(e,t)}function w(e,t,n){if(!F(t))throw new TypeError;j(n)||(n=V(n));var o=A(t,n,!1);if(j(o))return!1;if(!o.delete(e))return!1;if(o.size>0)return!0;var i=f.get(t);return i.delete(n),i.size>0||f.delete(t),!0}function O(e,t){for(var n=e.length-1;n>=0;--n){var o=(0,e[n])(t);if(!j(o)&&!R(o)){if(!K(o))throw new TypeError;t=o}}return t}function x(e,t,n,o){for(var i=e.length-1;i>=0;--i){var r=(0,e[i])(t,n,o);if(!j(r)&&!R(r)){if(!F(r))throw new TypeError;o=r}}return o}function A(e,t,n){var o=f.get(e);if(j(o)){if(!n)return;o=new l,f.set(e,o)}var i=o.get(t);if(j(i)){if(!n)return;i=new l,o.set(t,i)}return i}function T(e,t,n){if(S(e,t,n))return!0;var o=Q(t);return!R(o)&&T(e,o,n)}function S(e,t,n){var o=A(t,n,!1);return!j(o)&&B(o.has(e))}function P(e,t,n){if(S(e,t,n))return N(e,t,n);var o=Q(t);return R(o)?void 0:P(e,o,n)}function N(e,t,n){var o=A(t,n,!1);if(!j(o))return o.get(e)}function I(e,t,n,o){A(n,o,!0).set(e,t)}function k(e,t){var n=M(e,t),o=Q(e);if(null===o)return n;var i=k(o,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var r=new h,s=[],a=0,c=n;a<c.length;a++){var u=c[a];r.has(u)||(r.add(u),s.push(u))}for(var d=0,l=i;d<l.length;d++){u=l[d];r.has(u)||(r.add(u),s.push(u))}return s}function M(e,t){var n=[],o=A(e,t,!1);if(j(o))return n;for(var i=q(o.keys()),r=0;;){var s=J(i);if(!s)return n.length=r,n;var a=$(s);try{n[r]=a}catch(e){try{Z(i)}finally{throw e}}r++}}function D(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function j(e){return void 0===e}function R(e){return null===e}function G(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function U(e,t){switch(D(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=Y(e,o);if(void 0!==i){var r=i.call(e,n);if(F(r))throw new TypeError;return r}return L(e,"default"===n?"number":n)}function L(e,t){if("string"===t){var n=e.toString;if(z(n))if(!F(i=n.call(e)))return i;if(z(o=e.valueOf))if(!F(i=o.call(e)))return i}else{var o;if(z(o=e.valueOf))if(!F(i=o.call(e)))return i;var i,r=e.toString;if(z(r))if(!F(i=r.call(e)))return i}throw new TypeError}function B(e){return!!e}function H(e){return""+e}function V(e){var t=U(e,3);return G(t)?t:H(t)}function X(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function z(e){return"function"==typeof e}function K(e){return"function"==typeof e}function W(e){switch(D(e)){case 3:case 4:return!0;default:return!1}}function Y(e,t){var n=e[t];if(null!=n){if(!z(n))throw new TypeError;return n}}function q(e){var t=Y(e,i);if(!z(t))throw new TypeError;var n=t.call(e);if(!F(n))throw new TypeError;return n}function $(e){return e.value}function J(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function Q(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,o=n&&Object.getPrototypeOf(n);if(null==o||o===Object.prototype)return t;var i=o.constructor;return"function"!=typeof i||i===e?t:i}function ee(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var o=this._keys.length,i=n+1;i<o;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,o)},t.prototype.values=function(){return new n(this._keys,this._values,r)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function o(e,t){return e}function r(e,t){return t}function s(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new l}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function ne(){var e=16,n=c.create(),o=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=r(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=r(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return r(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=r(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+u()}while(c.has(n,e));return n[e]=!0,e}function r(e,n){if(!t.call(e,o)){if(!n)return;Object.defineProperty(e,o,{value:c.create()})}return e[o]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function u(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",o=0;o<e;++o){var i=t[o];4!==o&&6!==o&&8!==o||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function oe(e){return e.__=void 0,delete e.__,e}e("decorate",p),e("metadata",g),e("defineMetadata",v),e("hasMetadata",y),e("hasOwnMetadata",m),e("getMetadata",b),e("getOwnMetadata",_),e("getMetadataKeys",E),e("getOwnMetadataKeys",C),e("deleteMetadata",w)}(o)}()}(mo||(mo={})),function(e){function t(e){return{dispose:e}}e.is=function(e){return!!e&&"object"===Co(e)&&"dispose"in e&&"function"==typeof e.dispose},e.create=t,e.NONE=t((function(){}))}(bo||(bo={})),function(e){e.None=function(){return bo.NONE},e.map=function(e,t){return function(n,o){return e((function(e){return n.call(o,t(e))}),void 0)}}}(_o||(_o={}));var Po=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Oo(this,t),this.mono=void 0,this._callbacks=void 0,this.mono=e}return Ao(t,[{key:"callbacks",get:function(){return this._callbacks||(this._callbacks=[]),this._callbacks}},{key:"length",get:function(){return this.callbacks.length}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.callbacks.push([e,t])}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!this.isEmpty()){for(var n=!1,o=0;o<this.length;o+=1)if(this.callbacks[o][0]===e){if(this.callbacks[o][1]===t)return void this.callbacks.splice(o,1);n=!0}if(n)throw new Error("You should remove it with the same context you add it")}}},{key:e,value:function(){return this.isEmpty()?[][Symbol.iterator]():this.callbacks.slice(0).map((function(e){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e[0].apply(e[1],n)}}))[Symbol.iterator]()}},{key:"invoke",value:function(){var e,t=[],n=So(this);try{for(n.s();!(e=n.n()).done;){var o=e.value;try{t.push(o.apply(void 0,arguments))}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"isEmpty",value:function(){return 0===this.callbacks.length}},{key:"dispose",value:function(){this._callbacks=void 0}}]),t}(Symbol.iterator),No=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Oo(this,e),this.options=void 0,this._event=void 0,this._callbacks=void 0,this.disposed=!1,this.options=t}var t;return Ao(e,[{key:"callbacks",get:function(){return this._callbacks||(this._callbacks=new Po),this._callbacks}},{key:"event",get:function(){var t=this;return this._event||(this._event=function(n,o){t.options.onFirstListenerAdd&&t.callbacks.isEmpty()&&t.options.onFirstListenerAdd(t),t.callbacks.add(n,o);var i={dispose:function(){i.dispose=e.noop,t.disposed||(t.callbacks.remove(n,o),i.dispose=e.noop,t.options.onLastListenerRemove&&t.callbacks.isEmpty()&&t.options.onLastListenerRemove(t))}};return i}),this._event}},{key:"fire",value:function(e){this._callbacks&&this.callbacks.invoke(e)}},{key:"sequence",value:(t=function(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var r=e.apply(t,n);function s(e){wo(r,o,i,s,a,"next",e)}function a(e){wo(r,o,i,s,a,"throw",e)}s(void 0)}))}}(regeneratorRuntime.mark((function e(t){var n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=So(this.callbacks),e.prev=1,n.s();case 3:if((o=n.n()).done){e.next=12;break}return i=o.value,e.next=7,t(i);case 7:if(e.sent){e.next=10;break}return e.abrupt("break",12);case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,14,17,20]])}))),function(e){return t.apply(this,arguments)})},{key:"dispose",value:function(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0),this.disposed=!0}}]),e}();No.noop=function(){};var Io,ko=Object.freeze(Object.assign((function(e,t){var n=setTimeout(e.bind(t),0);return{dispose:function(){clearTimeout(n)}}}),{maxListeners:0}));!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:_o.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:ko})}(Io||(Io={})),e.Disposable=void 0,function(e){function t(e){return{dispose:e}}e.is=function(e){return!!e&&"object"==typeof e&&"dispose"in e&&"function"==typeof e.dispose},e.create=t,e.NULL=t((()=>{}))}(e.Disposable||(e.Disposable={}));class Mo{constructor(...e){this.disposables=[],this.onDisposeEmitter=new No,this.disposingElements=!1,e.forEach((e=>this.push(e)))}get onDispose(){return this.onDisposeEmitter.event}checkDisposed(){this.disposed&&!this.disposingElements&&(this.onDisposeEmitter.fire(void 0),this.onDisposeEmitter.dispose())}get disposed(){return 0===this.disposables.length}dispose(){return vo(this,void 0,void 0,(function*(){if(!this.disposed&&!this.disposingElements){for(this.disposingElements=!0;!this.disposed;)try{const e=this.disposables.pop();yield e.dispose()}catch(e){console.error(e)}this.disposingElements=!1,this.checkDisposed()}}))}push(t){const{disposables:n}=this;n.push(t);const o=t.dispose.bind(t),i=e.Disposable.create((()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1),this.checkDisposed()}));return t.dispose=()=>{i.dispose(),o()},i}pushAll(e){return e.map((e=>this.push(e)))}}class Do{constructor(){this.isResolved=!1,this.isRejected=!1,this.promise=new Promise(((e,t)=>{this.resolve=(...t)=>{this.isResolved=!0,e(...t)},this.reject=(...e)=>{this.isRejected=!0,t(...e)}}))}}const jo="xflow",Ro=.01,Go="XFLOW_DEFAULT_NODE",Fo="XFLOW_DEFAULT_GROUP_NODE",Uo="XFLOW_DEFAULT_EDGE",Lo="XFLOW_COPY_ITEMS",Bo={width:180,height:36};var Ho=Object.freeze({__proto__:null,X6_NODE_PORTAL_NODE_VIEW:"X6_NODE_PORTAL_NODE_VIEW",XFLOW_PREFIX_CLS:jo,MIN_ZOOM:Ro,MAX_ZOOM:1.5,XFLOW_DEFAULT_NODE:Go,XFLOW_DEFAULT_GROUP_NODE:Fo,XFLOW_DEFAULT_EDGE:Uo,LOCAL_STORAGE_KEY:Lo,DEFAULT_NODE_HEIGHT:36,DEFAULT_NODE_WIDTH:180,XFLOW_GROUP_DEFAULT_COLLAPSED_SIZE:Bo});function Vo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}var Xo=t.createContext({});function zo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ko(Object(n),!0).forEach((function(t){zo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ko(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function qo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Yo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yo(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $o(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Jo(e){return Jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jo(e)}function Zo(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Qo(e){return e<=1?100*Number(e)+"%":e}function ei(e){return 1===e.length?"0"+e:String(e)}function ti(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function ni(e){return oi(e)/255}function oi(e){return parseInt(e,16)}var ii={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ri(e){var t={r:0,g:0,b:0},n=1,o=null,i=null,r=null,s=!1,a=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(ii[e])e=ii[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=ui.rgb.exec(e);if(n)return{r:n[1],g:n[2],b:n[3]};if(n=ui.rgba.exec(e))return{r:n[1],g:n[2],b:n[3],a:n[4]};if(n=ui.hsl.exec(e))return{h:n[1],s:n[2],l:n[3]};if(n=ui.hsla.exec(e))return{h:n[1],s:n[2],l:n[3],a:n[4]};if(n=ui.hsv.exec(e))return{h:n[1],s:n[2],v:n[3]};if(n=ui.hsva.exec(e))return{h:n[1],s:n[2],v:n[3],a:n[4]};if(n=ui.hex8.exec(e))return{r:oi(n[1]),g:oi(n[2]),b:oi(n[3]),a:ni(n[4]),format:t?"name":"hex8"};if(n=ui.hex6.exec(e))return{r:oi(n[1]),g:oi(n[2]),b:oi(n[3]),format:t?"name":"hex"};if(n=ui.hex4.exec(e))return{r:oi(n[1]+n[1]),g:oi(n[2]+n[2]),b:oi(n[3]+n[3]),a:ni(n[4]+n[4]),format:t?"name":"hex8"};if(n=ui.hex3.exec(e))return{r:oi(n[1]+n[1]),g:oi(n[2]+n[2]),b:oi(n[3]+n[3]),format:t?"name":"hex"};return!1}(e)),"object"==typeof e&&(di(e.r)&&di(e.g)&&di(e.b)?(t=function(e,t,n){return{r:255*Zo(e,255),g:255*Zo(t,255),b:255*Zo(n,255)}}(e.r,e.g,e.b),s=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):di(e.h)&&di(e.s)&&di(e.v)?(o=Qo(e.s),i=Qo(e.v),t=function(e,t,n){e=6*Zo(e,360),t=Zo(t,100),n=Zo(n,100);var o=Math.floor(e),i=e-o,r=n*(1-t),s=n*(1-i*t),a=n*(1-(1-i)*t),c=o%6;return{r:255*[n,s,r,r,a,n][c],g:255*[a,n,n,s,r,r][c],b:255*[r,r,a,n,n,s][c]}}(e.h,o,i),s=!0,a="hsv"):di(e.h)&&di(e.s)&&di(e.l)&&(o=Qo(e.s),r=Qo(e.l),t=function(e,t,n){var o,i,r;if(e=Zo(e,360),t=Zo(t,100),n=Zo(n,100),0===t)i=n,r=n,o=n;else{var s=n<.5?n*(1+t):n+t-n*t,a=2*n-s;o=ti(a,s,e+1/3),i=ti(a,s,e),r=ti(a,s,e-1/3)}return{r:255*o,g:255*i,b:255*r}}(e.h,o,r),s=!0,a="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=function(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}(n),{ok:s,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}var si="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",ai="[\\s|\\(]+("+si+")[,|\\s]+("+si+")[,|\\s]+("+si+")\\s*\\)?",ci="[\\s|\\(]+("+si+")[,|\\s]+("+si+")[,|\\s]+("+si+")[,|\\s]+("+si+")\\s*\\)?",ui={CSS_UNIT:new RegExp(si),rgb:new RegExp("rgb"+ai),rgba:new RegExp("rgba"+ci),hsl:new RegExp("hsl"+ai),hsla:new RegExp("hsla"+ci),hsv:new RegExp("hsv"+ai),hsva:new RegExp("hsva"+ci),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function di(e){return Boolean(ui.CSS_UNIT.exec(String(e)))}var li=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function hi(e){var t=function(e,t,n){e=Zo(e,255),t=Zo(t,255),n=Zo(n,255);var o=Math.max(e,t,n),i=Math.min(e,t,n),r=0,s=o,a=o-i,c=0===o?0:a/o;if(o===i)r=0;else{switch(o){case e:r=(t-n)/a+(t<n?6:0);break;case t:r=(n-e)/a+2;break;case n:r=(e-t)/a+4}r/=6}return{h:r,s:c,v:s}}(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function fi(e){var t=e.r,n=e.g,o=e.b;return"#".concat(function(e,t,n,o){var i=[ei(Math.round(e).toString(16)),ei(Math.round(t).toString(16)),ei(Math.round(n).toString(16))];return o&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}(t,n,o,!1))}function pi(e,t,n){var o=n/100;return{r:(t.r-e.r)*o+e.r,g:(t.g-e.g)*o+e.g,b:(t.b-e.b)*o+e.b}}function gi(e,t,n){var o;return(o=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-2*t:Math.round(e.h)+2*t:n?Math.round(e.h)+2*t:Math.round(e.h)-2*t)<0?o+=360:o>=360&&(o-=360),o}function vi(e,t,n){return 0===e.h&&0===e.s?e.s:((o=n?e.s-.16*t:4===t?e.s+.16:e.s+.05*t)>1&&(o=1),n&&5===t&&o>.1&&(o=.1),o<.06&&(o=.06),Number(o.toFixed(2)));var o}function yi(e,t,n){var o;return(o=n?e.v+.05*t:e.v-.15*t)>1&&(o=1),Number(o.toFixed(2))}function mi(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],o=ri(e),i=5;i>0;i-=1){var r=hi(o),s=fi(ri({h:gi(r,i,!0),s:vi(r,i,!0),v:yi(r,i,!0)}));n.push(s)}n.push(fi(o));for(var a=1;a<=4;a+=1){var c=hi(o),u=fi(ri({h:gi(c,a),s:vi(c,a),v:yi(c,a)}));n.push(u)}return"dark"===t.theme?li.map((function(e){var o=e.index,i=e.opacity;return fi(pi(ri(t.backgroundColor||"#141414"),ri(n[o]),100*i))})):n}var bi={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},_i={},Ei={};Object.keys(bi).forEach((function(e){_i[e]=mi(bi[e]),_i[e].primary=_i[e][5],Ei[e]=mi(bi[e],{theme:"dark",backgroundColor:"#141414"}),Ei[e].primary=Ei[e][5]})),_i.red,_i.volcano,_i.gold,_i.orange,_i.yellow,_i.lime,_i.green,_i.cyan,_i.blue,_i.geekblue,_i.purple,_i.magenta,_i.grey;var Ci={};function wi(e,t){}function Oi(e,t){!function(e,t,n){t||Ci[n]||(e(!1,n),Ci[n]=!0)}(wi,e,t)}function xi(){return!("undefined"==typeof window||!window.document||!window.document.createElement)}var Ai="rc-util-key";function Ti(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function Si(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!xi())return null;var o,i=document.createElement("style");(null===(t=n.csp)||void 0===t?void 0:t.nonce)&&(i.nonce=null===(o=n.csp)||void 0===o?void 0:o.nonce);i.innerHTML=e;var r=Ti(n),s=r.firstChild;return n.prepend&&r.prepend?r.prepend(i):n.prepend&&s?r.insertBefore(i,s):r.appendChild(i),i}var Pi=new Map;function Ni(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Ti(t);return Array.from(Pi.get(n).children).find((function(t){return"STYLE"===t.tagName&&t[Ai]===e}))}function Ii(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=Ti(n);if(!Pi.has(o)){var i=Si("",n),r=i.parentNode;Pi.set(o,r),r.removeChild(i)}var s=Ni(t,n);if(s){var a,c,u;if((null===(a=n.csp)||void 0===a?void 0:a.nonce)&&s.nonce!==(null===(c=n.csp)||void 0===c?void 0:c.nonce))s.nonce=null===(u=n.csp)||void 0===u?void 0:u.nonce;return s.innerHTML!==e&&(s.innerHTML=e),s}var d=Si(e,n);return d[Ai]=t,d}function ki(e){return"object"===Jo(e)&&"string"==typeof e.name&&"string"==typeof e.theme&&("object"===Jo(e.icon)||"function"==typeof e.icon)}function Mi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){var o=e[n];if("class"===n)t.className=o,delete t.class;else t[n]=o;return t}),{})}function Di(e,t,n){return n?u.default.createElement(e.tag,Wo(Wo({key:t},Mi(e.attrs)),n),(e.children||[]).map((function(n,o){return Di(n,"".concat(t,"-").concat(e.tag,"-").concat(o))}))):u.default.createElement(e.tag,Wo({key:t},Mi(e.attrs)),(e.children||[]).map((function(n,o){return Di(n,"".concat(t,"-").concat(e.tag,"-").concat(o))})))}function ji(e){return mi(e)[0]}function Ri(e){return e?Array.isArray(e)?e:[e]:[]}var Gi="\n.anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n",Fi=["icon","className","onClick","style","primaryColor","secondaryColor"],Ui={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};var Li=function(e){var n,o,i=e.icon,r=e.className,s=e.onClick,a=e.style,c=e.primaryColor,u=e.secondaryColor,d=$o(e,Fi),l=Ui;if(c&&(l={primaryColor:c,secondaryColor:u||ji(c)}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gi,n=t.useContext(Xo).csp;t.useEffect((function(){Ii(e,"@ant-design-icons",{prepend:!0,csp:n})}),[])}(),n=ki(i),o="icon should be icon definiton, but got ".concat(i),Oi(n,"[@ant-design/icons] ".concat(o)),!ki(i))return null;var h=i;return h&&"function"==typeof h.icon&&(h=Wo(Wo({},h),{},{icon:h.icon(l.primaryColor,l.secondaryColor)})),Di(h.icon,"svg-".concat(h.name),Wo({className:r,onClick:s,style:a,"data-icon":h.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},d))};Li.displayName="IconReact",Li.getTwoToneColors=function(){return Wo({},Ui)},Li.setTwoToneColors=function(e){var t=e.primaryColor,n=e.secondaryColor;Ui.primaryColor=t,Ui.secondaryColor=n||ji(t),Ui.calculated=!!n};var Bi=Li;function Hi(e){var t=qo(Ri(e),2),n=t[0],o=t[1];return Bi.setTwoToneColors({primaryColor:n,secondaryColor:o})}var Vi=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];Hi("#1890ff");var Xi=d.forwardRef((function(e,t){var n,o=e.className,i=e.icon,r=e.spin,s=e.rotate,a=e.tabIndex,c=e.onClick,u=e.twoToneColor,l=$o(e,Vi),h=d.useContext(Xo).prefixCls,f=void 0===h?"anticon":h,p=Eo(f,(zo(n={},"".concat(f,"-").concat(i.name),!!i.name),zo(n,"".concat(f,"-spin"),!!r||"loading"===i.name),n),o),g=a;void 0===g&&c&&(g=-1);var v=s?{msTransform:"rotate(".concat(s,"deg)"),transform:"rotate(".concat(s,"deg)")}:void 0,y=qo(Ri(u),2),m=y[0],b=y[1];return d.createElement("span",Wo(Wo({role:"img","aria-label":i.name},l),{},{ref:t,tabIndex:g,onClick:c,className:p}),d.createElement(Bi,{icon:i,primaryColor:m,secondaryColor:b,style:v}))}));Xi.displayName="AntdIcon",Xi.getTwoToneColor=function(){var e=Bi.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor},Xi.setTwoToneColor=Hi;var zi=Xi,Ki={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},Wi=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:Ki}))};Wi.displayName="CheckCircleOutlined";var Yi=d.forwardRef(Wi),qi={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670a8.32 8.32 0 00-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4 66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z"}},{tag:"path",attrs:{d:"M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448 448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"close-circle",theme:"outlined"},$i=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:qi}))};$i.displayName="CloseCircleOutlined";var Ji=d.forwardRef($i),Zi={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},Qi=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:Zi}))};Qi.displayName="DatabaseOutlined";var er=d.forwardRef(Qi),tr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},nr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:tr}))};nr.displayName="ExclamationCircleOutlined";var or=d.forwardRef(nr),ir={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},rr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:ir}))};rr.displayName="InfoCircleOutlined";var sr=d.forwardRef(rr),ar={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"minus-square",theme:"outlined"},cr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:ar}))};cr.displayName="MinusSquareOutlined";var ur=d.forwardRef(cr),dr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"plus-square",theme:"outlined"},lr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:dr}))};lr.displayName="PlusSquareOutlined";var hr=d.forwardRef(lr),fr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0130.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"question-circle",theme:"outlined"},pr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:fr}))};pr.displayName="QuestionCircleOutlined";var gr=d.forwardRef(pr),vr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},yr=function(e,t){return d.createElement(zi,Wo(Wo({},e),{},{ref:t,icon:vr}))};yr.displayName="RedoOutlined";var mr=d.forwardRef(yr);const br=u.default.createContext(null);br.displayName="XFlowAppContext";const _r=()=>{const e=u.default.useContext(br);return e&&e.getApp?e.getApp():null};class Er{constructor(e=!1){this.cache=null,this.setApp=e=>{this.cache=e,this.onAppChangeCallback&&this.onAppChangeCallback(e)},this.isUserDefined=()=>this.isUserDefinedFlag,this.getApp=()=>this.cache,this.onAppChange=e=>{this.onAppChangeCallback=e},this.dispose=()=>{this.cache=null},this.isUserDefinedFlag=e}}const Cr=e=>{const t=u.default.useContext(br),[,n]=u.default.useState(null),o=u.default.useMemo((()=>t&&t.isUserDefined()?t:new Er(!1)),[]);return o.isUserDefined()||o.onAppChange((()=>n(0))),u.default.useEffect((()=>{e.app&&o.setApp(e.app)}),[e.app]),o.isUserDefined()?u.default.createElement(u.default.Fragment,null,e.children):u.default.createElement(br.Provider,{value:Object.assign({},o)},e.children)};Cr.displayName="XFlowAppInternalProvider";const wr=({children:e})=>{const[,t]=u.default.useState(null),n=u.default.useMemo((()=>new Er(!0)),[]);return n.onAppChange((()=>t(0))),u.default.createElement(br.Provider,{value:Object.assign({},n)},e)};wr.displayName="XFlowAppProvider",e.XFlowNodeCommands=void 0,function(e){const t="节点操作";e.ADD_NODE={id:"xflow:add-node",label:"添加节点",category:t},e.DEL_NODE={id:"xflow:del-node",label:"删除节点",category:t},e.UPDATE_NODE_PORT={id:"xflow:update-node-port",label:"删除连接桩",category:t},e.UPDATE_NODE={id:"xflow:update-node",label:"更新节点",category:t},e.HIGHLIGHT_NODE={id:"xflow:highlight-node",label:"高亮节点",category:t},e.SELECT_NODE={id:"xflow:select-node",label:"选中节点",category:t},e.MOVE_NODE={id:"xflow:move-node",label:"Move Node",category:t},e.CENTER_NODE={id:"xflow:center-node",label:"居中节点",category:t},e.FRONT_NODE={id:"xflow:front-node",label:"前置节点",category:t},e.BACK_NODE={id:"xflow:back-node",label:"后置节点",category:t}}(e.XFlowNodeCommands||(e.XFlowNodeCommands={})),e.XFlowEdgeCommands=void 0,function(e){const t="边操作";e.ADD_EDGE={id:"xflow:add-edge",label:"添加边",category:t},e.DEL_EDGE={id:"xflow:del-edge",label:"删除边",category:t},e.UPDATE_EDGE={id:"xflow:update-edge",label:"更新边",category:t},e.HIGHLIGHT_EDGE={id:"xflow:highlight-edge",label:"高亮边",category:t},e.FRONT_EDGE={id:"xflow:front-edge",label:"前置变",category:t},e.BACK_EDGE={id:"xflow:back-edge",label:"后置边",category:t}}(e.XFlowEdgeCommands||(e.XFlowEdgeCommands={})),e.XFlowGraphCommands=void 0,function(e){const t="画布操作";e.LOAD_META={id:"xflow:load-meta",label:"获取元数据",category:t},e.LOAD_DATA={id:"xflow:load-data",label:"获取图数据",category:t},e.SAVE_GRAPH_DATA={id:"xflow:save-graph-data",label:"保存",category:t},e.GRAPH_LAYOUT={id:"xflow:layout",label:"计算布局",category:t},e.GRAPH_RENDER={id:"xflow:graph-render",label:"渲染画布",category:t},e.UNDO_CMD={id:"xflow:undo-cmd",label:"撤销",category:t},e.REDO_CMD={id:"xflow:redo-cmd",label:"重做",category:t},e.GRAPH_INSTANCE_COMMAND={id:"xflow:graph-instacne-cmd",label:"Graph通用Command",category:t},e.GRAPH_ZOOM={id:"xflow:graph-zoom",label:"缩放画布",category:t},e.GRAPH_RESIZE={id:"xflow:graph-resize",label:"调整窗口大小",category:t},e.GRAPH_COPY={id:"xflow:graph-copy-selection",label:"复制",category:t},e.GRAPH_PASTE={id:"xflow:graph-paste-selection",label:"粘贴",category:t},e.GRAPH_TOGGLE_MULTI_SELECT={id:"xflow:graph-toggle-multi-select",label:"启用框选",category:t},e.GRAPH_ADD_TOOL={id:"xflow:add-tool",label:"添加工具",category:t},e.GRAPH_DEL_TOOL={id:"xflow:del-tool",label:"删除工具",category:t},e.GRAPH_HISTORY_UNDO={id:"xflow:history-undo",label:"history undo",category:t},e.GRAPH_HISTORY_REDO={id:"xflow:history-redo",label:"history redo",category:t},e.GRAPH_HISTORY_RESET={id:"xflow:history-reset",label:"history reset",category:t},e.GRAPH_HISTORY_TOGGLE={id:"xflow:history-toggle",label:"history toggle",category:t}}(e.XFlowGraphCommands||(e.XFlowGraphCommands={})),e.XFlowModelCommands=void 0,(e.XFlowModelCommands||(e.XFlowModelCommands={})).UPDATE_MODEL={id:"xflow:update-model",label:"设置状态值",category:"状态操作"},e.XFlowGroupCommands=void 0,function(e){const t="群组操作";e.INIT_GROUP={id:"xflow:init-group",label:"初始化群组",category:t},e.ADD_GROUP={id:"xflow:add-group",label:"新建群组",category:t},e.DEL_GROUP={id:"xflow:del-group",label:"解散群组",category:t},e.COLLAPSE_GROUP={id:"xflow:collapse-group",label:"折叠群组",category:t}}(e.XFlowGroupCommands||(e.XFlowGroupCommands={}));const Or=t=>{const{cell:n}=t,o=_r(),i=t.data.isCollapsed||!1;return u.default.createElement("div",{className:"xflow-default-group-node"},u.default.createElement("div",{className:"xflow-group-header"},u.default.createElement("div",{className:"header-left"},t.data.label),u.default.createElement("div",{className:"header-right"},i&&u.default.createElement(hr,{onClick:t=>{t.preventDefault(),o.executeCommand(e.XFlowGroupCommands.COLLAPSE_GROUP.id,{nodeId:n.id,isCollapsed:!1})}}),!i&&u.default.createElement(ur,{onClick:t=>{t.preventDefault(),o.executeCommand(e.XFlowGroupCommands.COLLAPSE_GROUP.id,{nodeId:n.id,isCollapsed:!0,gap:3})}}))))};Or.displayName="XFlowDefaultGroupNode";const xr={fontSize:"16px",color:"#3057e3"};var Ar;!function(e){e.SUCCESS="success",e.PROCESSING="processing",e.ERROR="error",e.DEFAULT="default",e.WARNING="warning"}(Ar||(Ar={}));const Tr=e=>{if(e.hide)return null;switch(e.status){case Ar.PROCESSING:return u.default.createElement(mr,{spin:!0,style:{color:"#c1cdf7",fontSize:"16px"}});case Ar.ERROR:return u.default.createElement(Ji,{style:{color:"#ff4d4f",fontSize:"16px"}});case Ar.SUCCESS:return u.default.createElement(Yi,{style:{color:"#39ca74cc",fontSize:"16px"}});case Ar.WARNING:return u.default.createElement(or,{style:{color:"#faad14",fontSize:"16px"}});case Ar.DEFAULT:return u.default.createElement(sr,{style:{color:"#d9d9d9",fontSize:"16px"}});default:return null}},Sr=e=>{const t=u.default.isValidElement(e.data.icon)?e.data.icon:u.default.createElement(er,{style:xr});return u.default.createElement("div",{className:"xflow-default-node "+(e.isNodeTreePanel?"panel-node":"")},u.default.createElement("span",{className:"icon"},t),u.default.createElement("span",{className:"label"},e.data.label),u.default.createElement("span",{className:"status"},u.default.createElement(Tr,{status:e.data&&e.data.status,hide:e.isNodeTreePanel})))};var Pr;Sr.displayName="XFlowDefaultNode",function(e){e.CONFIG_TYPE="GraphConfig",e.defaultNodeTypeParser=e=>e.renderKey,e.defaultEdgeTypeParser=e=>e.renderKey,e.defaultNodeMapValue=[[Go,Sr],[Fo,Or]]}(Pr||(Pr={}));class Nr{constructor(){this.CONFIG_TYPE=Pr.CONFIG_TYPE,this.x6Options=new Do,this.rootContainer=new Do,this.graphContainer=new Do,this.nodeRender=new Map(Pr.defaultNodeMapValue),this.edgeRender=new Map,this.nodeTypeParser=Pr.defaultNodeTypeParser,this.edgeTypeParser=Pr.defaultEdgeTypeParser,this.events=[],this.mergeX6Config=e=>vo(this,void 0,void 0,(function*(){const t=yield this.getX6Config();return Object.assign(t,e)})),this.getX6Config=()=>vo(this,void 0,void 0,(function*(){return yield this.x6Options.promise})),this.setX6Config=e=>{var t;const n=this.getDefaultGraphOptions();null===(t=this.x6Options)||void 0===t||t.resolve(Object.assign(Object.assign({},n),e))},this.setRootContainer=e=>{e&&(null==this||this.rootContainer.resolve(e))},this.setGraphContainer=e=>{var t;e&&(null===(t=this.graphContainer)||void 0===t||t.resolve(e))},this.setEvents=e=>{this.events=e},this.setDefaultNodeRender=e=>{this.nodeRender.set(Go,e)},this.setDefaultEdgeRender=e=>{this.edgeRender.set(Uo,e)},this.setNodeRender=(e,t)=>{this.nodeRender.set(e,t)},this.setEdgeRender=(e,t)=>{this.edgeRender.set(e,t)},this.setNodeTypeParser=e=>{this.nodeTypeParser=e},this.setEdgeTypeParser=e=>{this.edgeTypeParser=e},this.getConfig=()=>vo(this,void 0,void 0,(function*(){const[e,t,n]=yield Promise.all([this.rootContainer.promise,this.graphContainer.promise,this.x6Options.promise]);return{xflowInstanceId:this.xflowInstanceId,graphId:this.graphId,nodeViewId:this.graphId,rootContainer:e,graphContainer:t,x6Options:n,events:this.events,nodeRender:this.nodeRender,edgeRender:this.edgeRender,nodeTypeParser:this.nodeTypeParser,edgeTypeParser:this.edgeTypeParser}})),this.getDefaultGraphOptions=()=>({rotating:!1,resizing:!1,connecting:{snap:!0,dangling:!1,highlight:!1,connectionPoint:"rect",router:{name:"er"},connector:{name:"rounded",args:{radius:15}}},background:{},grid:{visible:!0},selecting:{strict:!0,enabled:!0,multiple:!0,selectCellOnMoved:!0,showNodeSelectionBox:!1,rubberEdge:!0,rubberNode:!0,movable:!0},snapline:{enabled:!1},history:{enabled:!1},clipboard:{enabled:!0,useLocalStorage:!0},scroller:{enabled:!1},mousewheel:{enabled:!0,minScale:Ro,maxScale:1.5,factor:1.1,modifiers:["ctrl","meta"]},panning:{enabled:!0},scaling:{min:Ro,max:1.5},keyboard:{enabled:!0},interacting:{nodeMovable:!0,edgeLabelMovable:!1},async:!1}),this.dispose=()=>{this.rootContainer=new Do,this.graphContainer=new Do,this.x6Options=new Do},this.graphId=Vo()}}const Ir=Symbol("IGraphOptionProvider");function kr(e){return"function"==typeof e}var Mr=!1,Dr={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;Mr=e},get useDeprecatedSynchronousErrorHandling(){return Mr}};function jr(e){setTimeout((function(){throw e}),0)}var Rr={closed:!0,next:function(e){},error:function(e){if(Dr.useDeprecatedSynchronousErrorHandling)throw e;jr(e)},complete:function(){}},Gr=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function Fr(e){return null!==e&&"object"==typeof e}var Ur=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Lr=Ur,Br=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,o=n._parentOrParents,i=n._ctorUnsubscribe,r=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var a=0;a<o.length;++a){o[a].remove(this)}if(kr(r)){i&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){t=e instanceof Lr?Hr(e.errors):[e]}}if(Gr(s)){a=-1;for(var c=s.length;++a<c;){var u=s[a];if(Fr(u))try{u.unsubscribe()}catch(e){t=t||[],e instanceof Lr?t=t.concat(Hr(e.errors)):t.push(e)}}}if(t)throw new Lr(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var o=n;(n=new e)._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var r=this._subscriptions;return null===r?this._subscriptions=[n]:r.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function Hr(e){return e.reduce((function(e,t){return e.concat(t instanceof Lr?t.errors:t)}),[])}var Vr=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Xr=function(e){function t(n,o,i){var r=e.call(this)||this;switch(r.syncErrorValue=null,r.syncErrorThrown=!1,r.syncErrorThrowable=!1,r.isStopped=!1,arguments.length){case 0:r.destination=Rr;break;case 1:if(!n){r.destination=Rr;break}if("object"==typeof n){n instanceof t?(r.syncErrorThrowable=n.syncErrorThrowable,r.destination=n,n.add(r)):(r.syncErrorThrowable=!0,r.destination=new zr(r,n));break}default:r.syncErrorThrowable=!0,r.destination=new zr(r,n,o,i)}return r}return fo(t,e),t.prototype[Vr]=function(){return this},t.create=function(e,n,o){var i=new t(e,n,o);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Br),zr=function(e){function t(t,n,o,i){var r,s=e.call(this)||this;s._parentSubscriber=t;var a=s;return kr(n)?r=n:n&&(r=n.next,o=n.error,i=n.complete,n!==Rr&&(kr((a=Object.create(n)).unsubscribe)&&s.add(a.unsubscribe.bind(a)),a.unsubscribe=s.unsubscribe.bind(s))),s._context=a,s._next=r,s._error=o,s._complete=i,s}return fo(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Dr.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Dr.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):jr(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;jr(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Dr.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Dr.useDeprecatedSynchronousErrorHandling)throw e;jr(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Dr.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return Dr.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(jr(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Xr);var Kr=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Wr(e){return e}function Yr(e){return 0===e.length?Wr:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var qr=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var o=this.operator,i=function(e,t,n){if(e){if(e instanceof Xr)return e;if(e[Vr])return e[Vr]()}return e||t||n?new Xr(e,t,n):new Xr(Rr)}(e,t,n);if(o?i.add(o.call(i,this.source)):i.add(this.source||Dr.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),Dr.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Dr.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,o=t.destination,i=t.isStopped;if(n||i)return!1;e=o&&o instanceof Xr?o:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=$r(t))((function(t,o){var i;i=n.subscribe((function(t){try{e(t)}catch(e){o(e),i&&i.unsubscribe()}}),o,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Kr]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Yr(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=$r(e))((function(e,n){var o;t.subscribe((function(e){return o=e}),(function(e){return n(e)}),(function(){return e(o)}))}))},e.create=function(t){return new e(t)},e}();function $r(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var Jr=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Zr=function(e){function t(t,n){var o=e.call(this)||this;return o.subject=t,o.subscriber=n,o.closed=!1,o}return fo(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Br),Qr=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return fo(t,e),t}(Xr),es=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return fo(t,e),t.prototype[Vr]=function(){return new Qr(this)},t.prototype.lift=function(e){var t=new ts(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Jr;if(!this.isStopped)for(var t=this.observers,n=t.length,o=t.slice(),i=0;i<n;i++)o[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new Jr;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,o=t.slice(),i=0;i<n;i++)o[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Jr;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),o=0;o<t;o++)n[o].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Jr;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Jr;return this.hasError?(e.error(this.thrownError),Br.EMPTY):this.isStopped?(e.complete(),Br.EMPTY):(this.observers.push(e),new Zr(this,e))},t.prototype.asObservable=function(){var e=new qr;return e.source=this,e},t.create=function(e,t){return new ts(e,t)},t}(qr),ts=function(e){function t(t,n){var o=e.call(this)||this;return o.destination=t,o.source=n,o}return fo(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Br.EMPTY},t}(es),ns=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return fo(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Jr;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(es),os=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.scheduler=t,o.work=n,o.pending=!1,o}return fo(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,o=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(o,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(o,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,o=void 0;try{this.work(e)}catch(e){n=!0,o=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),o},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,o=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&n.splice(o,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return fo(t,e),t.prototype.schedule=function(e,t){return this},t}(Br)),is=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),rs=function(e){function t(n,o){void 0===o&&(o=is.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():o()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return fo(t,e),t.prototype.schedule=function(n,o,i){return void 0===o&&(o=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,o,i):e.prototype.schedule.call(this,n,o,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(is),ss=new rs(os),as=ss;var cs=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new us(e,this.predicate,this.thisArg))},e}(),us=function(e){function t(t,n,o){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=o,i.count=0,i}return fo(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(Xr);var ds=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new ls(e,this.compare,this.keySelector))},e}(),ls=function(e){function t(t,n,o){var i=e.call(this,t)||this;return i.keySelector=o,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return fo(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var o=!1;if(this.hasKey)try{o=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;o||(this.key=t,this.destination.next(e))},t}(Xr),hs={leading:!0,trailing:!1};var fs=function(){function e(e,t,n,o){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=o}return e.prototype.call=function(e,t){return t.subscribe(new ps(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),ps=function(e){function t(t,n,o,i,r){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=o,s.leading=i,s.trailing=r,s._hasTrailingValue=!1,s._trailingValue=null,s}return fo(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(gs,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(Xr);function gs(e){e.subscriber.clearThrottle()}function vs(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ys(e){return!!e&&!!e[na]}function ms(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===ia}(e)||Array.isArray(e)||!!e[ta]||!!e.constructor[ta]||ws(e)||Os(e))}function bs(e,t,n){void 0===n&&(n=!1),0===_s(e)?(n?Object.keys:ra)(e).forEach((function(o){n&&"symbol"==typeof o||t(o,e[o],e)})):e.forEach((function(n,o){return t(o,n,e)}))}function _s(e){var t=e[na];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:ws(e)?2:Os(e)?3:0}function Es(e,t){return 2===_s(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Cs(e,t,n){var o=_s(e);2===o?e.set(t,n):3===o?(e.delete(t),e.add(n)):e[t]=n}function ws(e){return Js&&e instanceof Map}function Os(e){return Zs&&e instanceof Set}function xs(e){return e.o||e.t}function As(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=sa(e);delete t[na];for(var n=ra(t),o=0;o<n.length;o++){var i=n[o],r=t[i];!1===r.writable&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(t[i]={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function Ts(e,t){return void 0===t&&(t=!1),Ps(e)||ys(e)||!ms(e)||(_s(e)>1&&(e.set=e.add=e.clear=e.delete=Ss),Object.freeze(e),t&&bs(e,(function(e,t){return Ts(t,!0)}),!0)),e}function Ss(){vs(2)}function Ps(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Ns(e){var t=aa[e];return t||vs(18,e),t}function Is(){return qs}function ks(e,t){t&&(Ns("Patches"),e.u=[],e.s=[],e.v=t)}function Ms(e){Ds(e),e.p.forEach(Rs),e.p=null}function Ds(e){e===qs&&(qs=e.l)}function js(e){return qs={p:[],l:qs,h:e,m:!0,_:0}}function Rs(e){var t=e[na];0===t.i||1===t.i?t.j():t.O=!0}function Gs(e,t){t._=t.p.length;var n=t.p[0],o=void 0!==e&&e!==n;return t.h.g||Ns("ES5").S(t,e,o),o?(n[na].P&&(Ms(t),vs(4)),ms(e)&&(e=Fs(t,e),t.l||Ls(t,e)),t.u&&Ns("Patches").M(n[na].t,e,t.u,t.s)):e=Fs(t,n,[]),Ms(t),t.u&&t.v(t.u,t.s),e!==ea?e:void 0}function Fs(e,t,n){if(Ps(t))return t;var o=t[na];if(!o)return bs(t,(function(i,r){return Us(e,o,t,i,r,n)}),!0),t;if(o.A!==e)return t;if(!o.P)return Ls(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var i=4===o.i||5===o.i?o.o=As(o.k):o.o;bs(3===o.i?new Set(i):i,(function(t,r){return Us(e,o,i,t,r,n)})),Ls(e,i,!1),n&&e.u&&Ns("Patches").R(o,n,e.u,e.s)}return o.o}function Us(e,t,n,o,i,r){if(ys(i)){var s=Fs(e,i,r&&t&&3!==t.i&&!Es(t.D,o)?r.concat(o):void 0);if(Cs(n,o,s),!ys(s))return;e.m=!1}if(ms(i)&&!Ps(i)){if(!e.h.F&&e._<1)return;Fs(e,i),t&&t.A.l||Ls(e,i)}}function Ls(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&Ts(t,n)}function Bs(e,t){var n=e[na];return(n?xs(n):e)[t]}function Hs(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var o=Object.getOwnPropertyDescriptor(n,t);if(o)return o;n=Object.getPrototypeOf(n)}}function Vs(e){e.P||(e.P=!0,e.l&&Vs(e.l))}function Xs(e){e.o||(e.o=As(e.t))}function zs(e,t,n){var o=ws(t)?Ns("MapSet").N(t,n):Os(t)?Ns("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),o={i:n?1:0,A:t?t.A:Is(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=o,r=ca;n&&(i=[o],r=ua);var s=Proxy.revocable(i,r),a=s.revoke,c=s.proxy;return o.k=c,o.j=a,c}(t,n):Ns("ES5").J(t,n);return(n?n.A:Is()).p.push(o),o}function Ks(e){return ys(e)||vs(22,e),function e(t){if(!ms(t))return t;var n,o=t[na],i=_s(t);if(o){if(!o.P&&(o.i<4||!Ns("ES5").K(o)))return o.t;o.I=!0,n=Ws(t,i),o.I=!1}else n=Ws(t,i);return bs(n,(function(t,i){o&&function(e,t){return 2===_s(e)?e.get(t):e[t]}(o.t,t)===i||Cs(n,t,e(i))})),3===i?new Set(n):n}(e)}function Ws(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return As(e)}var Ys,qs,$s="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Js="undefined"!=typeof Map,Zs="undefined"!=typeof Set,Qs="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,ea=$s?Symbol.for("immer-nothing"):((Ys={})["immer-nothing"]=!0,Ys),ta=$s?Symbol.for("immer-draftable"):"__$immer_draftable",na=$s?Symbol.for("immer-state"):"__$immer_state",oa="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",ia=""+Object.prototype.constructor,ra="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,sa=Object.getOwnPropertyDescriptors||function(e){var t={};return ra(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},aa={},ca={get:function(e,t){if(t===na)return e;var n=xs(e);if(!Es(n,t))return function(e,t,n){var o,i=Hs(t,n);return i?"value"in i?i.value:null===(o=i.get)||void 0===o?void 0:o.call(e.k):void 0}(e,n,t);var o=n[t];return e.I||!ms(o)?o:o===Bs(e.t,t)?(Xs(e),e.o[t]=zs(e.A.h,o,e)):o},has:function(e,t){return t in xs(e)},ownKeys:function(e){return Reflect.ownKeys(xs(e))},set:function(e,t,n){var o=Hs(xs(e),t);if(null==o?void 0:o.set)return o.set.call(e.k,n),!0;if(!e.P){var i=Bs(xs(e),t),r=null==i?void 0:i[na];if(r&&r.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(n,i)&&(void 0!==n||Es(e.t,t)))return!0;Xs(e),Vs(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==Bs(e.t,t)||t in e.t?(e.D[t]=!1,Xs(e),Vs(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=xs(e),o=Reflect.getOwnPropertyDescriptor(n,t);return o?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:o.enumerable,value:n[t]}:o},defineProperty:function(){vs(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){vs(12)}},ua={};bs(ca,(function(e,t){ua[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ua.deleteProperty=function(e,t){return ua.set.call(this,e,t,void 0)},ua.set=function(e,t,n){return ca.set.call(this,e[0],t,n,e[0])};var da=function(){function e(e){var t=this;this.g=Qs,this.F=!0,this.produce=function(e,n,o){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var r=t;return function(e){var t=this;void 0===e&&(e=i);for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];return r.produce(e,(function(e){var o;return(o=n).call.apply(o,[t,e].concat(s))}))}}var s;if("function"!=typeof n&&vs(6),void 0!==o&&"function"!=typeof o&&vs(7),ms(e)){var a=js(t),c=zs(t,e,void 0),u=!0;try{s=n(c),u=!1}finally{u?Ms(a):Ds(a)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return ks(a,o),Gs(e,a)}),(function(e){throw Ms(a),e})):(ks(a,o),Gs(s,a))}if(!e||"object"!=typeof e){if(void 0===(s=n(e))&&(s=e),s===ea&&(s=void 0),t.F&&Ts(s,!0),o){var d=[],l=[];Ns("Patches").M(e,s,d,l),o(d,l)}return s}vs(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var o=arguments.length,i=Array(o>1?o-1:0),r=1;r<o;r++)i[r-1]=arguments[r];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(i))}))};var o,i,r=t.produce(e,n,(function(e,t){o=e,i=t}));return"undefined"!=typeof Promise&&r instanceof Promise?r.then((function(e){return[e,o,i]})):[r,o,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){ms(e)||vs(8),ys(e)&&(e=Ks(e));var t=js(this),n=zs(this,e,void 0);return n[na].C=!0,Ds(t),n},t.finishDraft=function(e,t){var n=(e&&e[na]).A;return ks(n,t),Gs(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!Qs&&vs(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var o=t[n];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}n>-1&&(t=t.slice(n+1));var i=Ns("Patches").$;return ys(e)?i(e,t):this.produce(e,(function(e){return i(e,t)}))},e}(),la=new da,ha=la.produce;la.produceWithPatches.bind(la);var fa=la.setAutoFreeze.bind(la);la.setUseProxies.bind(la),la.applyPatches.bind(la);var pa=la.createDraft.bind(la),ga=la.finishDraft.bind(la);!function(){function e(e,t){function n(){this.constructor=e}i(e,t),e.prototype=(n.prototype=t.prototype,new n)}function t(e){e.o||(e.D=new Map,e.o=new Map(e.t))}function n(e){e.o||(e.o=new Set,e.t.forEach((function(t){if(ms(t)){var n=zs(e.A.h,t,e);e.p.set(t,n),e.o.add(n)}else e.o.add(t)})))}function o(e){e.O&&vs(3,JSON.stringify(xs(e)))}var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},r=function(){function n(e,t){return this[na]={i:2,l:t,A:t?t.A:Is(),P:!1,I:!1,o:void 0,D:void 0,t:e,k:this,C:!1,O:!1},this}e(n,Map);var i=n.prototype;return Object.defineProperty(i,"size",{get:function(){return xs(this[na]).size}}),i.has=function(e){return xs(this[na]).has(e)},i.set=function(e,n){var i=this[na];return o(i),xs(i).has(e)&&xs(i).get(e)===n||(t(i),Vs(i),i.D.set(e,!0),i.o.set(e,n),i.D.set(e,!0)),this},i.delete=function(e){if(!this.has(e))return!1;var n=this[na];return o(n),t(n),Vs(n),n.t.has(e)?n.D.set(e,!1):n.D.delete(e),n.o.delete(e),!0},i.clear=function(){var e=this[na];o(e),xs(e).size&&(t(e),Vs(e),e.D=new Map,bs(e.t,(function(t){e.D.set(t,!1)})),e.o.clear())},i.forEach=function(e,t){var n=this;xs(this[na]).forEach((function(o,i){e.call(t,n.get(i),i,n)}))},i.get=function(e){var n=this[na];o(n);var i=xs(n).get(e);if(n.I||!ms(i))return i;if(i!==n.t.get(e))return i;var r=zs(n.A.h,i,n);return t(n),n.o.set(e,r),r},i.keys=function(){return xs(this[na]).keys()},i.values=function(){var e,t=this,n=this.keys();return(e={})[oa]=function(){return t.values()},e.next=function(){var e=n.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},i.entries=function(){var e,t=this,n=this.keys();return(e={})[oa]=function(){return t.entries()},e.next=function(){var e=n.next();if(e.done)return e;var o=t.get(e.value);return{done:!1,value:[e.value,o]}},e},i[oa]=function(){return this.entries()},n}(),s=function(){function t(e,t){return this[na]={i:3,l:t,A:t?t.A:Is(),P:!1,I:!1,o:void 0,t:e,k:this,p:new Map,O:!1,C:!1},this}e(t,Set);var i=t.prototype;return Object.defineProperty(i,"size",{get:function(){return xs(this[na]).size}}),i.has=function(e){var t=this[na];return o(t),t.o?!!t.o.has(e)||!(!t.p.has(e)||!t.o.has(t.p.get(e))):t.t.has(e)},i.add=function(e){var t=this[na];return o(t),this.has(e)||(n(t),Vs(t),t.o.add(e)),this},i.delete=function(e){if(!this.has(e))return!1;var t=this[na];return o(t),n(t),Vs(t),t.o.delete(e)||!!t.p.has(e)&&t.o.delete(t.p.get(e))},i.clear=function(){var e=this[na];o(e),xs(e).size&&(n(e),Vs(e),e.o.clear())},i.values=function(){var e=this[na];return o(e),n(e),e.o.values()},i.entries=function(){var e=this[na];return o(e),n(e),e.o.entries()},i.keys=function(){return this.values()},i[oa]=function(){return this.values()},i.forEach=function(e,t){for(var n=this.values(),o=n.next();!o.done;)e.call(t,o.value,o.value,this),o=n.next()},t}();!function(e,t){aa[e]||(aa[e]=t)}("MapSet",{N:function(e,t){return new r(e,t)},T:function(e,t){return new s(e,t)}})}(),fa(!1),e.NsModel=void 0,function(e){function t(t){return t!==e.EMPTY_VALUE}e.EMPTY_VALUE=Symbol("EMPTY_MODEL_VALUE"),e.isValidValue=t,e.defaultPipeFunction=function(e){return e.pipe((function(e){return e.lift(new ds(i,r))}),(n=e=>t(e),function(e){return e.lift(new cs(n,o))}),function(e,t,n){return void 0===t&&(t=as),void 0===n&&(n=hs),function(o){return o.lift(new fs(e,t,n.leading,n.trailing))}}(17,ss,{leading:!1,trailing:!0}));var n,o,i,r}}(e.NsModel||(e.NsModel={}));class va{constructor(t=e.NsModel.EMPTY_VALUE,n=30){this.toDispose=new Mo,this.watch=(t,n=e.NsModel.defaultPipeFunction)=>{this.subject$.observers.length+1>this.maxSubscription&&console.warn(`${this.subject$} reach maxSubscription limitation, please check`);const o=(n?n(this.subject$):this.subject$).subscribe(t);return e.Disposable.create((()=>{o.unsubscribe()}))},this.getValue=()=>this.subject$.getValue(),this.setValue=t=>{if(this.subject$)if("function"!=typeof t)this.subject$.next(t);else{const n=this.subject$.getValue(),o=ha(n,(e=>{t(e)}));e.NsModel.isValidValue(o)&&this.setValue(o)}},this.hasValidValue=()=>{const t=this.getValue();return e.NsModel.isValidValue(t)},this.getValidValue=()=>vo(this,void 0,void 0,(function*(){const t=new Do;if(this.hasValidValue())return this.getValue();const n=this.watch((o=>{e.NsModel.isValidValue(o)&&(t.resolve(o),n.dispose())}));return t.promise})),this.dispose=()=>{this.toDispose.dispose()},this.subject$=new ns(t||e.NsModel.EMPTY_VALUE),this.maxSubscription=n,this.toDispose.push(e.Disposable.create((()=>{this.subject$.complete(),this.subject$.unsubscribe(),this.subject$=null})))}}const ya=An.defineToken("IFrontendApplicationContribution"),ma=Symbol("IGraphCommandService"),ba=An.defineToken("ICommandHandler"),_a=Symbol("ICommandContextProvider"),Ea=Symbol("IGraphCommandFactory"),Ca=An.defineToken("IGraphCommandContribution");var wa,Oa,xa;!function(e){e.is=function(e){return!!e&&e===Object(e)&&"id"in e},e.compareCommands=function(e,t){if(e.label&&t.label){const n=(e.category?`${e.category}: ${e.label}`:e.label).toLowerCase(),o=(t.category?`${t.category}: ${t.label}`:t.label).toLowerCase();return n.localeCompare(o)}return 0},e.equals=function(e,t){return e.id===t.id&&e.label===t.label&&e.iconName===t.iconName&&e.category===t.category}}(wa||(wa={})),e.GraphCommandRegistry=class{constructor(e){this.contributionProvider=e,this.redoStack=[],this.undoStack=[],this.commands=new Map,this.factories=new Map,this.disposables=new Map,this.cmdChangeEvent=new va(null),this.Globals=new va(new Map),this.setGlobal=(e,t)=>{this.Globals.setValue((n=>{n.set(e,t)}))},this.getGlobal=e=>this.Globals.getValue().get(e),this.undoCommand=()=>vo(this,void 0,void 0,(function*(){const e=this.undoStack.pop();e?(yield e.undo(),this.redoStack.push(e),this.cmdChangeEvent.setValue(null)):console.error("empty undo stack")})),this.redoCommand=()=>vo(this,void 0,void 0,(function*(){const e=this.redoStack.pop();e?(yield e.redo(),this.undoStack.push(e),this.cmdChangeEvent.setValue(null)):console.error("empty undo stack")})),this.registerDisposableCommand=e=>{const t=new Mo;return e({registerCommand:(e,n)=>{const o=this.registerCommand(e,n);return t.push(o),o}}),t}}get watchChange(){return this.cmdChangeEvent.watch}onStart(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerGraphCommands(this)}executeCommandPipeline(e){return vo(this,void 0,void 0,(function*(){let t=null;for(const n of e){const e=null==t?void 0:t.contextProvider(),{args:o,hooks:i}=yield null==n?void 0:n.getCommandOption(e);t=yield this.executeCommand(null==n?void 0:n.commandId,o,i)}return this.cmdChangeEvent.setValue(null),t}))}executeCommand(e,t,n=[]){return vo(this,void 0,void 0,(function*(){const o=this.getFactory(e);if(o){const i=yield o.createCommand(e,t,n);return yield i.execute(),i.isUndoable()&&this.undoStack.push(i),this.cmdChangeEvent.setValue(null),i}throw Object.assign(new Error(`The command '${e}' cannot be executed. There are no active handlers available for the command.`),{code:"NO_ACTIVE_HANDLER"})}))}executeUndoCommand(e,t,n=[]){return vo(this,void 0,void 0,(function*(){const o=this.getFactory(e);if(o){const i=yield o.createCommand(e,t,n);return yield i.execute(),i}throw Object.assign(new Error(`The command '${e}' cannot be executed. There are no active handlers available for the command.`),{code:"NO_ACTIVE_HANDLER"})}))}createCommand(e,t,n=[]){return vo(this,void 0,void 0,(function*(){const o=this.getFactory(e);if(o){return yield o.createCommand(e,t,n)}throw Object.assign(new Error(`The command '${e}' cannot be executed. There are no active handlers available for the command.`),{code:"NO_ACTIVE_HANDLER"})}))}get isUndoable(){return this.undoStack.length>0}get isRedoable(){return this.redoStack.length>0}hasCommand(e){return this.commands.has(e)}getCommand(e){return this.commands.get(e)}registerCommand(t,n){if(this.factories.has(t.id))return console.warn(`A command ${t.id} is already registered.`),e.Disposable.NULL;const o=new Mo(this.doRegisterCommand(t),this.registerFactory(t.id,n),e.Disposable.create((()=>this.disposables.delete(t.id))));return this.disposables.set(t.id,o),o}doRegisterCommand(t){return this.commands.set(t.id,t),e.Disposable.create((()=>this.disposables.delete(t.id)))}unregisterCommand(e){const t=wa.is(e)?e.id:e,n=this.disposables.get(t);n&&n.dispose()}hasFactory(e){return!!this.factories.get(e)}getFactory(e){return this.factories.get(e)}registerFactory(t,n,o=!1){return this.hasFactory(t)&&!1===o&&console.error("cannot register command:",t),this.factories.set(t,n),e.Disposable.create((()=>{this.factories.delete(t)}))}getAllFactories(){return Array.from(this.factories.entries())}},e.GraphCommandRegistry=po([zn({contrib:[ya,ma]}),(Oa=0,xa=so(Ca),function(e,t){xa(e,t,Oa)}),go("design:paramtypes",[Object])],e.GraphCommandRegistry);const Aa=io((t=>{ro.register(t,Ca),t(e.GraphCommandRegistry)})),Ta=An.defineToken("IModelService"),Sa=An.defineToken("IModelContribution"),Pa=Symbol("IModelOptionProvider");var Na;!function(e){e.ASYNC_SRRIES="ASYNC_SRRIES",e.ASYNC_PARALLEL="ASYNC_PARALLEL"}(Na||(Na={}));var Ia={exports:{}};function ka(e,t){var n=e.length,o=new Array(n),i={},r=n,s=function(e){for(var t=new Map,n=0,o=e.length;n<o;n++){var i=e[n];t.has(i[0])||t.set(i[0],new Set),t.has(i[1])||t.set(i[1],new Set),t.get(i[0]).add(i[1])}return t}(t),a=function(e){for(var t=new Map,n=0,o=e.length;n<o;n++)t.set(e[n],n);return t}(e);for(t.forEach((function(e){if(!a.has(e[0])||!a.has(e[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")}));r--;)i[r]||c(e[r],r,new Set);return o;function c(e,t,r){if(r.has(e)){var u;try{u=", node was:"+JSON.stringify(e)}catch(e){u=""}throw new Error("Cyclic dependency"+u)}if(!a.has(e))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(e));if(!i[t]){i[t]=!0;var d=s.get(e)||new Set;if(t=(d=Array.from(d)).length){r.add(e);do{var l=d[--t];c(l,a.get(l),r)}while(t);r.delete(e)}o[--n]=e}}}Ia.exports=function(e){return ka(function(e){for(var t=new Set,n=0,o=e.length;n<o;n++){var i=e[n];t.add(i[0]),t.add(i[1])}return Array.from(t)}(e),e)},Ia.exports.array=ka;var Ma,Da,ja=Ia.exports;!function(e){let t;!function(e){e.INVALID_HOOK_BEFORE="INVALID_HOOK_BEFORE",e.INVALID_HOOK_AFTER="INVALID_HOOK_AFTER",e.INVALID_HOOK_ARGS_LENGTH="INVALID_HOOK_ARGS_LENGTH"}(t=e.ErrorEnum||(e.ErrorEnum={}));class n extends Error{constructor(e,t,...o){Array.isArray(t)&&(t=t.filter((function(e){return!!e})).join(" ")),super(`${e}: ${t}`),Error.captureStackTrace&&Error.captureStackTrace(this,n),this.code=e,this.contexts={},o.forEach((e=>{"object"==typeof e&&Object.entries(e).forEach((e=>{const[t,n]=e;"key"!==t&&n&&(this.contexts[t]=JSON.parse(JSON.stringify(n)))}))}))}toString(){return`${this.code}: ${this.message}`}}e.HookError=n;const o=(e,t,...o)=>new n(e,t,...o);e.HookBeforeError=()=>o(t.INVALID_HOOK_BEFORE,["hook require a before dependency but not exist in hookmap"]),e.HookAfterError=()=>o(t.INVALID_HOOK_AFTER,["hook require a after dependency but not exist in hookmap"]),e.InvalidHookArguments=e=>o(t.INVALID_HOOK_ARGS_LENGTH,["hook handlers must have 0 to 2 arguments",`but got ${e.handler.length}`])}(Ma||(Ma={})),function(e){e.normalize=(e=[],t)=>{const n=Array.isArray(e)?e:[e],o=[];return t.forEach((e=>{o.push(e)})),[...o,...n].filter((e=>e&&!!e.handler))},e.sort=(e=[],t)=>{const n=[];e.forEach((e=>{if(e.before){if(!t.has(e.before))throw Ma.HookBeforeError();const o=[e,t.get(e.before)];n.push(o)}if(e.after){if(!t.has(e.after))throw Ma.HookBeforeError();const o=[t.get(e.after),e];n.push(o)}}));return ja.array(e,n)}}(Da||(Da={}));class Ra{constructor(){this.isResolved=!1,this.isRejected=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.isResolved=!0,e(t)},this.reject=e=>{this.isRejected=!0,t(e)}}))}}class Ga{constructor(e){this.scheduleType=Na.ASYNC_SRRIES,this.hasHook=e=>this.hookMap.has(e),this.getHooks=(e=[],t=!0)=>{const n=Da.normalize(e,this.hookMap);return t?Da.sort(n,this.hookMap):n},this.registerHook=e=>(this.hookMap.has(e.name)&&console.error(`${e.name} is duplicated in hookmap`),this.hookMap.set(e.name,e),{dispose:()=>{this.hookMap.delete(e.name)}}),this.call=(e,t=(e=>vo(this,void 0,void 0,(function*(){return e}))),n=[])=>vo(this,void 0,void 0,(function*(){const o=this.getHooks(n,!0);return(0,this.schedulers[this.scheduleType])(e,t,o)})),this.schedulers={[Na.ASYNC_SRRIES]:(e,t,n=[])=>vo(this,void 0,void 0,(function*(){let o=t;for(const t of n){if([0,1].includes(t.handler.length)){yield t.handler.call(this,e);continue}if([2].includes(t.handler.length)&&null!==o){const n=yield t.handler.call(this,e,o);if(null===n){o=null;break}if("function"==typeof n){o=n;continue}}throw Ma.InvalidHookArguments(t)}if(o)return yield o.call(this,e)})),[Na.ASYNC_PARALLEL]:(e,t,n=[])=>vo(this,void 0,void 0,(function*(){const o=n.map((n=>{if([0,1].includes(n.handler.length))return n.handler.call(this,e);if([2].includes(n.handler.length))return n.handler.call(this,e,t);throw Ma.InvalidHookArguments(n)})),i=new Ra;if(Promise.all(o).then((e=>i.resolve(e))),t)return yield t.call(this,i)}))},this.hookMap=new Map,e&&e.type&&(this.scheduleType=e.type)}}const Fa=An.defineToken("IHookService"),Ua=An.defineToken("IHookContribution"),La=()=>({dispose:()=>{}});var Ba;!function(e){e.CONFIG_TYPE="XFlowHook"}(Ba||(Ba={}));class Ha{constructor(){this.CONFIG_TYPE=Ba.CONFIG_TYPE,this.time=Date.now(),this.setRegisterHook=e=>{this.hookRegisterFunc=e},this.setRegisterHookhub=e=>{this.hookhubRegisterFn=e},this.getConfig=()=>vo(this,void 0,void 0,(function*(){return{CONFIG_TYPE:this.CONFIG_TYPE,hookRegisterFn:this.hookRegisterFunc||La,hookhubRegisterFn:this.hookhubRegisterFn||La}})),this.dispose=()=>{}}}let Va=class{constructor(){this.toDispose=new Mo,this.hookProvider=()=>this.hooks,this.registerHook=e=>e(this.hooks),this.registerHookHub=(e,t)=>(this.hooks[e]=t,{dispose:()=>{delete this.hooks[e]}}),this.onStart=()=>vo(this,void 0,void 0,(function*(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerHookHub(this);for(const t of e)t.registerHook(this.hooks)})),this.hooks={graphOptions:new Ga,reactNodeRender:new Ga,reactEdgeLabelRender:new Ga,afterGraphInit:new Ga,beforeGraphDestroy:new Ga,x6Events:new Ga}}onStop(){this.toDispose.dispose()}};var Xa;po([so(Ua),go("design:type",Object)],Va.prototype,"contributionProvider",void 0),Va=po([zn({contrib:[ya,Fa]}),go("design:paramtypes",[])],Va),function(e){e.pluginId="GraphEventPlugin"}(Xa||(Xa={}));let za=class{constructor(){this.toDispose=new Mo,this.registerHook=t=>vo(this,void 0,void 0,(function*(){const{hookRegisterFn:n}=yield this.hookConfig.getConfig(),o=n(t);return e.Disposable.create((()=>{o.dispose()}))})),this.registerHookHub=t=>vo(this,void 0,void 0,(function*(){const{hookhubRegisterFn:n}=yield this.hookConfig.getConfig(),o=n(t);return e.Disposable.create((()=>{o.dispose()}))}))}};po([Kn(Ha),go("design:type",Ha)],za.prototype,"hookConfig",void 0),za=po([zn({contrib:Ua})],za);const Ka={dispose:()=>null};var Wa;!function(e){e.pluginId="base-graph-events"}(Wa||(Wa={}));let Ya=class{constructor(){this.toDispose=new Mo,this.registerHookHub=()=>vo(this,void 0,void 0,(function*(){return e.Disposable.create((()=>{}))})),this.registerHook=t=>vo(this,void 0,void 0,(function*(){const n=new Mo,o=[t.x6Events.registerHook({name:Wa.pluginId,handler:e=>vo(this,void 0,void 0,(function*(){const{events:t}=yield this.graphOptions.getOptions();t.forEach((t=>{e.push(t)}))}))}),t.afterGraphInit.registerHook({name:Wa.pluginId,handler:e=>vo(this,void 0,void 0,(function*(){const{commandService:o,modelService:i,graph:r}=e,s=yield t.x6Events.call([],(e=>vo(this,void 0,void 0,(function*(){return e.map((e=>{const t=t=>{e.callback(t,o,i,r)};return r.on(e.eventName,t),{dispose:()=>{r.off(e.eventName,t)}}}))}))));n.pushAll(s)}))}),t.afterGraphInit.registerHook({name:"add auto resize event",handler:t=>vo(this,void 0,void 0,(function*(){const{commandService:o}=t,i=function(e){let t;return()=>{t||(t=requestAnimationFrame((()=>{t=null,e()})))}}((()=>{o.executeCommand(e.XFlowGraphCommands.GRAPH_RESIZE.id,{})}));window.addEventListener("resize",i),n.push(e.Disposable.create((()=>{window.removeEventListener("resize",i)})))}))}),t.beforeGraphDestroy.registerHook({name:Wa.pluginId,handler:()=>vo(this,void 0,void 0,(function*(){n.dispose()}))})];return n.pushAll(o),n}))}};po([Kn(Ir),go("design:type",Object)],Ya.prototype,"graphOptions",void 0),Ya=po([zn({contrib:Ua})],Ya);const qa=e=>io((t=>{ro.register(t,Ua),t(za),t(Ya),t(Va),t(Ha,{useValue:e})}));class $a{constructor(){this.extensions=[],this.containerClassNames=new Set,this.addCoreModule=t=>(this.extensions.unshift(t),e.Disposable.create((()=>{this.removeExtension(t)}))),this.addExtension=t=>(this.extensions.push(t),e.Disposable.create((()=>{this.removeExtension(t)}))),this.removeExtension=e=>{const t=this.extensions.indexOf(e);t>-1&&this.extensions.splice(t,1)},this.getInstaceId=()=>this.instanceId,this.addContainerClassNames=e=>this.containerClassNames.add(e),this.getContainerClassNames=()=>Array.from(this.containerClassNames),this.getAllExtensions=()=>this.extensions,this.getAllExtensionConfigs=()=>this.extensions.map((e=>e.config)),this.instanceId=Vo()}has(e){return this.extensions.some((t=>t.config.CONFIG_TYPE===e))}}const Ja=u.default.createContext({}),Za=()=>u.default.useContext(Ja),Qa=e=>{const t=Za(),n=u.default.useMemo((()=>e.config?e.config:new Ha),[]);return u.default.useEffect((()=>{const e=t.addCoreModule({config:n,createModule:qa});return()=>{e.dispose(),n.dispose()}}),[t,n]),null},ec=u.default.createContext({cell:null,x6Graph:null,commands:null,modelService:null});function tc(e,t,n){return function(o){const i=this,r=null==o?void 0:o.getData(),s=null==o?void 0:o.getSize(),a=null==o?void 0:o.getPosition();return u.default.createElement((()=>u.default.createElement(ec.Provider,{value:{cell:o,x6Graph:i,commands:t,modelService:n}},u.default.createElement(e,{cell:o,data:r,size:s,position:a}))),null)}}const nc=Symbol("IGraphProvider"),oc=Symbol("ICommandServiceProvider"),ic=Symbol("IModelServiceProvider");let rc=class{constructor(){this.toDisposce=new Mo,this.graphMap=new Map,this.getGraph=t=>vo(this,void 0,void 0,(function*(){let o=this.graphMap.get(t);if(!o){o=new Do,this.graphMap.set(t,o);const i=yield this.optionProvider.getOptions(),r=this.hookService.hookProvider(),s=yield r.graphOptions.call(i.x6Options),{graphContainer:a,edgeRender:c,nodeRender:u,edgeTypeParser:d}=i,l=yield r.reactEdgeLabelRender.call(c);yield r.reactNodeRender.call(u);const{clientHeight:h,clientWidth:f}=a,p=yield this.commandServiceProvider.getCommandService(),g=yield this.modelServiceProvider.getModelService(),v=new n.Graph(Object.assign(Object.assign({container:a,width:f,height:h},s),{onEdgeLabelRendered:e=>{const{edge:t,container:n}=e;this.renderEdgeReactLabel({edge:t,container:n,edgeRenderMap:l,edgeTypeParser:d,modelService:g,commandService:p})}}));yield r.afterGraphInit.call({graph:v,commandService:p,modelService:g}),o.resolve(v),v.on("node:moved",(({node:e})=>{const t=e.getData(),n=e.position();e.setData(Object.assign(Object.assign({},t),{x:null==n?void 0:n.x,y:null==n?void 0:n.y}))})),v.on("node:resized",(({node:e})=>{const t=e.getData(),n=e.size();e.setData(Object.assign(Object.assign({},t),{width:null==n?void 0:n.width,height:null==n?void 0:n.height}))})),this.toDisposce.push(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){yield r.beforeGraphDestroy.call({graph:v,commandService:p,modelService:g}),this.graphMap.delete(t),v.dispose()})))))}return o.promise})),this.renderEdgeReactLabel=e=>vo(this,void 0,void 0,(function*(){const{container:t,edgeTypeParser:n,edge:o,edgeRenderMap:i,commandService:r,modelService:s}=e,a=n(null==o?void 0:o.data)||Uo,c=i.get(a);if(c&&o&&(null==o?void 0:o.data)&&c){const e=this.edgeAppendForeignObject(o,t),n=function(e,t,n){return function(o){const i=this,r=null==o?void 0:o.getData();return u.default.createElement((()=>u.default.createElement(ec.Provider,{value:{cell:o,x6Graph:i,commands:t,modelService:n}},u.default.createElement(e,{data:r,cell:o}))),null)}}(c,r,s)(o);l.default.render(n,e)}}))}edgeAppendForeignObject(e,t){const o=n.Dom.createSvgElement("foreignObject"),i=n.Dom.createElementNS("body",n.Dom.ns.xhtml),r=n.Dom.createElementNS("div",n.Dom.ns.xhtml),s=null==e?void 0:e.data,a=(null==s?void 0:s.edgeContentWidth)||100,c=(null==s?void 0:s.edgeContentHeigt)||30;return o.setAttribute("width",`${a}`),o.setAttribute("height",`${c}`),o.setAttribute("x",""+-1*a/2),o.setAttribute("y",""+-1*c/2),i.setAttribute("xhtmls",n.Dom.ns.xhtml),i.style.width="100%",i.style.height="100%",i.style.padding="0",i.style.margin="0",i.style.background="unset",i.style.overflow="visible",i.className="xflow-edge-label-body",r.style.width="100%",r.style.height="100%",i.appendChild(r),o.appendChild(i),t.appendChild(o),r}dispose(){this.toDisposce.dispose()}};po([Kn(Ir),go("design:type",Object)],rc.prototype,"optionProvider",void 0),po([Kn(Fa),go("design:type",Object)],rc.prototype,"hookService",void 0),po([Kn(oc),go("design:type",Object)],rc.prototype,"commandServiceProvider",void 0),po([Kn(ic),go("design:type",Object)],rc.prototype,"modelServiceProvider",void 0),rc=po([zn()],rc);var sc;!function(e){e.CONFIG_TYPE="MODEL_SERVICE_CONFIG"}(sc||(sc={}));const ac=()=>e.Disposable.create((()=>{}));class cc{constructor(){this.CONFIG_TYPE=sc.CONFIG_TYPE,this.registerModelFn=ac,this.isMounted=new Do,this.registerModel=e=>{this.registerModelFn=e},this.setMountState=()=>{this.isMounted.resolve(!0)},this.getConfig=()=>vo(this,void 0,void 0,(function*(){return yield this.isMounted.promise,{CONFIG_TYPE:this.CONFIG_TYPE,modelRegisterFunc:this.registerModelFn||ac}})),this.dispose=()=>{this.registerModelFn=ac,this.isMounted=new Do}}}let uc=class{constructor(){this.toDispose=new Mo,this.deferredModelMap=new Map,this.registerModel=t=>{const{id:n,getInitialValue:o,modelFactory:i}=t,r=new Mo,s=this.ensureModel(n);if(s.isResolved)return void console.error(t,"model has been registerd");const a=o?o():e.NsModel.EMPTY_VALUE,c=i?i():new va(a);return e.NsModel.isValidValue(a)&&s.resolve(c),t.watchChange&&t.watchChange(c,this).then((e=>{s.isResolved||s.resolve(c),this.toDispose.pushAll([e,r]),r.push(e)})),r},this.findDeferredModel=e=>this.deferredModelMap.get(e),this.awaitModel=e=>this.ensureModel(e).promise,this.registerRuntimeModel=()=>vo(this,void 0,void 0,(function*(){const{modelRegisterFunc:e}=yield this.modelOptionProvider.getOption(),t=yield this.graphProvider.getGraphInstance();e&&e(this,t)})),this.ensureModel=t=>{const n=this.deferredModelMap.get(t);if(n)return n;const o=new Do;return this.deferredModelMap.set(t,o),this.toDispose.push(e.Disposable.create((()=>this.deferredModelMap.delete(t)))),o}}onStart(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerModel(this);this.registerRuntimeModel()}onStop(){this.toDispose.dispose()}};po([so(Sa),go("design:type",Object)],uc.prototype,"contributionProvider",void 0),po([Kn(Pa),go("design:type",Object)],uc.prototype,"modelOptionProvider",void 0),po([Kn(nc),go("design:type",Object)],uc.prototype,"graphProvider",void 0),uc=po([zn({contrib:[ya,Ta]})],uc);const dc=e=>t=>vo(void 0,void 0,void 0,(function*(){return yield t.awaitModel(e)})),lc=e=>t=>vo(void 0,void 0,void 0,(function*(){return(yield t.awaitModel(e)).getValidValue()}));var hc,fc,pc,gc,vc,yc,mc,bc,_c,Ec,Cc,wc,Oc,xc,Ac,Tc,Sc,Pc,Nc,Ic;!function(e){e.id="GRAPH_ENABLE_MULTI_SELECT",e.getModel=dc(e.id),e.useValue=lc(e.id)}(hc||(hc={})),function(e){e.id="IS_NODE_SELECTED",e.getModel=dc(e.id),e.useValue=lc(e.id)}(fc||(fc={})),function(e){e.id="IS_GROUP_SELECTED",e.getModel=dc(e.id),e.useValue=lc(e.id)}(pc||(pc={})),function(e){e.id="IS_NORMAL_NODES_SELECTED",e.getModel=dc(e.id),e.useValue=lc(e.id)}(gc||(gc={})),function(e){e.id="LAST_SELECTED_CELL",e.getModel=dc(e.id),e.useValue=lc(e.id)}(vc||(vc={})),function(e){e.id="SELECTED_CELLS",e.getModel=dc(e.id),e.useValue=lc(e.id)}(yc||(yc={})),function(e){e.id="LAST_SELECTED_NODE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(mc||(mc={})),function(e){e.id="SELECTED_NODES",e.getModel=dc(e.id),e.useValue=lc(e.id)}(bc||(bc={})),function(e){e.id="SELECTED_EDGES",e.getModel=dc(e.id),e.useValue=lc(e.id)}(_c||(_c={})),function(e){e.id="SELECTED_GROUPS",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Ec||(Ec={})),function(e){e.id="CONTEXTMENU_NODE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Cc||(Cc={})),function(e){e.id="CONTEXTMENU_EDGE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(wc||(wc={})),function(e){e.id="CONTEXTMENU_TARGET",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Oc||(Oc={})),function(e){e.id="GRAPH_META",e.getModel=dc(e.id),e.useValue=lc(e.id)}(xc||(xc={})),function(e){e.id="GRAPH_SCALE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Ac||(Ac={})),function(e){e.id="COMMAND_REDOABLE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Tc||(Tc={})),function(e){e.id="COMMAND_UNDOABLE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Sc||(Sc={})),function(e){e.id="COMMAND_GLOBALS",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Pc||(Pc={})),function(e){e.id="HISTORY_UNDOABLE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Nc||(Nc={})),function(e){e.id="HISTORY_REDOABLE",e.getModel=dc(e.id),e.useValue=lc(e.id)}(Ic||(Ic={}));var kc=Object.freeze({__proto__:null,isModelExistUtil:e=>t=>{const n=t.findDeferredModel(e);return!(!n||!n.promise)},getModelUtil:dc,useModelValueUtil:lc,get GRAPH_ENABLE_MULTI_SELECT(){return hc},get IS_NODE_SELECTED(){return fc},get IS_GROUP_SELECTED(){return pc},get IS_NORMAL_NODES_SELECTED(){return gc},get SELECTED_CELL(){return vc},get SELECTED_CELLS(){return yc},get SELECTED_NODE(){return mc},get SELECTED_NODES(){return bc},get SELECTED_EDGES(){return _c},get SELECTED_GROUPS(){return Ec},get CONTEXTMENU_NODE(){return Cc},get CONTEXTMENU_EDGE(){return wc},get CONTEXTMENU_TARGET(){return Oc},get GRAPH_META(){return xc},get GRAPH_SCALE(){return Ac},get COMMAND_REDOABLE(){return Tc},get COMMAND_UNDOABLE(){return Sc},get COMMAND_GLOBALS(){return Pc},get HISTORY_UNDOABLE(){return Nc},get HISTORY_REDOABLE(){return Ic}});let Mc=class{registerModel(e){e.registerModel({id:Tc.id,getInitialValue:()=>this.commands.isRedoable,watchChange:e=>vo(this,void 0,void 0,(function*(){return this.commands.watchChange((()=>{e.setValue(this.commands.isRedoable)}))}))}),e.registerModel({id:Sc.id,getInitialValue:()=>this.commands.isUndoable,watchChange:e=>vo(this,void 0,void 0,(function*(){return this.commands.watchChange((()=>{e.setValue(this.commands.isUndoable)}))}))}),e.registerModel({id:Pc.id,modelFactory:()=>this.commands.Globals})}};po([Kn(ma),go("design:type",Object)],Mc.prototype,"commands",void 0),Mc=po([zn({contrib:Sa})],Mc);const Dc=(t,n,o)=>(t.on(n,o),e.Disposable.create((()=>{t.off(n,o)})));let jc=class{constructor(){this.getGraphInstance=()=>vo(this,void 0,void 0,(function*(){return{graph:yield this.graphProvider.getGraphInstance(),config:yield this.graphProvider.getGraphOptions()}}))}registerModel(t){t.registerModel({id:xc.id,getInitialValue:()=>({flowId:"-1"}),watchChange:t=>vo(this,void 0,void 0,(function*(){return e.Disposable.create((()=>{t.setValue({flowId:"-1"})}))}))}),t.registerModel({id:hc.id,getInitialValue:()=>({isEnable:!1}),watchChange:t=>vo(this,void 0,void 0,(function*(){return e.Disposable.create((()=>{t.setValue({isEnable:!1})}))}))}),t.registerModel({id:yc.id,getInitialValue:()=>[],watchChange:t=>vo(this,void 0,void 0,(function*(){const{graph:n}=yield this.getGraphInstance(),o=e=>{const{selected:n}=e;t.setValue(n)};return n.on("selection:changed",o),e.Disposable.create((()=>n.off("selection:changed",o)))}))}),t.registerModel({id:vc.id,watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield yc.getModel(t)).watch(((t=[])=>{e.setValue([...t].pop()||null)}))}))}),t.registerModel({id:bc.id,getInitialValue:()=>[],watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield yc.getModel(t)).watch(((t=[])=>{const n=t.filter((e=>e.isNode()));e.setValue(n)}))}))}),t.registerModel({id:mc.id,watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield bc.getModel(t)).watch((t=>{e.setValue([...t].pop()||null)}))}))}),t.registerModel({id:fc.id,watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield bc.getModel(t)).watch((t=>{e.setValue(t.length>0)}))}))}),t.registerModel({id:pc.id,getInitialValue:()=>!1,watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield yc.getModel(t)).watch((t=>{const n=t.every((e=>e&&!0===e.getProp("isGroup")));e.setValue(n)}))}))}),t.registerModel({id:Ec.id,getInitialValue:()=>[],watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield bc.getModel(t)).watch((t=>{const n=t.filter((e=>e&&!0===e.getProp("isGroup")));e.setValue(n)}))}))}),t.registerModel({id:gc.id,getInitialValue:()=>!1,watchChange:(e,t)=>vo(this,void 0,void 0,(function*(){return(yield yc.getModel(t)).watch((t=>{const n=t.every((e=>{const t=!(e&&e.getProp("isGroup")),n=!(e&&e.getProp("group"));return t&&n})),o=t.length>0&&n;e.setValue(o)}))}))}),t.registerModel({id:Ac.id,getInitialValue:()=>({zoomFactor:-1}),watchChange:t=>vo(this,void 0,void 0,(function*(){const{graph:n}=yield this.getGraphInstance(),o=e=>{const o=n.zoom();t.setValue(Object.assign(Object.assign({},e),{zoomFactor:o}))};return n.on("scale",o),e.Disposable.create((()=>n.off("scale",o)))}))}),t.registerModel({id:Oc.id,watchChange:e=>vo(this,void 0,void 0,(function*(){const{graph:t,config:n}=yield this.getGraphInstance(),o=o=>i=>{const{x:r,y:s}=i,a=t.localToClient({x:r,y:s}),c=n.rootContainer.getBoundingClientRect(),u={x:a.x-((null==c?void 0:c.x)||0),y:a.y-((null==c?void 0:c.y)||0)};e.setValue({type:o,anchor:u,data:i,cell:i.cell})},i=new Mo;return i.pushAll([Dc(t,"node:contextmenu",o("node")),Dc(t,"edge:contextmenu",o("edge")),Dc(t,"blank:contextmenu",o("blank"))]),i}))}),t.registerModel({id:Ic.id,getInitialValue:()=>!1,watchChange:t=>vo(this,void 0,void 0,(function*(){const{graph:n}=yield this.getGraphInstance(),o=()=>{const e=n.history.canRedo();t.setValue(e)};return n.history&&n.history.on("change",o),e.Disposable.create((()=>n.history.off("change",o)))}))}),t.registerModel({id:Nc.id,getInitialValue:()=>!1,watchChange:t=>vo(this,void 0,void 0,(function*(){const{graph:n}=yield this.getGraphInstance(),o=()=>{const e=n.history.canUndo();t.setValue(e)};return n.history&&n.history.on("change",o),e.Disposable.create((()=>n.history.off("change",o)))}))})}};po([Kn(nc),go("design:type",Object)],jc.prototype,"graphProvider",void 0),jc=po([zn({contrib:Sa})],jc);const Rc=io((e=>{ro.register(e,Sa),e(uc),e(jc),e(Mc)})),Gc=e=>io((t=>{((e,t)=>{e({token:Pa,useDynamic:()=>({getOption:()=>vo(void 0,void 0,void 0,(function*(){return t.getConfig()}))}),lifecycle:An.Lifecycle.singleton})})(t,e)})),Fc=e=>{const{config:t}=e,n=Za(),o=u.default.useMemo((()=>t||new cc),[]);return u.default.useEffect((()=>{const e=n.addCoreModule({config:o,createModule:Gc});return o.setMountState(),()=>{e.dispose(),o.dispose()}}),[]),null};Fc.defaultProps={XFlowModuleType:"ModelServiceConfig"};const Uc=e=>{const t=[],n=[],o=e=>{e.isNode()&&t.push((e=>{const t=e.getChildren(),n=e.getSize(),o=e.getData()||{},i=e.getPosition(),r=e.getParentId(),{isCollapsed:s}=o,a=o.groupCollapsedSize||(s?n:null);return Object.assign(Object.assign({},o),{id:e.id,width:n.width,height:n.height,x:i.x,y:i.y,group:r,groupChildren:t?t.map((e=>e.id)):null,groupCollapsedSize:a})})(e)),e.isEdge()&&n.push((e=>{const t=e.getData()||{};return Object.assign({id:e.id},t)})(e))};return e.map((e=>o(e))),{nodes:t,edges:n}};e.IApplication=class{constructor(){this.getGraphInstance=()=>this.graphProvider.getGraphInstance(),this.getGraphConfig=()=>this.graphProvider.getGraphOptions(),this.getGraphData=()=>vo(this,void 0,void 0,(function*(){const e=(yield this.graphProvider.getGraphInstance()).getCells();return Uc(e)})),this.getAllNodes=()=>vo(this,void 0,void 0,(function*(){return(yield this.graphProvider.getGraphInstance()).getNodes()})),this.getNodeById=e=>vo(this,void 0,void 0,(function*(){return(yield this.graphProvider.getGraphInstance()).getCellById(e)})),this.getAllEdges=()=>vo(this,void 0,void 0,(function*(){return(yield this.graphProvider.getGraphInstance()).getEdges()})),this.getEdgeById=e=>vo(this,void 0,void 0,(function*(){return(yield this.graphProvider.getGraphInstance()).getCellById(e)})),this.updateNodeAttrs=(e,t)=>vo(this,void 0,void 0,(function*(){if(e instanceof n.Node)e.setAttrs(t);else{(yield this.getNodeById(e)).setAttrs(t)}})),this.updateEdgeAttrs=(e,t)=>vo(this,void 0,void 0,(function*(){if(e instanceof n.Edge)e.setAttrs(t);else{(yield this.getEdgeById(e)).setAttrs(t)}})),this.translateGraph=(e,t)=>vo(this,void 0,void 0,(function*(){const n=yield this.graphProvider.getGraphInstance(),o=n.translate();n.translate(o.tx+e,o.ty+t)}))}start(){return vo(this,void 0,void 0,(function*(){yield this.startContributions(),this.registerEventListeners()}))}executeCommand(e,t,n=[]){return this.commandService.executeCommand(e,t,n)}executeCommandPipeline(e){return this.commandService.executeCommandPipeline(e)}registerEventListeners(){window.addEventListener("unload",(()=>{this.stopContributions()}))}startContributions(){return vo(this,void 0,void 0,(function*(){console.log(this.contributions.getContributions());for(const e of this.contributions.getContributions())if(e.onStart)try{yield this.measure(`${e.constructor.name}.onStart`,(()=>e.onStart(this)))}catch(e){console.error("Could not start contribution",e)}}))}stopContributions(){console.info(">>> Stopping frontend contributions...");for(const e of this.contributions.getContributions())if(e.onStop)try{e.onStop(this)}catch(e){console.error("Could not stop contribution",e)}console.info("<<< All frontend contributions have been stopped.")}measure(e,t){return vo(this,void 0,void 0,(function*(){const n=`${e}-start`,o=`${e}-end`;performance.mark(n);const i=yield t();performance.mark(o),performance.measure(e,n,o);for(const t of performance.getEntriesByName(e)){const e=`Frontend ${t.name}`;t.duration>100?console.warn(`${e} is slow, took: ${t.duration.toFixed(1)} ms`):console.debug(`${e} took: ${t.duration.toFixed(1)} ms`)}return performance.clearMeasures(e),i}))}},po([so(ya),go("design:type",Object)],e.IApplication.prototype,"contributions",void 0),po([Kn(nc),go("design:type",Object)],e.IApplication.prototype,"graphProvider",void 0),po([Kn(ma),go("design:type",Object)],e.IApplication.prototype,"commandService",void 0),po([Kn(Ta),go("design:type",Object)],e.IApplication.prototype,"modelService",void 0),e.IApplication=po([zn()],e.IApplication);const Lc=io((t=>{ro.register(t,ya),t(e.IApplication)})),Bc=u.default.createContext({configProvider:null}),Hc=e=>{const t=u.default.useContext(Bc);return u.default.useMemo((()=>t.configProvider?t.configProvider.getXflowPrefixCls(e):`xflow-${e}`),[e])};const Vc=(e={})=>t.useMemo((()=>{const t=Object.entries(e),n=t.length>0?{position:"absolute"}:{};return t.forEach((([e,t=0])=>{n[e]=`${t}px`})),n}),[e]),Xc=e=>io((t=>{(e=>{e(rc),e(nc,{lifecycle:An.Lifecycle.singleton,useDynamic:e=>({getGraphInstance:()=>vo(void 0,void 0,void 0,(function*(){const t=e.container.get(rc),n=e.container.get(Ir),o=yield null==n?void 0:n.getOptions();return yield null==t?void 0:t.getGraph(o.graphId)})),getGraphOptions:()=>vo(void 0,void 0,void 0,(function*(){const t=e.container.get(Ir);return null==t?void 0:t.getOptions()}))})}),e(oc,{lifecycle:An.Lifecycle.singleton,useDynamic:e=>({getCommandService:()=>vo(void 0,void 0,void 0,(function*(){return e.container.get(ma)}))})}),e(ic,{lifecycle:An.Lifecycle.singleton,useDynamic:e=>({getModelService:()=>vo(void 0,void 0,void 0,(function*(){return e.container.get(Ta)}))})})})(t),((e,t)=>{e(Ir,{lifecycle:An.Lifecycle.singleton,useDynamic:()=>({getOptions:()=>vo(void 0,void 0,void 0,(function*(){return t.getConfig()}))})})})(t,e)})),zc=e=>{const t=_r(),n=u.default.useRef(null),o=u.default.useRef(null),r=Za(),s=u.default.useMemo((()=>{const t=e.config?e.config:new Nr;return t.setX6Config(),t}),[]),[a,c]=i.usePortal(s.graphId);u.default.useEffect((()=>{t&&t.getGraphInstance().then((e=>{c(e)}))}),[t,c]),u.default.useEffect((()=>{s.setRootContainer(n.current),s.setGraphContainer(o.current),s.xflowInstanceId=r.getInstaceId(),r.addCoreModule({config:s,createModule:Xc});return()=>{vo(void 0,void 0,void 0,(function*(){s.dispose()}))}}),[]);const d=Vc(e.position),l=Hc("canvas-root"),h=Hc("x6-canvas");return u.default.createElement(u.default.Fragment,null,u.default.createElement("div",{ref:n,className:l,style:d,id:s.graphId,tabIndex:0},u.default.createElement("div",{ref:o,className:h}),e.children),u.default.createElement(a,null))};zc.defaultProps={isXFlowCanvas:!0};let Kc=class{constructor(){this.toDispose=new Mo,this.runtimeHooks=[],this.getX6Graph=()=>vo(this,void 0,void 0,(function*(){if(this.graph)return this.graph;const e=yield this.graphProvider.getGraphInstance();return this.graph=e,e})),this.getGraphConfig=()=>vo(this,void 0,void 0,(function*(){return this.graphProvider.getGraphOptions()})),this.getGraphMeta=()=>vo(this,void 0,void 0,(function*(){const e=this.getModelService();return this.graphMeta||(yield xc.useValue(e))})),this.setArgs=(e,t=[])=>(this.args=e,this.runtimeHooks=t,{args:e,hooks:t}),this.getArgs=()=>({args:Object.assign(Object.assign({},this.args),{modelService:this.getModelService(),commandService:this.getCommands(),getGraphMeta:this.getGraphMeta,getX6Graph:this.getX6Graph,getGraphConfig:this.getGraphConfig}),hooks:this.runtimeHooks}),this.setResult=e=>(this.result=e,this.result),this.getResult=()=>this.result,this.getHooks=()=>this.hookService.hookProvider(),this.getCommands=()=>this.commandService,this.getModelService=()=>this.modelService,this.addUndo=e=>{if(!Array.isArray(e))return this.addUndo([e]);this.toDispose.pushAll(e)},this.undo=()=>vo(this,void 0,void 0,(function*(){yield this.toDispose.dispose()})),this.isUndoable=()=>!this.toDispose.disposed,this.getDisposables=()=>this.toDispose,this.setGlobal=(e,t)=>{this.commandService.setGlobal(e,t)},this.getGlobal=e=>this.commandService.getGlobal(e)}init(){this.getGraphMeta().then((e=>{this.graphMeta=e}))}};po([Kn(nc),go("design:type",Object)],Kc.prototype,"graphProvider",void 0),po([Kn(Fa),go("design:type",Object)],Kc.prototype,"hookService",void 0),po([Kn(ma),go("design:type",Object)],Kc.prototype,"commandService",void 0),po([Kn(Ta),go("design:type",Object)],Kc.prototype,"modelService",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Kc.prototype,"init",null),Kc=po([Xn()],Kc);const Wc=()=>[];class Yc{constructor(){this.setCommandContributions=e=>{this.getContributions=e},this.getCommandContributions=()=>this.getContributions(),this.registerHook=e=>vo(this,void 0,void 0,(function*(){return this.registerHookFn?this.registerHookFn(e):Ka})),this.registerHookHub=e=>vo(this,void 0,void 0,(function*(){return this.registerHookHubFn?this.registerHookHubFn(e):Ka})),this.CONFIG_TYPE="CommandConfig",this.setRegisterHookFn=e=>{this.registerHookFn=e},this.setRegisterHookHubFn=e=>{this.registerHookHubFn=e},this.getConfig=()=>vo(this,void 0,void 0,(function*(){return{registerHookFn:this.registerHookFn,getContributions:this.getContributions,CONFIG_TYPE:this.CONFIG_TYPE}})),this.getContributions=Wc}}var qc;!function(t){t.command=e.XFlowNodeCommands.ADD_NODE,t.hookKey="addNode"}(qc||(qc={}));let $c=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.addNode.call(n,(n=>vo(this,void 0,void 0,(function*(){const{createNodeService:o,cellFactory:i,commandService:r,options:s}=n,a=yield t.getX6Graph();let c=n.nodeConfig;if(o){const e=yield o(n);if("boolean"==typeof e)return{err:"createNodeService rejected"};c=e}const u=yield this.processNodeConfig(c);let d;const l=Object.assign(Object.assign({},s),{isCommand:!0});if(i){const e=yield i(u,this);d=a.addNode(e,l)}else d=a.addNode(u,l);return t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){const t=Object.assign({id:d.id},d.getData());r.executeCommand(e.XFlowNodeCommands.DEL_NODE.id,{nodeConfig:t})}))))),{nodeConfig:u,nodeCell:d}}))),o);return t.setResult(r),this})),this.processNodeConfig=e=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider();if(e.data=Object.assign({},e),e.shape)return e;if(!e.view){const n=yield t.getGraphConfig();e.view=n.graphId}if(!e.component){const n=yield this.getNodeReactComponent(e),o=t.getCommands(),i=t.getModelService();e.shape="react-shape",e.component=tc(n,o,i)}return e})),this.getNodeReactComponent=e=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),n=t.getHooks(),o=yield t.getGraphConfig(),i=yield n.reactNodeRender.call(o.nodeRender),r=o.nodeTypeParser(e)||Go,s=i.get(r);return s||console.error("react node component is missing:",o.nodeRender,r,s),s})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Jc;po([Kn(_a),go("design:type",Object)],$c.prototype,"contextProvider",void 0),$c=po([Xn({token:{token:ba,named:qc.command.id}})],$c),function(t){t.command=e.XFlowNodeCommands.DEL_NODE,t.hookKey="delNode",t.createHook=()=>new Ga}(Jc||(Jc={}));let Zc=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.delNode.call(n,(n=>vo(this,void 0,void 0,(function*(){const{commandService:o,deleteNodeService:i,options:r}=n,s=yield t.getX6Graph();if(i){if(!(yield i(n)))return{err:" service rejected"}}const a=(n.x6Node||n.nodeConfig).id,c=s.getCellById(a);if(c&&c.isNode()){const n=[...s.getIncomingEdges(c)||[],...s.getOutgoingEdges(c)||[]];yield Promise.all(n.map((t=>o.executeCommand(e.XFlowEdgeCommands.DEL_EDGE.id,{x6Edge:t}))));const i=c.getData();return c.remove(Object.assign(Object.assign({},r),{isCommand:!0})),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){yield o.executeCommand(e.XFlowNodeCommands.ADD_NODE.id,{nodeConfig:i})}))))),{err:null,nodeConfig:i}}return{err:"node is not exist"}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){if(this.isUndoable()){this.contextProvider().undo()}return this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Qc;po([Kn(_a),go("design:type",Object)],Zc.prototype,"contextProvider",void 0),Zc=po([Xn({token:{token:ba,named:Jc.command.id}})],Zc),function(t){t.command=e.XFlowNodeCommands.SELECT_NODE,t.hookKey="selectNode"}(Qc||(Qc={}));let eu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.selectNode.call(t,(t=>vo(this,void 0,void 0,(function*(){const n=yield this.ctx.getX6Graph(),o=n.getSelectedCells().map((e=>e.id)),{nodeIds:i,resetSelection:r,commandService:s}=t;return r?n.resetSelection(i):n.select(i),this.ctx.addUndo({dispose:()=>{s.executeUndoCommand(e.XFlowNodeCommands.SELECT_NODE.id,{nodeIds:o,resetSelection:!0})}}),{}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var tu;po([Kn(_a),go("design:type",Object)],eu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],eu.prototype,"init",null),eu=po([Xn({token:{token:ba,named:Qc.command.id}})],eu),function(t){t.command=e.XFlowNodeCommands.MOVE_NODE,t.hookKey="moveNode",t.createHook=()=>new Ga}(tu||(tu={}));let nu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.moveNode.call(n,(n=>vo(this,void 0,void 0,(function*(){const{nodePositionService:o}=n;if(o){if(!(yield o(n)))return{err:"service rejected"}}const{dx:i=0,dy:r=0,x:s,y:a,duration:c=150}=n.position,u=(yield t.getX6Graph()).getCellById(n.id);if(u){let n=s,o=a;const{x:d,y:l}=u.position();let h=()=>{u.position(d,l,{silent:!1})};return i||r?(n=i+d,o=r+l,u.translate(i,r,{transition:{duration:c}}),h=()=>u.translate(-i,-r,{transition:{duration:c}})):u.position(n,o,{silent:!1}),t.addUndo(e.Disposable.create((()=>{h()}))),{err:null,nextX:n,nextY:o}}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var ou;po([Kn(_a),go("design:type",Object)],nu.prototype,"contextProvider",void 0),nu=po([Xn({token:{token:ba,named:tu.command.id}})],nu),function(t){t.command=e.XFlowNodeCommands.UPDATE_NODE,t.hookKey="updateNode",t.XFlowNodeSetOptions={overwrite:!0},t.NODE_WIDTH=200,t.NODE_HEIGHT=40}(ou||(ou={}));let iu=class{constructor(){this.setNodeConfig=(e,t,n)=>{e.setData(t,n),e.setPosition((null==t?void 0:t.x)||0,(null==t?void 0:t.y)||0),e.setSize((null==t?void 0:t.width)||ou.NODE_WIDTH,(null==t?void 0:t.height)||ou.NODE_HEIGHT),e instanceof i.ReactShape||!e.getAttrByPath("text/text")||e.setAttrByPath("text/text",t.label),t.attrs&&e.setAttrs(t.attrs),Array.isArray(t.ports)&&e.setPropByPath("ports/items",t.ports,Object.assign({rewrite:!0},n))},this.getNodeConfig=e=>{const t=e.getData(),n=e.getPosition(),o=e.getSize();return Object.assign(Object.assign(Object.assign({},t),n),o)},this.getNodeCell=(e,t)=>{const{nodeConfig:o,setNodeConfig:i}=t;let r="";return i&&i.node&&"string"==typeof i.node?r=i.node:o&&o.id&&"string"==typeof o.id&&(r=o.id),r?null==e?void 0:e.getCellById(r):i&&i.node instanceof n.Node?i.node:void 0},this.getNextNodeConfig=(e,t)=>vo(this,void 0,void 0,(function*(){if(e&&e.setNodeConfig&&e.setNodeConfig.callback){const n=this.getNodeConfig(t);return e.setNodeConfig.callback(n)}return e.nodeConfig})),this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.updateNode.call(e,(e=>vo(this,void 0,void 0,(function*(){const{options:t=ou.XFlowNodeSetOptions}=e,n=yield this.ctx.getX6Graph(),o=this.getNodeCell(n,e),i=yield this.getNextNodeConfig(e,o);return this.setNodeConfig(o,i,t),{nodeConfig:i,nodeCell:o}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var ru;po([Kn(_a),go("design:type",Object)],iu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],iu.prototype,"init",null),iu=po([Xn({token:{token:ba,named:ou.command.id}})],iu),function(t){t.command=e.XFlowNodeCommands.CENTER_NODE,t.hookKey="centerNode"}(ru||(ru={}));let su=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.centerNode.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),{nodeConfig:n}=e,o=null==t?void 0:t.getCellById(null==n?void 0:n.id);return null==t||t.centerCell(o),{x6Node:o}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var au;po([Kn(_a),go("design:type",Object)],su.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],su.prototype,"init",null),su=po([Xn({token:{token:ba,named:ru.command.id}})],su),function(t){t.command=e.XFlowNodeCommands.FRONT_NODE,t.hookKey="frontNode"}(au||(au={}));let cu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.frontNode.call(n,(n=>vo(this,void 0,void 0,(function*(){const o=yield this.ctx.getX6Graph(),{nodeId:i}=n,r=null==o?void 0:o.getCellById(i);return r?(r.toFront(),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){n.commandService.executeCommand(e.XFlowNodeCommands.BACK_NODE.id,{nodeId:i})})))))):console.error(i,"this nodeId is not exist"),{}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var uu;po([Kn(_a),go("design:type",Object)],cu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],cu.prototype,"init",null),cu=po([Xn({token:{token:ba,named:au.command.id}})],cu),function(t){t.command=e.XFlowNodeCommands.BACK_NODE,t.hookKey="backNode"}(uu||(uu={}));let du=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.backNode.call(t,(t=>vo(this,void 0,void 0,(function*(){const n=yield this.ctx.getX6Graph(),{nodeId:o}=t,i=null==n?void 0:n.getCellById(o);return i?(i.toBack(),this.ctx.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){t.commandService.executeCommand(e.XFlowNodeCommands.FRONT_NODE.id,{nodeId:o})})))))):console.error(o,"this nodeId is not exist"),{}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var lu;po([Kn(_a),go("design:type",Object)],du.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],du.prototype,"init",null),du=po([Xn({token:{token:ba,named:uu.command.id}})],du),function(t){t.command=e.XFlowNodeCommands.HIGHLIGHT_NODE,t.hookKey="highlightNode"}(lu||(lu={}));let hu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.highlightNode.call(t,(t=>vo(this,void 0,void 0,(function*(){const n=yield this.ctx.getX6Graph(),{nodeId:o,stroke:i,strokeWidth:r}=t,s=null==n?void 0:n.getCellById(o);if(!s)return console.error(o,"this nodeId is not exist"),{err:"this nodeId is not exist"};if(null==s||s.setAttrs({body:{stroke:i||"#7c68fc",strokeWidth:r||2}}),null==t?void 0:t.isHighlightRelatedLines){const{edgeStroke:o,edgeStrokeWidth:i}=t;(null==n?void 0:n.getEdges()).forEach((n=>{const r=null==n?void 0:n.getData();null==t||t.commandService.executeCommand(e.XFlowEdgeCommands.HIGHLIGHT_EDGE.id,{edgeId:null==r?void 0:r.id,strokeColor:o,strokeWidth:i})}))}return{err:null}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var fu;po([Kn(_a),go("design:type",Object)],hu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],hu.prototype,"init",null),hu=po([Xn({token:{token:ba,named:lu.command.id}})],hu),function(t){t.command=e.XFlowNodeCommands.UPDATE_NODE_PORT,t.hookKey="updateNodePort"}(fu||(fu={}));let pu=class{constructor(){this.getCell=(e,t)=>"string"==typeof t?e.getCellById(t):t,this.getNodeConfig=e=>{const t=e.getData(),n=e.getPosition(),o=e.getSize();return Object.assign(Object.assign(Object.assign({},t),n),o)},this.updatePortsOfNodeConfig=(e,t,n)=>{const o=this.getNodeConfig(e);this.isNodeAnchors(o.ports)&&(o.ports=[...t]),this.isPortMetaData(o.ports)&&(o.ports.items=[...t]),e.setData(o,n)},this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield t.getX6Graph(),s=yield i.updateNodePort.call(n,(n=>vo(this,void 0,void 0,(function*(){const{node:o,updatePorts:i,options:s,commandService:a}=n,c=this.getCell(r,o);if(!c||c.isEdge())return console.error("node_is _not_exsit",o),{err:"node_is _not_exsit"};const u=c.getPorts(),d=yield i([...u],c,r);return!1===d?{err:"service rejected"}:(c.setPropByPath("ports/items",d,Object.assign({rewrite:!0},s)),this.updatePortsOfNodeConfig(c,d,s),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){a.executeCommand(e.XFlowNodeCommands.UPDATE_NODE_PORT.id,{node:o,updatePorts:()=>vo(this,void 0,void 0,(function*(){return u}))})}))))),{ports:d})}))),o);return t.setResult(s),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isNodeAnchors(e){return Array.isArray(e)}isPortMetaData(e){return e.items&&Array.isArray(e.items)}isUndoable(){return this.contextProvider().isUndoable()}};po([Kn(_a),go("design:type",Object)],pu.prototype,"contextProvider",void 0),pu=po([Xn({token:{token:ba,named:fu.command.id}})],pu);const gu=[qc,Jc,Qc,tu,ou,ru,au,uu,lu,fu];var vu;!function(t){t.command=e.XFlowGraphCommands.LOAD_META,t.hookKey="graphMeta"}(vu||(vu={}));let yu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.graphMeta.call(e,(e=>vo(this,void 0,void 0,(function*(){const{graphMetaService:t}=e,n=t?yield t(e):Object.assign({},null==e?void 0:e.meta);return Object.assign({flowId:null==n?void 0:n.flowId},n)}))),t),i=this.ctx.getModelService();return(yield xc.getModel(i)).setValue(o),this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var mu;po([Kn(_a),go("design:type",Object)],yu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],yu.prototype,"init",null),yu=po([Xn({token:{token:ba,named:vu.command.id}})],yu),function(t){t.command=e.XFlowGraphCommands.SAVE_GRAPH_DATA,t.hookKey="saveGrpahData"}(mu||(mu={}));let bu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const e=this.ctx,t=e.getArgs(),n=e.getHooks();return yield n.saveGrpahData.call(t.args,(t=>vo(this,void 0,void 0,(function*(){const{saveGraphDataService:n,includeAttrs:o}=t,i=yield e.getX6Graph(),r=i.getNodes(),s=i.getEdges(),a={nodes:r.map((e=>{const t=e.getData(),n=e.position(),i=e.size(),r=Object.assign(Object.assign(Object.assign({id:e.id},t),n),i);return o&&(r.attrs=e.getAttrs()),r})),edges:s.map((e=>{const t=e.getData(),n=Object.assign({id:e.id},t);return o&&(n.attrs=e.getAttrs()),n}))},c=yield this.ctx.getGraphMeta();if(n){const e=yield n(c,a);e&&this.ctx.setResult(e)}return{}}))),t.hooks),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var _u;po([Kn(_a),go("design:type",Object)],bu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],bu.prototype,"init",null),bu=po([Xn({token:{token:ba,named:mu.command.id}})],bu),function(t){t.command=e.XFlowGraphCommands.LOAD_DATA,t.hookKey="loadData",t.createHook=()=>new Ga}(_u||(_u={}));let Eu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.loadData.call(e,(e=>vo(this,void 0,void 0,(function*(){const{loadDataService:t}=e,n=yield this.ctx.getGraphMeta();return{graphData:yield t(n)}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var Cu;po([Kn(_a),go("design:type",Object)],Eu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Eu.prototype,"init",null),Eu=po([Xn({token:{token:ba,named:_u.command.id}})],Eu),function(t){t.command=e.XFlowGraphCommands.GRAPH_LAYOUT,t.hookKey="graphLayout"}(Cu||(Cu={}));let wu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.graphLayout.call(e,(e=>vo(this,void 0,void 0,(function*(){const{layoutType:t,layoutOptions:n,customLayout:o}=e,i=o||(e=>new(0,h.Layouts[t])(Object.assign({},n)).layout(e));return yield i(e.graphData),{graphData:e.graphData}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var Ou,xu;po([Kn(_a),go("design:type",Object)],wu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],wu.prototype,"init",null),wu=po([Xn({token:{token:ba,named:Cu.command.id}})],wu),function(e){e.isNodeEqual=function(e,t){return s.isEqual(e,t)},e.isEdgeEqual=function(e,t){return s.isEqual(e,t)}}(Ou||(Ou={})),function(t){t.command=e.XFlowGraphCommands.GRAPH_RENDER,t.hookKey="graphRender"}(xu||(xu={}));let Au=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.graphRender.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),n=yield this.ctx.getGraphMeta(),{beforeRender:o,graphData:i,isNodeEqual:r,isEdgeEqual:s,afterRender:a}=e;return o&&o(n),yield this.doLoadGraph(t,i,r,s),a&&a(i,n),{}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this})),this.doLoadGraph=(t,n,o,i)=>vo(this,void 0,void 0,(function*(){(null==t?void 0:t.isFrozen())||null==t||t.freeze();const r=this.ctx.getCommands(),{addNodeConfigs:s,addEdgeConfigs:a,removeNodes:c,removeEdges:u,updateNodes:d,updateEdges:l}=this.graphDataDiff(t,n,o,i);for(const t of s)yield r.executeCommand(e.XFlowNodeCommands.ADD_NODE.id,{nodeConfig:t},{name:"remove servcie",handler:e=>vo(this,void 0,void 0,(function*(){delete e.createNodeService}))});yield r.executeCommand(e.XFlowGroupCommands.INIT_GROUP.id,{graphData:{nodes:s,edges:[]}});for(const t of a)yield r.executeCommand(e.XFlowEdgeCommands.ADD_EDGE.id,{edgeConfig:t},{name:"remove servcie",handler:e=>vo(this,void 0,void 0,(function*(){delete e.createEdgeService}))});for(const t of c){const n=null==t?void 0:t.getData();n.isGroup?yield r.executeCommand(e.XFlowGroupCommands.DEL_GROUP.id,{nodeConfig:n}):yield r.executeCommand(e.XFlowNodeCommands.DEL_NODE.id,{nodeConfig:n})}for(const t of u){const n=null==t?void 0:t.getData();yield r.executeCommand(e.XFlowEdgeCommands.DEL_EDGE.id,{edgeConfig:n})}for(const t of d){const n=null==t?void 0:t.getData();yield r.executeCommand(e.XFlowNodeCommands.UPDATE_NODE.id,{nodeConfig:n})}for(const t of l){const n=null==t?void 0:t.getData();yield r.executeCommand(e.XFlowEdgeCommands.UPDATE_EDGE.id,{edgeConfig:n})}(null==t?void 0:t.isFrozen())&&(null==t||t.unfreeze())}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}graphDataDiff(e,t,n,o){const{nodes:i,edges:r}=t,s=[];i.forEach((t=>{e.getCellById(null==t?void 0:t.id)||s.push(t)}));const a=[],c=[],u=[];e.getNodes().forEach((e=>{const t=i.find((t=>(null==t?void 0:t.id)===(null==e?void 0:e.id)));if(t){let o=!0;n?o=n(null==e?void 0:e.data,t):(null==e?void 0:e.data)&&t&&(o=Ou.isNodeEqual(null==e?void 0:e.data,t)),o||e.setData(t),!0===o?a.push(e):c.push(e)}else u.push(e)}));const d=[];r.forEach((t=>{e.getCellById(null==t?void 0:t.id)||d.push(t)}));const l=[],h=[],f=[];return e.getEdges().forEach((e=>{const t=r.find((t=>(null==t?void 0:t.id)===(null==e?void 0:e.id)));if(t){let n=!0;o?n=o(null==e?void 0:e.data,t):(null==e?void 0:e.data)&&t&&(n=Ou.isEdgeEqual(null==e?void 0:e.data,t)),n||e.setData(t),!0===n?l.push(e):h.push(e)}else f.push(e)})),{addNodeConfigs:s,addEdgeConfigs:d,retainNodes:a,retainEdges:l,removeNodes:u,removeEdges:f,updateNodes:c,updateEdges:h}}};var Tu;po([Kn(_a),go("design:type",Object)],Au.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Au.prototype,"init",null),Au=po([Xn({token:{token:ba,named:xu.command.id}})],Au),function(t){t.command=e.XFlowGraphCommands.GRAPH_RESIZE,t.hookKey="graphResize"}(Tu||(Tu={}));let Su=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield this.ctx.getGraphConfig(),i=o.rootContainer.clientHeight,r=o.rootContainer.clientWidth,s=yield n.graphResize.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),{width:n=r,height:o=i}=e;return null==t||t.resize(n,o),{}}))),t);return this.ctx.setResult(s),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var Pu;po([Kn(_a),go("design:type",Object)],Su.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Su.prototype,"init",null),Su=po([Xn({token:{token:ba,named:Tu.command.id}})],Su),function(t){t.command=e.XFlowGraphCommands.GRAPH_ZOOM,t.MAX_SCALE=1.5,t.MIN_SCALE=.05,t.defaultZoomOptions={maxScale:t.MAX_SCALE,minScale:t.MIN_SCALE},t.hookKey="graphZoom"}(Pu||(Pu={}));let Nu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.graphZoom.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),{factor:n,zoomFitPadding:o=12,zoomOptions:i=Pu.defaultZoomOptions}=e;return"number"==typeof n?null==t||t.zoom(n,i||{}):"fit"===n?null==t||t.zoomToFit(Object.assign(Object.assign({},i),{padding:o})):"real"===n&&(null==t||t.scale(1),null==t||t.centerContent()),{factor:n,zoomFitPadding:o,zoomOptions:i}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var Iu;po([Kn(_a),go("design:type",Object)],Nu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Nu.prototype,"init",null),Nu=po([Xn({token:{token:ba,named:Pu.command.id}})],Nu),function(t){t.command=e.XFlowGraphCommands.GRAPH_COPY,t.hookKey="graphCopySelection"}(Iu||(Iu={}));let ku=class{constructor(){this.parseCells=e=>{e.forEach((t=>{const n=t.getData();if(t.isNode()&&n.isGroup){t.getChildren().forEach((t=>{e.push(t)}))}}));const t=e.filter((e=>e.isNode())).map((e=>e.id)),n=e.reduce(((e,n)=>{if(n.isEdge()){const o=n.getSourceCellId(),i=n.getTargetCellId();o&&i&&t.includes(o)&&t.includes(i)&&e.set(n.id,n)}else e.set(n.id,n);return e}),new Map),o=Array.from(n.values());return Uc(o)},this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.graphCopySelection.call(n,(()=>vo(this,void 0,void 0,(function*(){const n=(yield t.getX6Graph()).getSelectedCells(),o=this.parseCells(n),i=window.localStorage.getItem(Lo);return window.localStorage.setItem(Lo,JSON.stringify(o)),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){window.localStorage.setItem(Lo,i)}))))),{err:null}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};po([Kn(_a),go("design:type",Object)],ku.prototype,"contextProvider",void 0),ku=po([Xn({token:{token:ba,named:Iu.command.id}})],ku);let Mu=class{constructor(){this.groupNodeMap=new Map,this.nodeMap=new Map,this.nodeMappingRecord=new Map,this.portMap=new Map,this.portMappingRecord=new Map,this.edgeMap=new Map,this.edgeMappingRecord=new Map,this.getNodesByType=e=>e.reduce(((e,t)=>(t.isGroup?e.groupNodes.push(t):e.normalNodes.push(t),e)),{normalNodes:[],groupNodes:[]}),this.getNodePorts=e=>Array.isArray(e.ports)?e.ports:e.ports&&Array.isArray(e.ports.items)?e.ports.items:[],this.addNodes=e=>{e.forEach((e=>{if(e.isGroup)this.groupNodeMap.set(e.id,e);else{const t=this.getNodePorts(e);this.nodeMap.set(e.id,e),t.forEach((e=>{this.portMap.set(e.id,e)}))}}))},this.addEdge=e=>{e.forEach((e=>{this.edgeMap.set(e.id,e)}))},this.buildNodeMapping=(e,t)=>{const n=e.id||e.originId,o=t.id;this.nodeMappingRecord.set(n,o);this.getNodePorts(e).forEach(((e,n)=>{const o=t.ports[n];o&&(this.portMap.set(o.id,o),this.portMappingRecord.set(e.id,o.id))}))},this.createEdgeBetweenNodes=e=>{const{source:t,sourcePortId:n,target:o,targetPortId:i}=e;return Object.assign(Object.assign({},e),{source:this.nodeMappingRecord.get(t),target:this.nodeMappingRecord.get(o),sourcePortId:this.portMappingRecord.get(n),targetPortId:this.portMappingRecord.get(i)})},this.buildGroupRelations=e=>{const{groupChildren:t}=e,n=t.map((e=>this.nodeMappingRecord.get(e)));return Object.assign(Object.assign({},e),{groupChildren:n})}}};var Du,ju;function Ru(e,t=0){return Math.floor(Math.random()*(e-t)+t)}Mu=po([Xn()],Mu),function(t){t.command=e.XFlowGraphCommands.GRAPH_PASTE,t.hookKey="graphPasteSelection"}(ju||(ju={}));let Gu=Du=class{constructor(){this.updateNodeCopiedProps=(e,t)=>{let n=Ru(100),o=Ru(100);return e&&(n=t.x-e.x+Ru(30),o=t.y-e.y+Ru(30)),t.x+=n,t.y+=o,t.originId=t.id,delete t.id,t.label=`${t.label}_copied`,t.isCollapsed=!1,t},this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks();if(Du.doing)return this;Du.doing=!0;const r=yield i.graphPasteSelection.call(n,(n=>vo(this,void 0,void 0,(function*(){const{commandService:o,position:i}=n,r=function(e,t=null){try{return JSON.parse(e)||t}catch(e){return console.error(e),t}}(window.localStorage.getItem(Lo),{nodes:[],edges:[]}),{nodes:s=[],edges:a=[]}=r,{normalNodes:c,groupNodes:u}=this.mappingHelper.getNodesByType(s);return this.mappingHelper.addNodes(s),yield Promise.all(c.map((t=>vo(this,void 0,void 0,(function*(){const n=(yield o.executeCommand(e.XFlowNodeCommands.ADD_NODE.id,{nodeConfig:this.updateNodeCopiedProps(i,t)})).contextProvider().getResult();this.mappingHelper.buildNodeMapping(t,n.nodeConfig)}))))),yield Promise.all(u.map((t=>vo(this,void 0,void 0,(function*(){const n=this.mappingHelper.buildGroupRelations(t);yield o.executeCommand(e.XFlowGroupCommands.ADD_GROUP.id,{nodeConfig:this.updateNodeCopiedProps(i,n)})}))))),yield Promise.all(a.map((t=>{const n=this.mappingHelper.createEdgeBetweenNodes(t);return o.executeCommand(e.XFlowEdgeCommands.ADD_EDGE.id,{edgeConfig:n})}))),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){window.localStorage.setItem(Lo,null)}))))),{err:null}}))),o);return t.setResult(r),Du.doing=!1,this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Fu;Gu.doing=!1,po([Kn(_a),go("design:type",Object)],Gu.prototype,"contextProvider",void 0),po([Kn(Mu),go("design:type",Mu)],Gu.prototype,"mappingHelper",void 0),Gu=Du=po([Xn({token:{token:ba,named:ju.command.id}})],Gu),function(t){t.command=e.XFlowGraphCommands.GRAPH_TOGGLE_MULTI_SELECT,t.hookKey="toggleMultiSelect"}(Fu||(Fu={}));let Uu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.toggleMultiSelect.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),n=yield this.ctx.getGraphConfig(),{isEnable:o,modelService:i}=e,r=yield hc.getModel(i),s="boolean"==typeof o?o:!t.isRubberbandEnabled();return s?(t.enableRubberband(),t.scroller&&t.scroller.widget?t.scroller.disablePanning():t.disablePanning(),n.graphContainer.style.cursor="crosshair"):(t.disableRubberband(),t.scroller&&t.scroller.widget?t.scroller.enablePanning():t.enablePanning(),n.graphContainer.style.cursor="grab"),r.setValue({isEnable:s}),{isEnable:s}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var Lu;po([Kn(_a),go("design:type",Object)],Uu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Uu.prototype,"init",null),Uu=po([Xn({token:{token:ba,named:Fu.command.id}})],Uu),function(t){t.command=e.XFlowGraphCommands.GRAPH_HISTORY_UNDO,t.hookKey="historyUndo"}(Lu||(Lu={}));let Bu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.historyUndo.call(n,(n=>vo(this,void 0,void 0,(function*(){const o=yield t.getX6Graph();return!1===o.isHistoryEnabled()?{err:"history is disabled"}:(o.undo(),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){const{commandService:t}=n;t.executeCommand(e.XFlowGraphCommands.GRAPH_HISTORY_REDO.id,{})}))))),{err:null})}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Hu;po([Kn(_a),go("design:type",Object)],Bu.prototype,"contextProvider",void 0),Bu=po([Xn({token:{token:ba,named:Lu.command.id}})],Bu),function(t){t.command=e.XFlowGraphCommands.GRAPH_HISTORY_REDO,t.hookKey="historyRedo"}(Hu||(Hu={}));let Vu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.historyRedo.call(n,(n=>vo(this,void 0,void 0,(function*(){const o=yield t.getX6Graph();return!1===o.isHistoryEnabled()?{err:"history is disabled"}:(o.redo(),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){const{commandService:t}=n;t.executeCommand(e.XFlowGraphCommands.GRAPH_HISTORY_UNDO.id,{})}))))),{err:null})}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Xu;po([Kn(_a),go("design:type",Object)],Vu.prototype,"contextProvider",void 0),Vu=po([Xn({token:{token:ba,named:Hu.command.id}})],Vu),function(t){t.command=e.XFlowGraphCommands.GRAPH_HISTORY_TOGGLE,t.hookKey="historyToggle"}(Xu||(Xu={}));let zu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.historyToggle.call(n,(n=>vo(this,void 0,void 0,(function*(){const o=yield t.getX6Graph();if(!1===o.isHistoryEnabled())return{err:"history is disabled"};const i=o.isHistoryEnabled(),{enabled:r}=n;return o.toggleHistory(r),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){const{commandService:t}=n;t.executeCommand(e.XFlowGraphCommands.GRAPH_HISTORY_TOGGLE.id,{enabled:i})}))))),{err:null}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Ku;po([Kn(_a),go("design:type",Object)],zu.prototype,"contextProvider",void 0),zu=po([Xn({token:{token:ba,named:Xu.command.id}})],zu),function(t){t.command=e.XFlowGraphCommands.GRAPH_HISTORY_RESET,t.hookKey="historyReset"}(Ku||(Ku={}));let Wu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider(),{args:t,hooks:n}=e.getArgs(),o=e.getHooks(),i=yield o.historyReset.call(t,(()=>vo(this,void 0,void 0,(function*(){return(yield e.getX6Graph()).cleanHistory(),{err:null}}))),n);return e.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Yu;po([Kn(_a),go("design:type",Object)],Wu.prototype,"contextProvider",void 0),Wu=po([Xn({token:{token:ba,named:Ku.command.id}})],Wu),function(t){t.command=e.XFlowGraphCommands.GRAPH_ADD_TOOL,t.hookKey="addTool"}(Yu||(Yu={}));let qu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.addTool.call(n,(n=>vo(this,void 0,void 0,(function*(){const{cellId:o,toolConfig:i,commandService:r}=n,s=(yield t.getX6Graph()).getCellById(o);return s&&(s.addTools(i.items,i.options),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){Array.isArray(i.items)&&i.items.forEach((t=>{r.executeCommand(e.XFlowGraphCommands.GRAPH_DEL_TOOL.id,{cellId:o,toolname:t})}))})))))),{err:null}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var $u;po([Kn(_a),go("design:type",Object)],qu.prototype,"contextProvider",void 0),qu=po([Xn({token:{token:ba,named:Yu.command.id}})],qu),function(t){t.command=e.XFlowGraphCommands.GRAPH_DEL_TOOL,t.hookKey="delTool"}($u||($u={}));let Ju=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider(),{args:t,hooks:n}=e.getArgs(),o=e.getHooks(),i=yield o.delTool.call(t,(t=>vo(this,void 0,void 0,(function*(){const{cellId:n,toolName:o,toolConfig:i}=t,r=(yield e.getX6Graph()).getCellById(n);return r&&("*"===o?r.removeTools(i):r.removeTool(o,i)),{err:null}}))),n);return e.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Zu;po([Kn(_a),go("design:type",Object)],Ju.prototype,"contextProvider",void 0),Ju=po([Xn({token:{token:ba,named:$u.command.id}})],Ju),function(t){t.command=e.XFlowGraphCommands.REDO_CMD,t.hookKey="redoCommand"}(Zu||(Zu={}));let Qu=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.ctx,{args:n,hooks:o}=t.getArgs(),i=t.getHooks();return yield i.redoCommand.call(n,(()=>vo(this,void 0,void 0,(function*(){const n=t.getCommands();return n.isRedoable&&n.redoCommand(),this.ctx.addUndo(e.Disposable.create((()=>{n.redoCommand()}))),{}}))),o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var ed;po([Kn(_a),go("design:type",Object)],Qu.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],Qu.prototype,"init",null),Qu=po([Xn({token:{token:ba,named:Zu.command.id}})],Qu),function(t){t.command=e.XFlowGraphCommands.UNDO_CMD,t.hookKey="undoCommand"}(ed||(ed={}));let td=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.ctx,{args:n,hooks:o}=t.getArgs(),i=t.getHooks();return yield i.undoCommand.call(n,(()=>vo(this,void 0,void 0,(function*(){const n=t.getCommands();return n.isUndoable&&n.undoCommand(),this.ctx.addUndo(e.Disposable.create((()=>{n.redoCommand()}))),{}}))),o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};po([Kn(_a),go("design:type",Object)],td.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],td.prototype,"init",null),td=po([Xn({token:{token:ba,named:ed.command.id}})],td);const nd=[vu,mu,_u,Lu,Hu,Ku,Xu,Cu,xu,Tu,Zu,ed,Pu,Fu,Iu,ju,Yu,$u];var od;!function(t){function o(e){return e.source&&e.source.cell&&n.StringExt.isString(e.source.cell)}function i(e){return e.sourceCell&&n.StringExt.isString(e.sourceCell)}t.command=e.XFlowEdgeCommands.ADD_EDGE,t.hookKey="addEdge",t.createEdgeId=e=>{if(n.StringExt.isString(e.source))return`${e.source}:${e.sourcePortId}-${e.target}:${e.targetPortId}`;if(o(e)){const t=e;return`${t.source.cell}:${t.source.port}-${t.target.cell}:${t.target.port}`}if(i(e)){const t=e;return`${t.sourceCell}:${t.sourcePort}-${t.targetCell}:${t.targetPort}`}},t.isX6EdgeConfig=o,t.isX6EdgePlainConfig=i}(od||(od={}));let id=class{constructor(){this.processEdgeConfig=(e,t)=>vo(this,void 0,void 0,(function*(){if(!t.id){const{createIdService:n=od.createEdgeId}=e;t.id=yield n(t)}return t.sourcePortId&&!t.sourcePort&&(t.sourcePort=t.sourcePortId,t.targetPort=t.targetPortId),t})),this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.addEdge.call(t,(t=>vo(this,void 0,void 0,(function*(){const{cellFactory:n,createEdgeService:o,commandService:i,options:r}=t,s=yield this.ctx.getX6Graph();let a=t.edgeConfig;if(o){const e=yield o(t);if("boolean"==typeof e)return{err:"createEdgeService rejected"};a=e}const c=yield this.processEdgeConfig(t,a);let u;const d=Object.assign(Object.assign({},r),{isCommand:!0});if(n){const e=yield n(c,this);u=s.addEdge(e,d)}else u=s.addEdge(Object.assign(Object.assign({},c),{label:(null==c?void 0:c.label)||c,data:Object.assign({},c)}),d);const l=e.Disposable.create((()=>{i.executeCommand(e.XFlowEdgeCommands.DEL_EDGE.id,{x6Edge:u})}));return this.ctx.addUndo(l),{edgeConfig:c,edgeCell:u}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var rd;po([Kn(_a),go("design:type",Object)],id.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],id.prototype,"init",null),id=po([Xn({token:{token:ba,named:od.command.id}})],id),function(t){var n;t.command=e.XFlowEdgeCommands.DEL_EDGE,t.hookKey="delEdge",(n=t.ErrEnum||(t.ErrEnum={})).EDGE_NOT_EXIST="edge is not exist",n.EDGE_INVALID_CELL="this is not a valid cell",n.X6_DELETE_FAILED="x6 throw err when call delete edge",n.SERVICE_REJECT="service reject to delete"}(rd||(rd={}));let sd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.delEdge.call(t,(t=>vo(this,void 0,void 0,(function*(){const{edgeConfig:n,x6Edge:o,deleteEdgeService:i,commandService:r,options:s}=t;let a=o;if(!a&&(a=yield this.findEdgeById(n),!a))return console.error(rd.ErrEnum.EDGE_NOT_EXIST,n),{err:rd.ErrEnum.EDGE_NOT_EXIST};if(!(a&&a.isEdge()))return console.error(rd.ErrEnum.EDGE_NOT_EXIST,a),{err:rd.ErrEnum.EDGE_NOT_EXIST};if(i){if(!(yield i(t)))return{err:rd.ErrEnum.SERVICE_REJECT}}try{const t=a.getTargetCell(),n=a.getSourceCell(),o=a.getSourcePortId(),i=a.getTargetPortId(),c=n.id,u=t.id;a.remove(Object.assign(Object.assign({},s),{isCommand:!0}));const d=e.Disposable.create((()=>{r.executeCommand(e.XFlowEdgeCommands.ADD_EDGE.id,{edgeConfig:{source:c,target:u,sourcePortId:o,targetPortId:i}})}));return this.ctx.addUndo(d),{err:null,edgeConfig:{source:c,target:u,sourcePortId:o,targetPortId:i},targetCell:t,sourceCell:n,sourcePortId:o,targetPortId:i}}catch(e){return console.error(rd.ErrEnum.X6_DELETE_FAILED,e),{err:rd.ErrEnum.X6_DELETE_FAILED}}}))),n);return this.ctx.setResult(i),this})),this.findEdgeById=e=>vo(this,void 0,void 0,(function*(){return(yield this.ctx.getX6Graph()).getCellById(e.id)})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var ad;po([Kn(_a),go("design:type",Object)],sd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],sd.prototype,"init",null),sd=po([Xn({token:{token:ba,named:rd.command.id}})],sd),function(t){t.command=e.XFlowEdgeCommands.UPDATE_EDGE,t.hookKey="updateEdge",t.XFlowEdgeSetOptions={overwrite:!0},t.XFlowUpdateLabelService=(e,n,o=t.XFlowEdgeSetOptions)=>vo(this,void 0,void 0,(function*(){null==e||e.setLabelAt(0,(null==n?void 0:n.label)||n,o)}))}(ad||(ad={}));let cd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:e,hooks:t}=this.ctx.getArgs(),n=this.ctx.getHooks(),o=yield n.updateEdge.call(e,(e=>vo(this,void 0,void 0,(function*(){const t=yield this.ctx.getX6Graph(),{updateEdgeService:n,updateEdgeLabelService:o=ad.XFlowUpdateLabelService,options:i=ad.XFlowEdgeSetOptions}=e,r=n?yield n(e):null==e?void 0:e.edgeConfig,s=null==t?void 0:t.getCellById(null==r?void 0:r.id);return null==s||s.setData(r,i),(null==r?void 0:r.label)&&(yield o(s,r,i)),r.attrs&&s.setAttrs(r.attrs),{edgeConfig:r,edgeCell:s}}))),t);return this.ctx.setResult(o),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var ud;po([Kn(_a),go("design:type",Object)],cd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],cd.prototype,"init",null),cd=po([Xn({token:{token:ba,named:ad.command.id}})],cd),function(t){t.command=e.XFlowEdgeCommands.HIGHLIGHT_EDGE,t.hookKey="highlightEdge"}(ud||(ud={}));let dd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.highlightEdge.call(t,(t=>vo(this,void 0,void 0,(function*(){var n,o;const i=yield this.ctx.getX6Graph(),{edgeId:r,strokeColor:s,strokeWidth:a}=t,c=i.getEdges(),u=c.find((e=>e.id===r)),d=c.filter((e=>e.id!==r));if(u){const i=u.getAttrs();(null===(n=null==i?void 0:i.line)||void 0===n?void 0:n.stroke)===s&&(null===(o=null==i?void 0:i.line)||void 0===o?void 0:o.strokeWidth)===a||(null==u||u.setAttrs({line:{stroke:s,strokeWidth:a||2}}),d.forEach((e=>{e.setAttrs({line:null==i?void 0:i.line})})),t.commandService.executeCommand(e.XFlowEdgeCommands.FRONT_EDGE.id,{edgeId:r}))}else console.error(r,"this edgeId is not exist");return{}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var ld;po([Kn(_a),go("design:type",Object)],dd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],dd.prototype,"init",null),dd=po([Xn({token:{token:ba,named:ud.command.id}})],dd),function(t){t.command=e.XFlowEdgeCommands.FRONT_EDGE,t.hookKey="frontEdge"}(ld||(ld={}));let hd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.frontEdge.call(t,(t=>vo(this,void 0,void 0,(function*(){const n=yield this.ctx.getX6Graph(),{edgeId:o}=t,i=null==n?void 0:n.getCellById(o);return i?(i.toFront(),this.ctx.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){t.commandService.executeCommand(e.XFlowEdgeCommands.BACK_EDGE.id,{edgeId:o})})))))):console.error(o,"this edgeId is not exist"),{}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};var fd;po([Kn(_a),go("design:type",Object)],hd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],hd.prototype,"init",null),hd=po([Xn({token:{token:ba,named:ld.command.id}})],hd),function(t){t.command=e.XFlowEdgeCommands.BACK_EDGE,t.hookKey="frontEdge"}(fd||(fd={}));let pd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.frontEdge.call(t,(t=>vo(this,void 0,void 0,(function*(){const n=yield this.ctx.getX6Graph(),{edgeId:o}=t,i=null==n?void 0:n.getCellById(o);return i?(i.toBack(),this.ctx.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){t.commandService.executeCommand(e.XFlowEdgeCommands.FRONT_EDGE.id,{edgeId:o})})))))):console.error(o,"this edgeId is not exist"),{}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};po([Kn(_a),go("design:type",Object)],pd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],pd.prototype,"init",null),pd=po([Xn({token:{token:ba,named:fd.command.id}})],pd);const gd=[od,rd,ad,ud,ld,fd];var vd;!function(t){t.command=e.XFlowGroupCommands.ADD_GROUP,t.hookKey="addGroup",t.GROUP_PADDING=12,t.GROUP_HEADER_HEIGHT=40}(vd||(vd={}));let yd=class{constructor(){this.getBBox=(e,t,n)=>{const{groupHeaderHeight:o=vd.GROUP_HEADER_HEIGHT,groupPadding:i=vd.GROUP_PADDING}=t,r=n.getCellsBBox(e.children);return r.moveAndExpand({x:-i,y:-(i+o),width:2*i,height:2*i+o}),r},this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.addGroup.call(n,(n=>vo(this,void 0,void 0,(function*(){const{nodeConfig:o,createService:i,cellFactory:r,commandService:s}=n,a=yield t.getX6Graph(),c=yield s.executeCommand(e.XFlowNodeCommands.ADD_NODE.id,{cellFactory:r,createNodeService:i,nodeConfig:o}),{nodeCell:u}=c.contextProvider().getResult(),{id:d}=u,{groupChildren:l}=o;if(l.length){l.forEach((e=>{const t=a.getCellById(e);t&&(t.setData(Object.assign(Object.assign({},t.getData()),{group:d,isCollapsed:!1})),t.prop("group",d),u.addChild(t),a.unselect(t))}));const e=this.getBBox(u,o,a);u.position(e.x,e.y),u.size(e.width,e.height),u.setZIndex(0),u.prop("isGroup",!0),u.setData(Object.assign(Object.assign({},u.getData()),{width:e.width,height:e.height,groupChildrenSize:{width:e.width,height:e.height},x:e.x,y:e.y,isGroup:!0})),a.select(u)}return o.isCollapsed&&(yield s.executeCommand(e.XFlowGroupCommands.COLLAPSE_GROUP.id,{nodeId:o.id,isCollapsed:o.isCollapsed})),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){s.executeCommand(e.XFlowGroupCommands.DEL_GROUP.id,{nodeConfig:o})}))))),{nodeConfig:o,nodeCell:u}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var md;po([Kn(_a),go("design:type",Object)],yd.prototype,"contextProvider",void 0),yd=po([Xn({token:{token:ba,named:vd.command.id}})],yd),function(t){t.command=e.XFlowGroupCommands.DEL_GROUP,t.hookKey="delGroup"}(md||(md={}));let bd=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.delGroup.call(n,(n=>vo(this,void 0,void 0,(function*(){const o=yield t.getX6Graph(),{nodeConfig:i,commandService:r,deleteService:s}=n,{id:a}=i,c=o.getCellById(a);if(s){if(!(yield s(n)))return{err:"service rejected"}}if(!c)return{err:"target node is not exist"};if(!0!==c.getProp("isGroup"))return{err:"target node is not group"};const{isCollapsed:u}=c.getData();u&&(yield r.executeCommand(e.XFlowGroupCommands.COLLAPSE_GROUP.id,{nodeId:c.id,isCollapsed:!1,collapsedSize:{width:0,height:0}}));const d=c.getChildren();return d&&d.forEach((e=>{c.unembed(e),e.prop("group",""),e.setData(Object.assign(Object.assign({},e.getData()),{group:""}))})),yield r.executeCommand(e.XFlowNodeCommands.DEL_NODE.id,{nodeConfig:i}),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){r.executeCommand(e.XFlowGroupCommands.ADD_GROUP.id,{nodeConfig:i})}))))),{err:null}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var _d;po([Kn(_a),go("design:type",Object)],bd.prototype,"contextProvider",void 0),bd=po([Xn({token:{token:ba,named:md.command.id}})],bd),function(t){t.command=e.XFlowGroupCommands.INIT_GROUP,t.hookKey="initGroup"}(_d||(_d={}));let Ed=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.initGroup.call(n,(n=>vo(this,void 0,void 0,(function*(){const{graphData:o,commandService:i}=n,r=yield t.getX6Graph(),{nodes:s}=o,a={};return s.forEach((e=>{const{id:t,group:n}=e;n&&(a[n]?a[n].push(t):a[n]=[t])})),Object.keys(a).forEach((t=>vo(this,void 0,void 0,(function*(){const o=r.getCellById(t),s=o.getData(),c=a[t]||[];o.prop("isGroup",!0),o.setData(Object.assign(Object.assign({},s),{isGroup:!0,groupChildren:c})),c.forEach((e=>{const t=r.getCellById(e);o.embed(t)})),o.toBack();const{isCollapsed:u,groupCollapsedSize:d}=s;if(u){const t=n.collapsedSize||d||Bo;yield i.executeCommand(e.XFlowGroupCommands.COLLAPSE_GROUP.id,{collapsedSize:t,isCollapsed:!0,nodeId:o.id})}})))),{}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};var Cd;po([Kn(_a),go("design:type",Object)],Ed.prototype,"contextProvider",void 0),Ed=po([Xn({token:{token:ba,named:_d.command.id}})],Ed),function(t){t.command=e.XFlowGroupCommands.COLLAPSE_GROUP,t.hookKey="collapseGroup"}(Cd||(Cd={}));let wd=class{constructor(){this.toggleVisible=(e,t,n)=>{e.forEach((e=>{n.findViewByCell(e).container.style.visibility=t?"visible":"hidden"}))},this.toggleCollapse=(e,t,n)=>{const o=e.getChildren().filter((e=>e.isNode())),i=e.getData(),{isCollapsed:r,gap:s=0}=n;if(r){const t=n.collapsedSize||i.groupCollapsedSize||Bo;e.prop("previousSize",e.size()),e.size(t)}else e.size(e.prop("previousSize"));o&&o.forEach((n=>{const i=e.position(),a=t.getConnectedEdges(n).filter((e=>{const t=e.getSourceNode(),n=e.getTargetNode();return o.includes(t)&&o.includes(n)}));if(r){this.toggleVisible([n,...a],!1,t),n.prop("previousSize",n.size()),n.prop("previousRelativePosition",n.position({relative:!0})),n.position(i.x+s,i.y+s);const o=e.size();n.size({width:o.width-2*s,height:o.height-2*s})}else{this.toggleVisible([n,...a],!0,t);const e=n.prop("previousRelativePosition"),o=n.prop("previousSize");n.position(e.x,e.y,{relative:!0}),n.size(o)}})),e.prop("isCollapsed",r),e.setData(Object.assign(Object.assign({},e.getData()),{isCollapsed:r}))},this.execute=()=>vo(this,void 0,void 0,(function*(){const{args:t,hooks:n}=this.ctx.getArgs(),o=this.ctx.getHooks(),i=yield o.collapseGroup.call(t,(n=>vo(this,void 0,void 0,(function*(){const o=yield this.ctx.getX6Graph(),i=o.getCellById(t.nodeId),{toggleService:r}=n;if(r){if(!(yield r(n)))return{err:"service rejected"}}return i&&(this.toggleCollapse(i,o,t),this.ctx.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){i&&this.toggleCollapse(i,o,Object.assign(t,{isCollapsed:!t.isCollapsed}))})))))),{err:null}}))),n);return this.ctx.setResult(i),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.ctx.isUndoable||(yield this.execute()),this}))}init(){this.ctx=this.contextProvider()}isUndoable(){return this.ctx.isUndoable()}};po([Kn(_a),go("design:type",Object)],wd.prototype,"contextProvider",void 0),po([p.postConstruct(),go("design:type",Function),go("design:paramtypes",[]),go("design:returntype",void 0)],wd.prototype,"init",null),wd=po([Xn({token:{token:ba,named:Cd.command.id}})],wd);const Od=[vd,md,_d,Cd];var xd;!function(t){t.command=e.XFlowModelCommands.UPDATE_MODEL,t.hookKey="updateModel"}(xd||(xd={}));let Ad=class{constructor(){this.execute=()=>vo(this,void 0,void 0,(function*(){const t=this.contextProvider(),{args:n,hooks:o}=t.getArgs(),i=t.getHooks(),r=yield i.updateModel.call(n,(n=>vo(this,void 0,void 0,(function*(){const{updateModel:o,getModel:i,modelService:r}=n,s=yield i(r),a=s.getValue(),c=pa(a);yield o(c);const u=ga(c);return s.setValue(u),t.addUndo(e.Disposable.create((()=>vo(this,void 0,void 0,(function*(){s.setValue(u)}))))),{model:s,value:u}}))),o);return t.setResult(r),this})),this.undo=()=>vo(this,void 0,void 0,(function*(){const e=this.contextProvider();return this.isUndoable()&&e.undo(),this})),this.redo=()=>vo(this,void 0,void 0,(function*(){return this.isUndoable()||(yield this.execute()),this}))}isUndoable(){return this.contextProvider().isUndoable()}};po([Kn(_a),go("design:type",Object)],Ad.prototype,"contextProvider",void 0),Ad=po([Xn({token:{token:ba,named:xd.command.id}})],Ad);const Td=[...gu,...gd,...Od,...nd,...[xd]],Sd=()=>new Ga;let Pd=class{constructor(){this.registerHook=t=>vo(this,void 0,void 0,(function*(){const n=t.x6Events.registerHook({name:"bind group node move event",handler:e=>vo(this,void 0,void 0,(function*(){const t={eventName:"node:moving",callback:({node:e})=>vo(this,void 0,void 0,(function*(){if(e.prop("isGroup"))return void e.prop("originPosition",e.getPosition());const t=e.model.graph,{group:n}=e.getData(),o=t.getNodes().find((e=>e.id===n));if(!o)return;const i=o.getProp("isCollapsed");let r=o.getProp("originSize"),s=!1;null==r&&(r=o.size(),o.prop("originSize",r));let a=o.prop("originPosition");null==a&&(a=o.getPosition(),o.prop("originPosition",a));let c=a.x,u=a.y,d=a.x+r.width,l=a.y+r.height;const h=o.getChildren();if(h&&h.forEach((e=>{const t=e.getBBox().inflate(12),n=t.getCorner();t.x<c&&(c=t.x,s=!0),t.y<u&&(u=t.y,s=!0),n.x>d&&(d=n.x,s=!0),n.y>l&&(l=n.y,s=!0)})),s){o.prop({position:{x:c,y:u},size:{width:d-c,height:l-u}});const e=Object.assign(Object.assign({},o.getData()),{x:c,y:u,width:d-c,height:l-u});!0!==i&&(e.groupChildrenSize={width:d-c,height:l-u}),o.setData(e)}}))};e.push(t)}))});return e.Disposable.create((()=>{n.dispose()}))})),this.registerHookHub=e=>vo(this,void 0,void 0,(function*(){const t=new Mo;return Td.forEach((({hookKey:n,createHook:o=Sd})=>{const i=e.registerHookHub(n,o());t.push(i)})),this.commandConfig.getConfig().then((({getContributions:n})=>{n().forEach((({hookKey:n,createHook:o=Sd})=>{const i=e.registerHookHub(n,o());t.push(i)}))})),t}))}registerGraphCommands(e){Td.forEach((({command:t})=>{e.registerCommand(t,{createCommand:this.commandFactory})})),this.commandConfig.getConfig().then((({getContributions:t})=>{t().forEach((t=>{e.registerCommand(t.command,{createCommand:this.commandFactory})}))}))}};po([Kn(Ea),go("design:type",Function)],Pd.prototype,"commandFactory",void 0),po([Kn(Yc),go("design:type",Yc)],Pd.prototype,"commandConfig",void 0),Pd=po([zn({contrib:[Ca,Ua]})],Pd);const Nd=(e,t)=>{t.getCommandContributions().forEach((t=>{const{CommandHandler:n,command:o}=t;e({token:{token:ba,named:o.id},useClass:n})})),(e=>{e(yu),e(Eu),e(bu),e(wu),e(Au),e(Su),e(Bu),e(Vu),e(zu),e(Wu),e(Qu),e(td),e(Nu),e(Uu),e(ku),e(Gu),e(qu),e(Ju)})(e),(e=>{e($c),e(Zc),e(eu),e(nu),e(iu),e(su),e(cu),e(du),e(hu),e(pu)})(e),(e=>{e(id),e(sd),e(cd),e(dd),e(hd),e(pd)})(e),(e=>{e(yd),e(bd),e(Ed),e(wd)})(e),(e=>{e(Ad)})(e),e(Pd)},Id=e=>io((t=>{t(Mu),((e,t)=>{e({token:Yc,contrib:[Ua],lifecycle:An.Lifecycle.singleton,useDynamic:()=>t})})(t,e),Nd(t,e),t(Kc),t(Ea,{useFactory:e=>(t,n,o)=>{const i=e.container.createChild(),r=i.get(Kc);i.register(_a,{useDynamic:()=>()=>r});const s=i.getNamed(ba,t);return r.setArgs(n,o),r.handlerInstance=s,s}})})),kd=e=>{const t=Za(),n=u.default.useMemo((()=>e.config?e.config:new Yc),[]);return u.default.useEffect((()=>{t.addCoreModule({config:n,createModule:Id})}),[]),null},Md=Symbol("IToolbarService"),Dd=An.defineToken("IToolbarContribution");var jd=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Rd="object"==typeof f&&f&&f.Object===Object&&f,Gd=Rd,Fd="object"==typeof self&&self&&self.Object===Object&&self,Ud=Gd||Fd||Function("return this")(),Ld=Ud,Bd=function(){return Ld.Date.now()},Hd=/\s/;var Vd=function(e){for(var t=e.length;t--&&Hd.test(e.charAt(t)););return t},Xd=/^\s+/;var zd=function(e){return e?e.slice(0,Vd(e)+1).replace(Xd,""):e},Kd=Ud.Symbol,Wd=Kd,Yd=Object.prototype,qd=Yd.hasOwnProperty,$d=Yd.toString,Jd=Wd?Wd.toStringTag:void 0;var Zd=function(e){var t=qd.call(e,Jd),n=e[Jd];try{e[Jd]=void 0;var o=!0}catch(e){}var i=$d.call(e);return o&&(t?e[Jd]=n:delete e[Jd]),i},Qd=Object.prototype.toString;var el=Zd,tl=function(e){return Qd.call(e)},nl=Kd?Kd.toStringTag:void 0;var ol=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":nl&&nl in Object(e)?el(e):tl(e)};var il=function(e){return null!=e&&"object"==typeof e},rl=ol,sl=il;var al=zd,cl=jd,ul=function(e){return"symbol"==typeof e||sl(e)&&"[object Symbol]"==rl(e)},dl=/^[-+]0x[0-9a-f]+$/i,ll=/^0b[01]+$/i,hl=/^0o[0-7]+$/i,fl=parseInt;var pl=jd,gl=Bd,vl=function(e){if("number"==typeof e)return e;if(ul(e))return NaN;if(cl(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=cl(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=al(e);var n=ll.test(e);return n||hl.test(e)?fl(e.slice(2),n?2:8):dl.test(e)?NaN:+e},yl=Math.max,ml=Math.min;var bl=function(e,t,n){var o,i,r,s,a,c,u=0,d=!1,l=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=o,r=i;return o=i=void 0,u=t,s=e.apply(r,n)}function p(e){return u=e,a=setTimeout(v,t),d?f(e):s}function g(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=r}function v(){var e=gl();if(g(e))return y(e);a=setTimeout(v,function(e){var n=t-(e-c);return l?ml(n,r-(e-u)):n}(e))}function y(e){return a=void 0,h&&o?f(e):(o=i=void 0,s)}function m(){var e=gl(),n=g(e);if(o=arguments,i=this,c=e,n){if(void 0===a)return p(c);if(l)return clearTimeout(a),a=setTimeout(v,t),f(c)}return void 0===a&&(a=setTimeout(v,t)),s}return t=vl(t)||0,pl(n)&&(d=!!n.leading,r=(l="maxWait"in n)?yl(vl(n.maxWait)||0,t):r,h="trailing"in n?!!n.trailing:h),m.cancel=function(){void 0!==a&&clearTimeout(a),u=0,o=c=i=a=void 0},m.flush=function(){return void 0===a?s:y(gl())},m};var _l=function(){this.__data__=[],this.size=0};var El=function(e,t){return e===t||e!=e&&t!=t},Cl=El;var wl=function(e,t){for(var n=e.length;n--;)if(Cl(e[n][0],t))return n;return-1},Ol=wl,xl=Array.prototype.splice;var Al=wl;var Tl=wl;var Sl=wl;var Pl=_l,Nl=function(e){var t=this.__data__,n=Ol(t,e);return!(n<0)&&(n==t.length-1?t.pop():xl.call(t,n,1),--this.size,!0)},Il=function(e){var t=this.__data__,n=Al(t,e);return n<0?void 0:t[n][1]},kl=function(e){return Tl(this.__data__,e)>-1},Ml=function(e,t){var n=this.__data__,o=Sl(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this};function Dl(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Dl.prototype.clear=Pl,Dl.prototype.delete=Nl,Dl.prototype.get=Il,Dl.prototype.has=kl,Dl.prototype.set=Ml;var jl=Dl,Rl=jl;var Gl=function(){this.__data__=new Rl,this.size=0};var Fl=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Ul=function(e){return this.__data__.get(e)};var Ll=function(e){return this.__data__.has(e)},Bl=ol,Hl=jd;var Vl,Xl=function(e){if(!Hl(e))return!1;var t=Bl(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},zl=Ud["__core-js_shared__"],Kl=(Vl=/[^.]+$/.exec(zl&&zl.keys&&zl.keys.IE_PROTO||""))?"Symbol(src)_1."+Vl:"";var Wl=function(e){return!!Kl&&Kl in e},Yl=Function.prototype.toString;var ql=function(e){if(null!=e){try{return Yl.call(e)}catch(e){}try{return e+""}catch(e){}}return""},$l=Xl,Jl=Wl,Zl=jd,Ql=ql,eh=/^\[object .+?Constructor\]$/,th=Function.prototype,nh=Object.prototype,oh=th.toString,ih=nh.hasOwnProperty,rh=RegExp("^"+oh.call(ih).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var sh=function(e){return!(!Zl(e)||Jl(e))&&($l(e)?rh:eh).test(Ql(e))},ah=function(e,t){return null==e?void 0:e[t]};var ch=function(e,t){var n=ah(e,t);return sh(n)?n:void 0},uh=ch(Ud,"Map"),dh=ch(Object,"create"),lh=dh;var hh=function(){this.__data__=lh?lh(null):{},this.size=0};var fh=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ph=dh,gh=Object.prototype.hasOwnProperty;var vh=function(e){var t=this.__data__;if(ph){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return gh.call(t,e)?t[e]:void 0},yh=dh,mh=Object.prototype.hasOwnProperty;var bh=dh;var _h=hh,Eh=fh,Ch=vh,wh=function(e){var t=this.__data__;return yh?void 0!==t[e]:mh.call(t,e)},Oh=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=bh&&void 0===t?"__lodash_hash_undefined__":t,this};function xh(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}xh.prototype.clear=_h,xh.prototype.delete=Eh,xh.prototype.get=Ch,xh.prototype.has=wh,xh.prototype.set=Oh;var Ah=xh,Th=jl,Sh=uh;var Ph=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Nh=function(e,t){var n=e.__data__;return Ph(t)?n["string"==typeof t?"string":"hash"]:n.map},Ih=Nh;var kh=Nh;var Mh=Nh;var Dh=Nh;var jh=function(){this.size=0,this.__data__={hash:new Ah,map:new(Sh||Th),string:new Ah}},Rh=function(e){var t=Ih(this,e).delete(e);return this.size-=t?1:0,t},Gh=function(e){return kh(this,e).get(e)},Fh=function(e){return Mh(this,e).has(e)},Uh=function(e,t){var n=Dh(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};function Lh(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Lh.prototype.clear=jh,Lh.prototype.delete=Rh,Lh.prototype.get=Gh,Lh.prototype.has=Fh,Lh.prototype.set=Uh;var Bh=jl,Hh=uh,Vh=Lh;var Xh=jl,zh=Gl,Kh=Fl,Wh=Ul,Yh=Ll,qh=function(e,t){var n=this.__data__;if(n instanceof Bh){var o=n.__data__;if(!Hh||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new Vh(o)}return n.set(e,t),this.size=n.size,this};function $h(e){var t=this.__data__=new Xh(e);this.size=t.size}$h.prototype.clear=zh,$h.prototype.delete=Kh,$h.prototype.get=Wh,$h.prototype.has=Yh,$h.prototype.set=qh;var Jh=$h;var Zh=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o&&!1!==t(e[n],n,e););return e},Qh=ch,ef=function(){try{var e=Qh(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var tf=function(e,t,n){"__proto__"==t&&ef?ef(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},nf=tf,of=El,rf=Object.prototype.hasOwnProperty;var sf=function(e,t,n){var o=e[t];rf.call(e,t)&&of(o,n)&&(void 0!==n||t in e)||nf(e,t,n)},af=sf,cf=tf;var uf=function(e,t,n,o){var i=!n;n||(n={});for(var r=-1,s=t.length;++r<s;){var a=t[r],c=o?o(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?cf(n,a,c):af(n,a,c)}return n};var df=function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o},lf=ol,hf=il;var ff=function(e){return hf(e)&&"[object Arguments]"==lf(e)},pf=il,gf=Object.prototype,vf=gf.hasOwnProperty,yf=gf.propertyIsEnumerable,mf=ff(function(){return arguments}())?ff:function(e){return pf(e)&&vf.call(e,"callee")&&!yf.call(e,"callee")},bf=mf,_f=Array.isArray,Ef={exports:{}};var Cf=function(){return!1};!function(e,t){var n=Ud,o=Cf,i=t&&!t.nodeType&&t,r=i&&e&&!e.nodeType&&e,s=r&&r.exports===i?n.Buffer:void 0,a=(s?s.isBuffer:void 0)||o;e.exports=a}(Ef,Ef.exports);var wf=/^(?:0|[1-9]\d*)$/;var Of=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&wf.test(e))&&e>-1&&e%1==0&&e<t};var xf=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Af=ol,Tf=xf,Sf=il,Pf={};Pf["[object Float32Array]"]=Pf["[object Float64Array]"]=Pf["[object Int8Array]"]=Pf["[object Int16Array]"]=Pf["[object Int32Array]"]=Pf["[object Uint8Array]"]=Pf["[object Uint8ClampedArray]"]=Pf["[object Uint16Array]"]=Pf["[object Uint32Array]"]=!0,Pf["[object Arguments]"]=Pf["[object Array]"]=Pf["[object ArrayBuffer]"]=Pf["[object Boolean]"]=Pf["[object DataView]"]=Pf["[object Date]"]=Pf["[object Error]"]=Pf["[object Function]"]=Pf["[object Map]"]=Pf["[object Number]"]=Pf["[object Object]"]=Pf["[object RegExp]"]=Pf["[object Set]"]=Pf["[object String]"]=Pf["[object WeakMap]"]=!1;var Nf=function(e){return Sf(e)&&Tf(e.length)&&!!Pf[Af(e)]};var If=function(e){return function(t){return e(t)}},kf={exports:{}};!function(e,t){var n=Rd,o=t&&!t.nodeType&&t,i=o&&e&&!e.nodeType&&e,r=i&&i.exports===o&&n.process,s=function(){try{var e=i&&i.require&&i.require("util").types;return e||r&&r.binding&&r.binding("util")}catch(e){}}();e.exports=s}(kf,kf.exports);var Mf=Nf,Df=If,jf=kf.exports,Rf=jf&&jf.isTypedArray,Gf=Rf?Df(Rf):Mf,Ff=df,Uf=bf,Lf=_f,Bf=Ef.exports,Hf=Of,Vf=Gf,Xf=Object.prototype.hasOwnProperty;var zf=function(e,t){var n=Lf(e),o=!n&&Uf(e),i=!n&&!o&&Bf(e),r=!n&&!o&&!i&&Vf(e),s=n||o||i||r,a=s?Ff(e.length,String):[],c=a.length;for(var u in e)!t&&!Xf.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||r&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Hf(u,c))||a.push(u);return a},Kf=Object.prototype;var Wf=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Kf)};var Yf=function(e,t){return function(n){return e(t(n))}},qf=Yf(Object.keys,Object),$f=Wf,Jf=qf,Zf=Object.prototype.hasOwnProperty;var Qf=Xl,ep=xf;var tp=function(e){return null!=e&&ep(e.length)&&!Qf(e)},np=zf,op=function(e){if(!$f(e))return Jf(e);var t=[];for(var n in Object(e))Zf.call(e,n)&&"constructor"!=n&&t.push(n);return t},ip=tp;var rp=function(e){return ip(e)?np(e):op(e)},sp=uf,ap=rp;var cp=function(e,t){return e&&sp(t,ap(t),e)};var up=jd,dp=Wf,lp=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},hp=Object.prototype.hasOwnProperty;var fp=zf,pp=function(e){if(!up(e))return lp(e);var t=dp(e),n=[];for(var o in e)("constructor"!=o||!t&&hp.call(e,o))&&n.push(o);return n},gp=tp;var vp=function(e){return gp(e)?fp(e,!0):pp(e)},yp=uf,mp=vp;var bp=function(e,t){return e&&yp(t,mp(t),e)},_p={exports:{}};!function(e,t){var n=Ud,o=t&&!t.nodeType&&t,i=o&&e&&!e.nodeType&&e,r=i&&i.exports===o?n.Buffer:void 0,s=r?r.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,o=s?s(n):new e.constructor(n);return e.copy(o),o}}(_p,_p.exports);var Ep=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t};var Cp=function(){return[]},wp=function(e,t){for(var n=-1,o=null==e?0:e.length,i=0,r=[];++n<o;){var s=e[n];t(s,n,e)&&(r[i++]=s)}return r},Op=Cp,xp=Object.prototype.propertyIsEnumerable,Ap=Object.getOwnPropertySymbols,Tp=Ap?function(e){return null==e?[]:(e=Object(e),wp(Ap(e),(function(t){return xp.call(e,t)})))}:Op,Sp=uf,Pp=Tp;var Np=function(e,t){return Sp(e,Pp(e),t)};var Ip=function(e,t){for(var n=-1,o=t.length,i=e.length;++n<o;)e[i+n]=t[n];return e},kp=Yf(Object.getPrototypeOf,Object),Mp=Ip,Dp=kp,jp=Tp,Rp=Cp,Gp=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Mp(t,jp(e)),e=Dp(e);return t}:Rp,Fp=uf,Up=Gp;var Lp=function(e,t){return Fp(e,Up(e),t)},Bp=Ip,Hp=_f;var Vp=function(e,t,n){var o=t(e);return Hp(e)?o:Bp(o,n(e))},Xp=Vp,zp=Tp,Kp=rp;var Wp=function(e){return Xp(e,Kp,zp)},Yp=Vp,qp=Gp,$p=vp;var Jp=function(e){return Yp(e,$p,qp)},Zp=ch(Ud,"DataView"),Qp=uh,eg=ch(Ud,"Promise"),tg=ch(Ud,"Set"),ng=ch(Ud,"WeakMap"),og=ol,ig=ql,rg="[object Map]",sg="[object Promise]",ag="[object Set]",cg="[object WeakMap]",ug="[object DataView]",dg=ig(Zp),lg=ig(Qp),hg=ig(eg),fg=ig(tg),pg=ig(ng),gg=og;(Zp&&gg(new Zp(new ArrayBuffer(1)))!=ug||Qp&&gg(new Qp)!=rg||eg&&gg(eg.resolve())!=sg||tg&&gg(new tg)!=ag||ng&&gg(new ng)!=cg)&&(gg=function(e){var t=og(e),n="[object Object]"==t?e.constructor:void 0,o=n?ig(n):"";if(o)switch(o){case dg:return ug;case lg:return rg;case hg:return sg;case fg:return ag;case pg:return cg}return t});var vg=gg,yg=Object.prototype.hasOwnProperty;var mg=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&yg.call(e,"index")&&(n.index=e.index,n.input=e.input),n},bg=Ud.Uint8Array;var _g=function(e){var t=new e.constructor(e.byteLength);return new bg(t).set(new bg(e)),t},Eg=_g;var Cg=function(e,t){var n=t?Eg(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},wg=/\w*$/;var Og=function(e){var t=new e.constructor(e.source,wg.exec(e));return t.lastIndex=e.lastIndex,t},xg=Kd?Kd.prototype:void 0,Ag=xg?xg.valueOf:void 0;var Tg=_g;var Sg=_g,Pg=Cg,Ng=Og,Ig=function(e){return Ag?Object(Ag.call(e)):{}},kg=function(e,t){var n=t?Tg(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Mg=function(e,t,n){var o=e.constructor;switch(t){case"[object ArrayBuffer]":return Sg(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return Pg(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return kg(e,n);case"[object Map]":case"[object Set]":return new o;case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return Ng(e);case"[object Symbol]":return Ig(e)}},Dg=jd,jg=Object.create,Rg=function(){function e(){}return function(t){if(!Dg(t))return{};if(jg)return jg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Gg=kp,Fg=Wf;var Ug=function(e){return"function"!=typeof e.constructor||Fg(e)?{}:Rg(Gg(e))},Lg=vg,Bg=il;var Hg=function(e){return Bg(e)&&"[object Map]"==Lg(e)},Vg=If,Xg=kf.exports,zg=Xg&&Xg.isMap,Kg=zg?Vg(zg):Hg,Wg=vg,Yg=il;var qg=function(e){return Yg(e)&&"[object Set]"==Wg(e)},$g=If,Jg=kf.exports,Zg=Jg&&Jg.isSet,Qg=Zg?$g(Zg):qg,ev=Jh,tv=Zh,nv=sf,ov=cp,iv=bp,rv=_p.exports,sv=Ep,av=Np,cv=Lp,uv=Wp,dv=Jp,lv=vg,hv=mg,fv=Mg,pv=Ug,gv=_f,vv=Ef.exports,yv=Kg,mv=jd,bv=Qg,_v=rp,Ev=vp,Cv="[object Arguments]",wv="[object Function]",Ov="[object Object]",xv={};xv[Cv]=xv["[object Array]"]=xv["[object ArrayBuffer]"]=xv["[object DataView]"]=xv["[object Boolean]"]=xv["[object Date]"]=xv["[object Float32Array]"]=xv["[object Float64Array]"]=xv["[object Int8Array]"]=xv["[object Int16Array]"]=xv["[object Int32Array]"]=xv["[object Map]"]=xv["[object Number]"]=xv[Ov]=xv["[object RegExp]"]=xv["[object Set]"]=xv["[object String]"]=xv["[object Symbol]"]=xv["[object Uint8Array]"]=xv["[object Uint8ClampedArray]"]=xv["[object Uint16Array]"]=xv["[object Uint32Array]"]=!0,xv["[object Error]"]=xv[wv]=xv["[object WeakMap]"]=!1;var Av=function e(t,n,o,i,r,s){var a,c=1&n,u=2&n,d=4&n;if(o&&(a=r?o(t,i,r,s):o(t)),void 0!==a)return a;if(!mv(t))return t;var l=gv(t);if(l){if(a=hv(t),!c)return sv(t,a)}else{var h=lv(t),f=h==wv||"[object GeneratorFunction]"==h;if(vv(t))return rv(t,c);if(h==Ov||h==Cv||f&&!r){if(a=u||f?{}:pv(t),!c)return u?cv(t,iv(a,t)):av(t,ov(a,t))}else{if(!xv[h])return r?t:{};a=fv(t,h,c)}}s||(s=new ev);var p=s.get(t);if(p)return p;s.set(t,a),bv(t)?t.forEach((function(i){a.add(e(i,n,o,i,t,s))})):yv(t)&&t.forEach((function(i,r){a.set(r,e(i,n,o,r,t,s))}));var g=l?void 0:(d?u?dv:uv:u?Ev:_v)(t);return tv(g||t,(function(i,r){g&&(i=t[r=i]),nv(a,r,e(i,n,o,r,t,s))})),a},Tv=Av;var Sv=function(e){return Tv(e,5)},Pv=ol,Nv=il;var Iv=function(e){return!0===e||!1===e||Nv(e)&&"[object Boolean]"==Pv(e)};let kv=class{constructor(){this.toDispose=new Mo,this.toolbarItems=new Map,this.onDidChangeEvent=new va(null),this.onDidChange=this.onDidChangeEvent.watch,this.fireOnDidChange=bl((()=>this.onDidChangeEvent.setValue(void 0)),16),this.registerDisposableToolbar=e=>{const t=new Mo,n={registerToolbarItem:e=>{const n=this.registerItem(e);return t.push(n),n}};return e(n),this.toDispose.push(t),t},this.getToolbarModel=e=>{const{layout:t,mainGroups:n=[],extraGroups:o=[]}=e;return new va({layout:t,mainGroups:this.createToolbarGroupModel(n),extraGroups:this.createToolbarGroupModel(o)})},this.createToolbarGroupModel=e=>{const t=e.map((e=>{const{items:t=[]}=e;return Object.assign(Object.assign({},e),{items:t.map((e=>this.createToolbarModel({id:e.id}))).filter((e=>!!e))})}));return t}}onStart(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerToolbarItems(this)}onStop(){this.toDispose.dispose()}registerItem(t){this.toolbarItems.has(t.id)&&console.warn(`ToolbarRegistry ${t.id} is duplicated, in`,t),this.toolbarItems.set(t.id,t),this.fireOnDidChange();return new Mo(e.Disposable.create((()=>this.fireOnDidChange())),e.Disposable.create((()=>this.toolbarItems.delete(t.id))))}createToolbarModel(e){const t=Sv(this.toolbarItems.get(e.id)),n=!Iv(t.isEnabled)||t.isEnabled,o=!Iv(t.isVisible)||t.isVisible;return Object.assign(Object.assign({},t),{isEnabled:n,isVisible:o,iconName:t.iconName,text:t.text})}};po([Kn(ma),go("design:type",Object)],kv.prototype,"commandService",void 0),po([Kn(Ta),go("design:type",Object)],kv.prototype,"modelService",void 0),po([so(Dd),go("design:type",Object)],kv.prototype,"contributionProvider",void 0),kv=po([zn({contrib:[ya,Md]})],kv);const Mv=()=>io((e=>{ro.register(e,Dd),e(kv)})),Dv=e=>{const t=Za();return u.default.useEffect((()=>{const e=t.addCoreModule({config:{CONFIG_TYPE:"ToolbarRegistry",getConfig:()=>vo(void 0,void 0,void 0,(function*(){}))},createModule:Mv});return()=>{e.dispose()}}),[t]),null};Dv.defaultProps={XFlowModuleType:"ToolbarRegistry"};const jv=Symbol("IMenuService"),Rv=An.defineToken("IMenuContribution");var Gv;e.MenuItemType=void 0,(Gv=e.MenuItemType||(e.MenuItemType={})).Separator="separator",Gv.Submenu="submenu",Gv.Root="root",Gv.Leaf="leaf";let Fv=class{constructor(){this.toDispose=new Mo,this.menuMap=new Map,this.getMenu=e=>this.menuMap.get(e),this.registerDisposableMenu=e=>{const t=new Mo,n={registerMenu:e=>{const n=this.registerMenu(e);return t.push(n),n}};return e(n),this.toDispose.push(t),t}}onStart(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerMenu(this)}onStop(){this.toDispose.dispose()}registerMenu(t){return this.menuMap.set(t.id,t),e.Disposable.create((()=>this.menuMap.delete(t.id)))}};po([so(Rv),go("design:type",Object)],Fv.prototype,"contributionProvider",void 0),Fv=po([zn({contrib:[ya,jv]})],Fv);const Uv=()=>io((e=>{ro.register(e,Rv),e(Fv)})),Lv=e=>{const t=Za();return u.default.useEffect((()=>{const e=t.addCoreModule({config:{CONFIG_TYPE:"MenuRegistry",getConfig:()=>vo(void 0,void 0,void 0,(function*(){}))},createModule:Uv});return()=>{e.dispose()}}),[]),null};Lv.defaultProps={XFlowModuleType:"MenuRegistry"};const Bv=t=>{const{meta:n,graphConfig:o,graphData:i,graphLayout:r,onLoad:s,isAutoCenter:a,hookConfig:c,modelServiceConfig:d,commandConfig:l,onAppConfigReady:h,onAppDestroy:f,children:p=[],className:g,style:v}=t,[y,m]=u.default.useState(),b=u.default.useMemo((()=>new $a),[]);u.default.useEffect((()=>{h&&h(b);const t=(t=>{const n=t.getAllExtensions(),o=new $n,i=n.map((e=>{const{createModule:t,config:n}=e;return t(n)}));return o.load(Lc),o.load(Aa),o.load(Rc),i.forEach((e=>{o.load(e)})),o.get(e.IApplication)})(b);t.start().then((()=>vo(void 0,void 0,void 0,(function*(){m(t),n&&(yield t.commandService.executeCommand(e.XFlowGraphCommands.LOAD_META.id,{meta:n})),s&&s(t,b),i&&(r&&(yield t.commandService.executeCommand(e.XFlowGraphCommands.GRAPH_LAYOUT.id,Object.assign({graphData:i},r))),yield t.commandService.executeCommand(e.XFlowGraphCommands.GRAPH_RENDER.id,{graphData:i}))}))));return()=>{vo(void 0,void 0,void 0,(function*(){f&&f(t)}))}}),[]),u.default.useEffect((()=>{y&&y.commandService.executeCommand(e.XFlowGraphCommands.LOAD_META.id,{meta:n})}),[n]),u.default.useEffect((()=>{vo(void 0,void 0,void 0,(function*(){y&&(i&&r&&(yield y.commandService.executeCommand(e.XFlowGraphCommands.GRAPH_LAYOUT.id,Object.assign({graphData:i},r))),yield y.commandService.executeCommand(e.XFlowGraphCommands.GRAPH_RENDER.id,{graphData:i}),a)&&(yield y.getGraphInstance()).centerContent()}))}),[i]);const _=Eo("xflow-app-workspace",g,...b.getContainerClassNames()),E=(Array.isArray(p)?p:[p]).some((e=>e&&e.props.isXFlowCanvas));return u.default.createElement(Cr,{app:y},u.default.createElement(Ja.Provider,{value:b},u.default.createElement("div",{className:_,id:b.getInstaceId(),style:v},!E&&u.default.createElement(zc,{config:o,position:{top:0,bottom:0,left:0,right:0}}),p,u.default.createElement(Fc,{config:d}),u.default.createElement(kd,{config:l}),u.default.createElement(Qa,{config:c}),u.default.createElement(Dv,null),u.default.createElement(Lv,null))))};Bv.defaultProps={};const Hv=()=>{const e=u.default.useRef(!0);return u.default.useEffect((()=>()=>{e.current=!1}),[]),e},Vv=t=>{const n=Hv(),[o,i]=u.default.useState(t.getValue());u.default.useEffect((()=>{const e=t.watch((e=>{(e=>e&&e.current)(n)&&i(e)}));return()=>{e.dispose()}}),[i]);const r=o,s=e.NsModel.isValidValue(r);return[r,u.default.useCallback((e=>t.setValue(e)),[t]),s]},Xv=Symbol("IKeyBindingService"),zv=An.defineToken("IKeyBindingContribution"),Kv=Symbol("IKeyBindingOptionProvider");let Wv=class{constructor(){this.toDispose=new Mo,this.keyBindingMap=new Map,this.enabledKeyBindingMap=new Map,this.registerExternalKeybindings=()=>vo(this,void 0,void 0,(function*(){const{registerKeybindingFunc:e}=yield this.optionProvider.getOption();return e(this)})),this.registerKeybinding=(t=[])=>{const n=new Mo;return t.forEach((t=>{this.keyBindingMap.set(t.id,t),this.enableKeyBindings(t.id).then((o=>{n.push(e.Disposable.create((()=>{o.dispose(),this.keyBindingMap.delete(t.id)})))}))})),this.toDispose.push(n),n},this.enableKeyBindings=t=>vo(this,void 0,void 0,(function*(){this.disableKeyBindings([t]);const n=this.keyBindingMap.get(t),o=yield this.getX6Graph(),i=this.runCommand(n);o.bindKey(n.keybinding,i);const r=e.Disposable.create((()=>{o.unbindKey(n.keybinding),this.enabledKeyBindingMap.delete(n.id)}));return this.enabledKeyBindingMap.set(n.id,r),r})),this.disableKeyBindings=e=>{e.forEach((e=>{const t=this.enabledKeyBindingMap.get(e);t&&t.dispose()}))},this.runCommand=e=>t=>vo(this,void 0,void 0,(function*(){yield e.callback(e,this.modelService,this.commandService,t)})),this.getX6Graph=()=>vo(this,void 0,void 0,(function*(){return yield this.graphProvider.getGraphInstance()}))}onStart(){const e=this.contributionProvider.getContributions();for(const t of e)t.registerKeybinding(this);this.registerExternalKeybindings()}onStop(){this.toDispose.dispose()}};po([Kn(Kv),go("design:type",Object)],Wv.prototype,"optionProvider",void 0),po([Kn(ma),go("design:type",Object)],Wv.prototype,"commandService",void 0),po([Kn(Ta),go("design:type",Object)],Wv.prototype,"modelService",void 0),po([so(zv),go("design:type",Object)],Wv.prototype,"contributionProvider",void 0),po([Kn(nc),go("design:type",Object)],Wv.prototype,"graphProvider",void 0),Wv=po([zn({contrib:[ya,Xv]})],Wv);const Yv=e=>io((t=>{((e,t)=>{e(Kv,{useDynamic:()=>({getOption:()=>vo(void 0,void 0,void 0,(function*(){return t.getConfig()}))}),lifecycle:An.Lifecycle.singleton})})(t,e),ro.register(t,zv),t(Wv)}));var qv;!function(e){e.CONFIG_TYPE="CONTEXT_CONFIG"}(qv||(qv={}));const $v=()=>e.Disposable.create((()=>{}));class Jv{constructor(){this.CONFIG_TYPE=qv.CONFIG_TYPE,this.keybindingFunc=$v,this.isMounted=new Do,this.setKeybindingFunc=e=>{this.keybindingFunc=e},this.setMountState=()=>{this.isMounted.resolve(!0)},this.getConfig=()=>vo(this,void 0,void 0,(function*(){return yield this.isMounted.promise,{CONFIG_TYPE:this.CONFIG_TYPE,registerKeybindingFunc:this.keybindingFunc}})),this.dispose=()=>{this.keybindingFunc=$v,this.isMounted=new Do}}}const Zv=new class{constructor(){this.map=new Map([["default",gr],["QuestionCircleOutlined",gr]]),this.map.set("default",gr),this.map.set("QuestionCircleOutlined",gr)}get(e){return this.map.get(e)}set(e,t){this.map.set(e,t)}has(e){return this.map.has(e)}};e.AppContext=ec,e.Deferred=Do,e.DisposableCollection=Mo,e.ExtensionRegistryContext=Ja,e.GraphConfig=Nr,e.IApplicationContribution=ya,e.ICommandContextProvider=_a,e.ICommandHandler=ba,e.IGraphCommandContribution=Ca,e.IGraphCommandFactory=Ea,e.IGraphCommandService=ma,e.IGraphProvider=nc,e.IHookContribution=Ua,e.IHookService=Fa,e.IKeyBindingContribution=zv,e.IMenuContribution=Rv,e.IMenuService=jv,e.IModelContribution=Sa,e.IModelService=Ta,e.IToolbarContribution=Dd,e.IToolbarService=Md,e.IconStore=Zv,e.KeyBindings=e=>{const{config:t}=e,n=Za(),o=u.default.useMemo((()=>t||new Jv),[t]);return u.default.useEffect((()=>{const e=n.addCoreModule({config:o,createModule:Yv});return o.setMountState(),()=>{e.dispose(),o.dispose()}}),[n,o]),null},e.KeybindingConfig=Jv,e.MODELS=kc,e.ManaSyringe=lo,e.MenuRegistry=Lv,e.RxModel=va,e.ToolbarRegistry=Dv,e.XFlow=Bv,e.XFlowAppContext=br,e.XFlowAppExtensionMoudle=function(e){const{createModule:t,children:n}=e,o=Za(),i=u.default.useMemo((()=>e.config||{CONFIG_TYPE:"",getConfig:()=>vo(this,void 0,void 0,(function*(){return{}}))}),[]);return u.default.useEffect((()=>{const e=o.addExtension({config:i,createModule:t});return()=>{e.dispose()}}),[]),Array.isArray(n)||u.default.isValidElement(n)?u.default.createElement(u.default.Fragment,null," ",n," "):null},e.XFlowAppProvider=wr,e.XFlowCanvas=zc,e.XFlowConfigProviderContext=Bc,e.XFlowConstants=Ho,e.commandRegistryModule=Aa,e.createCmdConfig=e=>t=>{const n=u.default.useMemo((()=>({getValue:()=>({})})),[]);n.getValue=()=>t;const o=u.default.useMemo((()=>{const t=new Yc;return e(t,n),t}),[n]);return o},e.createComponentModel=e=>{const t=u.default.useMemo((()=>new va(e)),[]),[n,o,i]=Vv(t);return u.default.useEffect((()=>()=>{t.dispose()}),[t]),[n,o,t,i]},e.createGraphConfig=e=>t=>{const n=u.default.useMemo((()=>({getValue:()=>({})})),[]);n.getValue=()=>t;const o=u.default.useMemo((()=>{const t=new Nr;return e(t,n),t}),[n]);return o},e.createHookConfig=e=>t=>{const n=u.default.useMemo((()=>({getValue:()=>({})})),[]);n.getValue=()=>t;const o=u.default.useMemo((()=>{const t=new Ha;return e(t,n),t}),[n]);return o},e.createKeybindingConfig=e=>t=>{const n=u.default.useMemo((()=>({getValue:()=>({})})),[]);n.getValue=()=>t;const o=u.default.useMemo((()=>{const t=new Jv;return e(t,n),t}),[n]);return o},e.createModelServiceConfig=e=>t=>{const n=u.default.useMemo((()=>({getValue:()=>({})})),[]);n.getValue=()=>t;const o=u.default.useMemo((()=>{const t=new cc;return e(t,n),t}),[n]);return o},e.delay=function(e){return new Promise((t=>setTimeout((()=>t(!0)),e)))},e.getNodeReactComponent=tc,e.insertCss=e=>{const t=document.createElement("style");return t.setAttribute("type","text/css"),document.head.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),t},e.isReactComponent=function(e){return function(e){return"function"==typeof e&&!!e.prototype.isReactComponent}(e)||function(e){return"function"==typeof e&&String(e).includes("return React.createElement")}(e)},e.useAppContext=()=>u.default.useContext(ec),e.useExtensionRegistry=Za,e.useIsMountedRef=Hv,e.useModel=Vv,e.useModelAsync=e=>{const{getModel:t,initialState:n}=e,o=Hv(),i=u.default.useRef(),[r,s]=u.default.useState(n);return u.default.useEffect((()=>{let e;return t().then((t=>vo(void 0,void 0,void 0,(function*(){i.current=t;const n=yield t.getValidValue();o.current&&(s(n),e=t.watch((e=>{o.current&&s(e)})))})))),()=>{e&&e.dispose&&e.dispose()}}),[]),[r,s,i.current]},e.usePositionStyle=Vc,e.useXFlowApp=_r,e.useXflowPrefixCls=Hc,e.uuidv4=Vo,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
